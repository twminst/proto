<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Component Demo</title>
    <link rel="stylesheet" href="css/main.css">
</head>

<body>
    <!-- Desktop Sidebar Navigation -->
    <nav class="sidebar">
        <div class="logo">
            <span class="icon icon-40" style="mask-image: var(--icon-canvas-logo-outline);"
                aria-label="App Logo"></span>
        </div>
        <div class="nav-items">
            <a href="#" class="nav-item">
                <span class="icon icon-28" style="mask-image: var(--icon-user-outline);" aria-hidden="true"></span>
                Account
            </a>
            <a href="#" class="nav-item nav-item--active">
                <span class="icon icon-28" style="mask-image: var(--icon-admin-outline);" aria-hidden="true"></span>
                Admin
            </a>
            <a href="#" class="nav-item">
                <span class="icon icon-28" style="mask-image: var(--icon-dashboard-outline);" aria-hidden="true"></span>
                Dashboard
            </a>
            <a href="#" class="nav-item">
                <span class="icon icon-28" style="mask-image: var(--icon-courses-outline);" aria-hidden="true"></span>
                Courses
            </a>
            <a href="#" class="nav-item">
                <span class="icon icon-28" style="mask-image: var(--icon-calendar-month-outline);"
                    aria-hidden="true"></span>
                Calendar
            </a>
            <a href="#" class="nav-item">
                <span class="icon icon-28" style="mask-image: var(--icon-inbox-outline);" aria-hidden="true"></span>
                Inbox
            </a>
            <a href="#" class="nav-item">
                <span class="icon icon-28" style="mask-image: var(--icon-clock-outline);" aria-hidden="true"></span>
                History
            </a>
            <a href="#" class="nav-item">
                <span class="icon icon-28" style="mask-image: var(--icon-question-outline);" aria-hidden="true"></span>
                Help
            </a>
        </div>
    </nav>

    <!-- Mobile Header -->
    <header class="mobile-header" style="max-width: 100vw; width: 100vw; box-sizing: border-box;">
        <div class="mobile-logo">
            <span class="icon icon-24" style="mask-image: var(--icon-canvas-logo-outline);"
                aria-label="App Logo"></span>
        </div>
        <button class="btn btn--inverse btn--icon-only-minimal btn--medium" id="hamburgerBtn" aria-label="Menu">
            <span class="btn-icon" style="mask-image: var(--icon-hamburger-outline);" aria-hidden="true"></span>
        </button>
    </header>

    <!-- Mobile Drawer -->
    <nav class="mobile-drawer" id="mobileDrawer">
        <div class="mobile-drawer-header">
            <div class="mobile-logo">
                <span class="icon icon-24" style="mask-image: var(--icon-canvas-logo-outline);"
                    aria-label="App Logo"></span>
            </div>
            <button class="btn btn--inverse btn--icon-only-minimal btn--medium" id="closeBtn" aria-label="Close">
                <span class="btn-icon" style="mask-image: var(--icon-close-outline);" aria-hidden="true"></span>
            </button>
        </div>
        <div class="mobile-nav-items">
            <a href="#" class="mobile-nav-item">
                <div class="item-content">
                    <span class="icon icon-24" style="mask-image: var(--icon-user-outline);" aria-hidden="true"></span>
                    <span>Account</span>
                </div>
                <span class="icon icon-24 chevron" style="mask-image: var(--icon-chevron-right-outline);"
                    aria-hidden="true"></span>
            </a>
            <a href="#" class="mobile-nav-item">
                <div class="item-content">
                    <span class="icon icon-24" style="mask-image: var(--icon-admin-outline);" aria-hidden="true"></span>
                    <span>Admin</span>
                </div>
                <span class="icon icon-24 chevron" style="mask-image: var(--icon-chevron-right-outline);"
                    aria-hidden="true"></span>
            </a>
            <a href="#" class="mobile-nav-item">
                <div class="item-content">
                    <span class="icon icon-24" style="mask-image: var(--icon-dashboard-outline);"
                        aria-hidden="true"></span>
                    <span>Dashboard</span>
                </div>
                <span class="icon icon-24 chevron" style="mask-image: var(--icon-chevron-right-outline);"
                    aria-hidden="true"></span>
            </a>
            <a href="#" class="mobile-nav-item">
                <div class="item-content">
                    <span class="icon icon-24" style="mask-image: var(--icon-courses-outline);"
                        aria-hidden="true"></span>
                    <span>Courses</span>
                </div>
                <span class="icon icon-24 chevron" style="mask-image: var(--icon-chevron-right-outline);"
                    aria-hidden="true"></span>
            </a>
            <a href="#" class="mobile-nav-item">
                <div class="item-content">
                    <span class="icon icon-24" style="mask-image: var(--icon-calendar-month-outline);"
                        aria-hidden="true"></span>
                    <span>Calendar</span>
                </div>
                <span class="icon icon-24 chevron" style="mask-image: var(--icon-chevron-right-outline);"
                    aria-hidden="true"></span>
            </a>
            <a href="#" class="mobile-nav-item">
                <div class="item-content">
                    <span class="icon icon-24" style="mask-image: var(--icon-inbox-outline);" aria-hidden="true"></span>
                    <span>Inbox</span>
                </div>
                <span class="icon icon-24 chevron" style="mask-image: var(--icon-chevron-right-outline);"
                    aria-hidden="true"></span>
            </a>
            <a href="#" class="mobile-nav-item">
                <div class="item-content">
                    <span class="icon icon-24" style="mask-image: var(--icon-clock-outline);" aria-hidden="true"></span>
                    <span>History</span>
                </div>
                <span class="icon icon-24 chevron" style="mask-image: var(--icon-chevron-right-outline);"
                    aria-hidden="true"></span>
            </a>
            <a href="#" class="mobile-nav-item">
                <div class="item-content">
                    <span class="icon icon-24" style="mask-image: var(--icon-question-outline);"
                        aria-hidden="true"></span>
                    <span>Help</span>
                </div>
                <span class="icon icon-24 chevron" style="mask-image: var(--icon-chevron-right-outline);"
                    aria-hidden="true"></span>
            </a>
        </div>
    </nav>

    <!-- Overlay for mobile drawer -->
    <div class="overlay" id="overlay"></div>

    <!-- Desktop Header -->
    <header class="desktop-header">
        <button class="btn btn--icon-only-minimal btn--medium" id="desktopHamburgerBtn" aria-label="Menu">
            <span class="btn-icon" style="mask-image: var(--icon-hamburger-outline);" aria-hidden="true"></span>
        </button>
        <nav class="breadcrumb">
            <a href="#">East University</a>
            <span class="icon chevron" style="mask-image: var(--icon-chevron-right-outline);" aria-hidden="true"></span>
            Admin Courses
        </nav>
    </header>

    <!-- Secondary Navigation Drawer -->
    <nav class="secondary-nav" id="secondaryNav">
        <ul class="secondary-nav-list">
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link secondary-nav-link--active">Courses</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">People</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Statistics</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Permissions</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Outcomes</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Rubrics</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Grading</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Question Banks</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Sub-Accounts</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Account Calendars</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Terms</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Authentication</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">SIS Import</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Themes</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Developer Keys</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Item Banks</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Data Services</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">SIS Integrations</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Admin Analytics</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Admin Tools</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">ePortfolio Moderation</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Analytics</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Settings</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">SFTP User</a>
            </li>
            <li class="secondary-nav-item">
                <a href="#" class="secondary-nav-link">Domain Lookups</a>
            </li>
        </ul>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content" id="mainContent">

        <!-- Page Header -->
        <header class="page-header">
            <div class="page-header-content">
                <h1>Admin courses</h1>
            </div>
            <div class="page-header-actions">

                <button class="btn btn--primary btn--medium">
                    <span class="btn-icon" style="mask-image: var(--icon-add-outline);" aria-hidden="true"></span>
                    Add course
                </button>
            </div>
        </header>

        <!-- Table Section -->
        <section class="page-section">
            <!-- Search and Filter Module -->

            <div style="display: flex; gap: var(--spacing-12); align-items: flex-end;">
                <div class="form-field table-search" style="flex: 1; margin-bottom: 0; margin-top: 0;">
                    <label for="table-search" class="form-label">Search all courses</label>
                    <div class="form-input-wrapper form-input-wrapper--icon-left">
                        <span class="icon icon-18 form-input-icon" style="mask-image: var(--icon-search-outline);"
                            aria-hidden="true"></span>
                        <input type="text" id="table-search" class="form-input form-input--icon-left"
                            placeholder="Search all courses by keyword" autocomplete="off" spellcheck="false"
                            autocorrect="off" autocapitalize="off">
                    </div>
                </div>
                <button class="btn btn--secondary btn--medium" id="filter-btn">
                    <span class="btn-icon" style="mask-image: var(--icon-filter-outline);" aria-hidden="true"></span>
                    <span class="btn-text">Filter</span>
                </button>
                <button class="btn btn--secondary btn--medium" id="configureBtn" aria-label="Configure table">
                    <span class="btn-icon" style="mask-image: var(--icon-configure-outline);" aria-hidden="true"></span>
                    <span class="btn-text">Options</span>
                </button>

            </div>

            <!-- Active Filters Display -->
            <div id="activeFiltersContainer" class="active-filters-container">
                <div class="active-filters-content">
                    <span class="active-filters-label">Filters:</span>
                    <div id="activeFilterTags" class="active-filter-tags"></div>
                    <button class="btn btn--link btn--small active-filters-clear" id="clearAllActiveFilters">Clear
                        all</button>
                </div>
            </div>

            <!-- Table Tabs -->
            <div class="table-tabs-container">
                <nav class="tabs tabs--secondary" role="tablist" aria-label="Course Tables">
                    <button class="tab tab--active" role="tab" aria-selected="true"
                        aria-controls="active-courses-section" id="active-courses-tab">
                        Active
                    </button>
                    <button class="tab" role="tab" aria-selected="false" 
                        aria-controls="archived-courses-section" id="archived-courses-tab">
                        Archived
                    </button>
                    <div class="tab-spacer"></div>
                </nav>
            </div>

            <!-- Active Courses Section -->
            <div id="active-courses-section" class="tab-content tab-content--active" role="tabpanel" 
                 aria-labelledby="active-courses-tab">
                
                <!-- Results Controls Section -->
                <div class="results-controls">
                <div class="results-controls-left">
                    <div class="results-info">

                        <div class="results-per-page">

                            <div class="form-select-wrapper">
                                <select id="itemsPerPage" class="form-select">
                                    <option value="10">10</option>
                                    <option value="15" selected>15</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <span class="form-select-icon icon icon-18"
                                    style="mask-image: var(--icon-chevron-down-outline);" aria-hidden="true"></span>
                            </div>
                            <label for="itemsPerPage" class="form-label">rows</label>

                            <span id="resultsCount">30 results</span>

                        </div>



                    </div>

                    <!-- Mobile Card View (Hidden on Desktop) -->
                    <div class="mobile-select-all" style="display: none;">

                        <label class="form-checkbox-label"
                            style="flex-direction: row; gap: var(--spacing-8); justify-content: flex-end;">
                            <span>Select all courses</span>
                            <input type="checkbox" class="form-checkbox" id="mobile-select-all-checkbox">
                            <span class="form-checkbox-custom"></span>

                        </label>


                    </div>

                </div>
                <div class="results-controls-right">
                    <div class="selected-info">
                        <span id="selectedCount">Selected: 0</span>

                        <!-- Bulk Actions -->
                        <div class="bulk-actions" id="bulkActions" style="margin-left: var(--spacing-16);">
                            <button class="btn btn--secondary btn--small" id="bulkPublish" disabled>
                                <span class="btn-icon" style="mask-image: var(--icon-publish-outline);"
                                    aria-hidden="true"></span>
                                <span class="btn-text">Publish</span>
                            </button>

                            <button class="btn btn--secondary btn--small" id="bulkConclude" disabled>
                                <span class="btn-icon" style="mask-image: var(--icon-clock-outline);"
                                    aria-hidden="true"></span>
                                <span class="btn-text">Conclude</span>
                            </button>

                            <button class="btn btn--secondary btn--small" id="bulkArchive" disabled>
                                <span class="btn-icon" style="mask-image: var(--icon-delete-outline);"
                                    aria-hidden="true"></span>
                                <span class="btn-text">Archive</span>
                            </button>

                            <!-- More Actions Menu -->
                            <div class="menu-container">
                                <button class="btn btn--secondary btn--small btn--with-chevron menu-trigger"
                                    data-menu="bulk-more-menu" aria-haspopup="true" aria-expanded="false" id="bulkMore"
                                    disabled>
                                    <span class="btn-text">More</span>
                                    <span class="menu-trigger-chevron"
                                        style="mask-image: var(--icon-chevron-down-outline);" aria-hidden="true"></span>
                                </button>

                                <div class="menu" id="bulk-more-menu" role="menu" aria-hidden="true">
                                    <div class="menu-item menu-item--disabled" role="menuitem" tabindex="-1"
                                        id="bulkUnpublish">
                                        <span class="menu-item-icon" style="mask-image: var(--icon-unpublish-outline);"
                                            aria-hidden="true"></span>
                                        <span class="menu-item-text">Unpublish</span>
                                    </div>
                                    <div class="menu-item menu-item--disabled" role="menuitem" tabindex="-1"
                                        id="bulkUnconclude">
                                        <span class="menu-item-icon" style="mask-image: var(--icon-refresh-outline);"
                                            aria-hidden="true"></span>
                                        <span class="menu-item-text">Un-conclude</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-section-content">

                <!-- Table Container -->
                <div class="table-container">
                    <table class="table" role="table">
                        <thead>
                        <tr>
                            <th class="table-header table-header--checkbox">
                                <label class="form-checkbox-label">
                                    <input type="checkbox" class="form-checkbox" id="select-all-checkbox">
                                    <span class="form-checkbox-custom"></span>
                                    <span class="sr-only">Select all courses</span>
                                </label>
                            </th>
                            <th class="table-header table-header--sortable table-header--text-left" data-sort="name">
                                <button class="table-sort-button" aria-label="Sort by name">
                                    Name
                                    <span class="table-sort-icon icon icon-18"
                                        style="mask-image: var(--icon-arrow-mini-double-outline);"
                                        aria-hidden="true"></span>
                                </button>
                            </th>
                            <th class="table-header table-header--sortable table-header--text-left" data-sort="email">
                                <button class="table-sort-button" aria-label="Sort by email">
                                    Email
                                    <span class="table-sort-icon icon icon-18"
                                        style="mask-image: var(--icon-arrow-mini-double-outline);"
                                        aria-hidden="true"></span>
                                </button>
                            </th>
                            <th class="table-header table-header--sortable table-header--text-left" data-sort="role">
                                <button class="table-sort-button" aria-label="Sort by role">
                                    Role
                                    <span class="table-sort-icon icon icon-18"
                                        style="mask-image: var(--icon-arrow-mini-double-outline);"
                                        aria-hidden="true"></span>
                                </button>
                            </th>
                            <th class="table-header table-header--sortable table-header--text-left" data-sort="status">
                                <button class="table-sort-button" aria-label="Sort by status">
                                    Status
                                    <span class="table-sort-icon icon icon-18"
                                        style="mask-image: var(--icon-arrow-mini-double-outline);"
                                        aria-hidden="true"></span>
                                </button>
                            </th>
                            <th class="table-header table-header--sortable table-header--text-right"
                                data-sort="lastLogin">
                                <button class="table-sort-button" aria-label="Sort by last login">
                                    Last Login
                                    <span class="table-sort-icon icon icon-18"
                                        style="mask-image: var(--icon-arrow-mini-double-outline);"
                                        aria-hidden="true"></span>
                                </button>
                            </th>
                            <th class="table-header table-header--text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic content generated by JavaScript -->
                        </tbody>
                    </table>
                </div>



                <div class="table-cards">
                    <!-- Dynamic content generated by JavaScript -->
                </div>

                <!-- Pagination -->
                <div id="tablePagination" class="pagination"></div>

                <!-- Empty State -->
                <div class="card card--secondary empty-state" id="emptyState" style="display: none;">
                    <div class="card-content">
                        <div class="empty-state-content">

                            <div class="empty-state-text">
                                <h3>No results found</h3>
                                <p id="emptyStateMessage">Try adjusting your search or filter criteria to find what
                                    you're looking for.</p>
                            </div>
                            <div class="empty-state-actions">
                                <button class="btn btn--secondary btn--medium" id="clearSearchBtn">Clear search</button>
                                <button class="btn btn--secondary btn--medium" id="clearAllFiltersBtn">Clear
                                    filters</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            
            </div> <!-- End Active Courses Section -->

        <!-- Archived Courses Section -->
        <div id="archived-courses-section" class="tab-content" role="tabpanel" 
             aria-labelledby="archived-courses-tab">
        <section class="page-section">

            <!-- Results Controls Section for Archived Table -->
            <div class="results-controls">
                <div class="results-controls-left">
                    <div class="results-info">
                        <div class="results-per-page">
                            <div class="form-select-wrapper">
                                <select id="archivedItemsPerPage" class="form-select">
                                    <option value="10">10</option>
                                    <option value="15" selected>15</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <span class="form-select-icon icon icon-18"
                                    style="mask-image: var(--icon-chevron-down-outline);" aria-hidden="true"></span>
                            </div>
                            <label for="archivedItemsPerPage" class="form-label">rows</label>
                            <span id="archivedResultsCount" style="font-weight: var(--font-weight-bold);">0 results</span>
                        </div>
                    </div>

                    <!-- Mobile Card View (Hidden on Desktop) -->
                    <div class="mobile-select-all" style="display: none;">
                        <label class="form-checkbox-label"
                            style="flex-direction: row; gap: var(--spacing-8); justify-content: flex-end;">
                            <span>Select all archived courses</span>
                            <input type="checkbox" class="form-checkbox" id="archived-mobile-select-all-checkbox">
                            <span class="form-checkbox-custom"></span>
                        </label>
                    </div>
                </div>
                <div class="results-controls-right">
                    <div class="selected-info">
                        <span id="archivedSelectedCount">Selected: 0</span>

                        <!-- Bulk Actions for Archived -->
                        <div class="bulk-actions" id="archivedBulkActions" style="margin-left: var(--spacing-16);">
                            <button class="btn btn--secondary btn--small" id="archivedBulkRestore" disabled>
                                <span class="btn-icon" style="mask-image: var(--icon-refresh-outline);"
                                    aria-hidden="true"></span>
                                <span class="btn-text">Restore</span>
                            </button>

                        </div>
                    </div>
                </div>
            </div>

            <div class="page-section-content">
                <!-- Archived Table Container -->
                <div class="table-container">
                    <table class="table" role="table" id="archivedTable">
                        <thead>
                            <tr>
                                <th class="table-header table-header--checkbox">
                                    <label class="form-checkbox-label">
                                        <input type="checkbox" class="form-checkbox" id="archived-select-all-checkbox">
                                        <span class="form-checkbox-custom"></span>
                                        <span class="sr-only">Select all archived courses</span>
                                    </label>
                                </th>
                                <th class="table-header table-header--sortable table-header--text-left"
                                    data-sort="name">
                                    <button class="table-sort-button" aria-label="Sort by name">
                                        Name
                                        <span class="table-sort-icon icon icon-18"
                                            style="mask-image: var(--icon-arrow-mini-double-outline);"
                                            aria-hidden="true"></span>
                                    </button>
                                </th>
                                <th class="table-header table-header--sortable table-header--text-left"
                                    data-sort="email">
                                    <button class="table-sort-button" aria-label="Sort by email">
                                        Email
                                        <span class="table-sort-icon icon icon-18"
                                            style="mask-image: var(--icon-arrow-mini-double-outline);"
                                            aria-hidden="true"></span>
                                    </button>
                                </th>
                                <th class="table-header table-header--sortable table-header--text-left"
                                    data-sort="role">
                                    <button class="table-sort-button" aria-label="Sort by role">
                                        Role
                                        <span class="table-sort-icon icon icon-18"
                                            style="mask-image: var(--icon-arrow-mini-double-outline);"
                                            aria-hidden="true"></span>
                                    </button>
                                </th>
                                <th class="table-header table-header--sortable table-header--text-left"
                                    data-sort="status">
                                    <button class="table-sort-button" aria-label="Sort by status">
                                        Status
                                        <span class="table-sort-icon icon icon-18"
                                            style="mask-image: var(--icon-arrow-mini-double-outline);"
                                            aria-hidden="true"></span>
                                    </button>
                                </th>
                                <th class="table-header table-header--sortable table-header--text-right"
                                    data-sort="lastLogin">
                                    <button class="table-sort-button" aria-label="Sort by last login">
                                        Last Login
                                        <span class="table-sort-icon icon icon-18"
                                            style="mask-image: var(--icon-arrow-mini-double-outline);"
                                            aria-hidden="true"></span>
                                    </button>
                                </th>
                                <th class="table-header table-header--text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dynamic content generated by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <div class="table-cards" id="archivedTableCards">
                    <!-- Dynamic content generated by JavaScript -->
                </div>

                <!-- Pagination for Archived -->
                <div id="archivedTablePagination" class="pagination"></div>

                <!-- Empty State for Archived -->
                <div class="card card--secondary empty-state" id="archivedEmptyState" style="display: none;">
                    <div class="card-content">
                        <div class="empty-state-content">
                            <div class="empty-state-text">
                                <h3>No archived courses found</h3>
                                <p id="archivedEmptyStateMessage">No courses have been archived yet.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        </div> <!-- End Archived Courses Section -->

    </main>

    <!-- Configure Tray -->
    <div id="configureTray" class="tray-overlay">
        <div class="tray tray--medium">
            <div class="tray-header">
                <h3>Table options</h3>
                <button class="btn btn--icon-only-minimal btn--small" id="closeConfigureTrayBtn"
                    aria-label="Close tray">
                    <span class="btn-icon" style="mask-image: var(--icon-close-outline);" aria-hidden="true"></span>
                </button>
            </div>
            <div class="tray-body">
                <!-- Configuration Tabs -->
                <div class="tab-demo">
                    <nav class="tabs tabs--secondary" role="tablist" aria-label="Table Configuration">
                        <button class="tab tab--active" role="tab" aria-selected="true"
                            aria-controls="active-config-content" id="active-config-tab">
                            Active Courses
                        </button>
                        <button class="tab" role="tab" aria-selected="false" aria-controls="archived-config-content"
                            id="archived-config-tab">
                            Archived Courses
                        </button>
                        <div class="tab-spacer"></div>
                    </nav>

                    <!-- Active Table Configuration -->
                    <div class="tab-content tab-content--active table-config-section" role="tabpanel"
                        id="active-config-content" aria-labelledby="active-config-tab">
                        <div class="form-field">
                            <div class="config-header">
                                <label class="form-label">Active courses table fields</label>
                            </div>
                            <p class="field-help-text">Select up to 8 fields and drag to reorder. Selected fields will
                                appear in
                                the active courses table. The Name field is required and always included. Actions are
                                always shown.</p>

                            <div class="card card--primary card--padding-compact">
                                <div class="card-content">
                                    <div class="field-progress-section">
                                        <div class="field-counter">
                                            <span id="selectedFieldsCount" class="field-count">6 of 8 selected</span>
                                        </div>
                                        <div class="field-progress">
                                            <div class="field-progress-bar">
                                                <div class="field-progress-fill" id="fieldProgressFill"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field-config-list" id="fieldConfigList">
                            <!-- Field items will be dynamically generated here -->
                        </div>
                    </div>

                    <!-- Archived Table Configuration -->
                    <div class="tab-content table-config-section" role="tabpanel" id="archived-config-content"
                        aria-labelledby="archived-config-tab">
                        <div class="form-field">
                            <div class="config-header">
                                <label class="form-label">Archived courses table fields</label>
                            </div>
                            <p class="field-help-text">Select up to 8 fields and drag to reorder. Selected fields will
                                appear in
                                the archived courses table. The Name field is required and always included. Actions are
                                always shown.</p>

                            <div class="card card--primary card--padding-compact">
                                <div class="card-content">
                                    <div class="field-progress-section">
                                        <div class="field-counter">
                                            <span id="archivedSelectedFieldsCount" class="field-count">6 of 8
                                                selected</span>
                                        </div>
                                        <div class="field-progress">
                                            <div class="field-progress-bar">
                                                <div class="field-progress-fill" id="archivedFieldProgressFill"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field-config-list" id="archivedFieldConfigList">
                            <!-- Field items will be dynamically generated here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="tray-footer">
                <button class="btn btn--link btn--medium" id="resetConfigBtn">Reset to default</button>
                <button class="btn btn--secondary btn--medium" id="cancelConfigBtn">Cancel</button>
                <button class="btn btn--primary btn--medium" id="applyConfigBtn">Apply</button>
            </div>
        </div>
    </div>

    <!-- Filter Tray -->
    <div id="filterTray" class="tray-overlay">
        <div class="tray tray--medium">
            <div class="tray-header">
                <h3>Filter all courses</h3>
                <button class="btn btn--icon-only-minimal btn--small" id="closeTrayBtn" aria-label="Close tray">
                    <span class="btn-icon" style="mask-image: var(--icon-close-outline);" aria-hidden="true"></span>
                </button>
            </div>
            <div class="tray-body">
                <!-- Terms Filter (Searchable Multi-Select) -->
                <div class="form-field">
                    <label for="filter-terms" class="form-label">Terms</label>
                    <div class="multiselect" data-multiselect>
                        <input type="hidden" name="terms" id="filter-terms" data-multiselect-input>
                        <div class="multiselect__container" role="combobox" aria-expanded="false"
                            aria-haspopup="listbox" aria-owns="terms-listbox" tabindex="0">
                            <div class="multiselect__pills" data-multiselect-pills></div>
                            <input type="text" class="multiselect__search" placeholder="Search terms..."
                                aria-label="Search and select terms" aria-describedby="terms-selection-count"
                                data-multiselect-search autocomplete="off">
                            <span class="multiselect__chevron icon icon-18"
                                style="mask-image: var(--icon-chevron-down-outline);" aria-hidden="true"></span>
                        </div>
                        <div class="multiselect__dropdown" id="terms-listbox" role="listbox" aria-label="Terms options"
                            aria-multiselectable="true" data-multiselect-dropdown>
                            <div class="multiselect__option" role="option" data-value="Fall 2025"
                                data-search="fall 2025">Fall 2025</div>
                            <div class="multiselect__option" role="option" data-value="Spring 2025"
                                data-search="spring 2025">Spring 2025</div>
                            <div class="multiselect__option" role="option" data-value="Summer 2025"
                                data-search="summer 2025">Summer 2025</div>
                        </div>
                        <div id="terms-selection-count" class="sr-only" aria-live="polite"></div>
                    </div>
                </div>

                <!-- Sub-Accounts Filter (Searchable Multi-Select) -->
                <div class="form-field">
                    <label for="filter-subaccounts" class="form-label">Sub-accounts</label>
                    <div class="multiselect" data-multiselect>
                        <input type="hidden" name="subaccounts" id="filter-subaccounts" data-multiselect-input>
                        <div class="multiselect__container" role="combobox" aria-expanded="false"
                            aria-haspopup="listbox" aria-owns="subaccounts-listbox" tabindex="0">
                            <div class="multiselect__pills" data-multiselect-pills></div>
                            <input type="text" class="multiselect__search" placeholder="Search sub-accounts..."
                                aria-label="Search and select sub-accounts"
                                aria-describedby="subaccounts-selection-count" data-multiselect-search
                                autocomplete="off">
                            <span class="multiselect__chevron icon icon-18"
                                style="mask-image: var(--icon-chevron-down-outline);" aria-hidden="true"></span>
                        </div>
                        <div class="multiselect__dropdown" id="subaccounts-listbox" role="listbox"
                            aria-label="Sub-accounts options" aria-multiselectable="true" data-multiselect-dropdown>
                            <div class="multiselect__option" role="option" data-value="Center for Laboratory Sciences"
                                data-search="center laboratory sciences">Center for Laboratory Sciences</div>
                            <div class="multiselect__option" role="option" data-value="College of Arts and Sciences"
                                data-search="college arts sciences">College of Arts and Sciences</div>
                            <div class="multiselect__option" role="option" data-value="College of Engineering"
                                data-search="college engineering">College of Engineering</div>
                            <div class="multiselect__option" role="option" data-value="College of Humanities"
                                data-search="college humanities">College of Humanities</div>
                            <div class="multiselect__option" role="option" data-value="College of Sciences"
                                data-search="college sciences">College of Sciences</div>
                            <div class="multiselect__option" role="option" data-value="College of Social Sciences"
                                data-search="college social sciences">College of Social Sciences</div>
                            <div class="multiselect__option" role="option" data-value="Graduate School of Research"
                                data-search="graduate school research">Graduate School of Research</div>
                            <div class="multiselect__option" role="option" data-value="School of Business"
                                data-search="school business">School of Business</div>
                            <div class="multiselect__option" role="option" data-value="School of Environmental Studies"
                                data-search="school environmental studies">School of Environmental Studies</div>
                            <div class="multiselect__option" role="option" data-value="School of Technology"
                                data-search="school technology">School of Technology</div>
                        </div>
                        <div id="subaccounts-selection-count" class="sr-only" aria-live="polite"></div>
                    </div>
                </div>

                <!-- Teachers Filter (Searchable Multi-Select) -->
                <div class="form-field">
                    <label for="filter-teachers" class="form-label">Teachers</label>
                    <div class="multiselect" data-multiselect>
                        <input type="hidden" name="teachers" id="filter-teachers" data-multiselect-input>
                        <div class="multiselect__container" role="combobox" aria-expanded="false"
                            aria-haspopup="listbox" aria-owns="teachers-listbox" tabindex="0">
                            <div class="multiselect__pills" data-multiselect-pills></div>
                            <input type="text" class="multiselect__search" placeholder="Search teachers..."
                                aria-label="Search and select teachers" aria-describedby="teachers-selection-count"
                                data-multiselect-search autocomplete="off">
                            <span class="multiselect__chevron icon icon-18"
                                style="mask-image: var(--icon-chevron-down-outline);" aria-hidden="true"></span>
                        </div>
                        <div class="multiselect__dropdown" id="teachers-listbox" role="listbox"
                            aria-label="Teachers options" aria-multiselectable="true" data-multiselect-dropdown>
                            <div class="multiselect__option" role="option" data-value="Alex Garcia"
                                data-search="alex garcia">Alex Garcia</div>
                            <div class="multiselect__option" role="option" data-value="Alex Johnson"
                                data-search="alex johnson">Alex Johnson</div>
                            <div class="multiselect__option" role="option" data-value="Alex Rivers"
                                data-search="alex rivers">Alex Rivers</div>
                            <div class="multiselect__option" role="option" data-value="Alex Smith"
                                data-search="alex smith">Alex Smith</div>
                            <div class="multiselect__option" role="option" data-value="Avery Johnson"
                                data-search="avery johnson">Avery Johnson</div>
                            <div class="multiselect__option" role="option" data-value="Avery Martinez"
                                data-search="avery martinez">Avery Martinez</div>
                            <div class="multiselect__option" role="option" data-value="Avery Miller"
                                data-search="avery miller">Avery Miller</div>
                            <div class="multiselect__option" role="option" data-value="Blake Torres"
                                data-search="blake torres">Blake Torres</div>
                            <div class="multiselect__option" role="option" data-value="Casey Stone"
                                data-search="casey stone">Casey Stone</div>
                            <div class="multiselect__option" role="option" data-value="Casey Wilson"
                                data-search="casey wilson">Casey Wilson</div>
                            <div class="multiselect__option" role="option" data-value="Drew Martinez"
                                data-search="drew martinez">Drew Martinez</div>
                            <div class="multiselect__option" role="option" data-value="Jana Murphy"
                                data-search="jana murphy">Jana Murphy</div>
                            <div class="multiselect__option" role="option" data-value="Jonah Fox"
                                data-search="jonah fox">Jonah Fox</div>
                            <div class="multiselect__option" role="option" data-value="Jordan Park"
                                data-search="jordan park">Jordan Park</div>
                            <div class="multiselect__option" role="option" data-value="Morgan Baker"
                                data-search="morgan baker">Morgan Baker</div>
                            <div class="multiselect__option" role="option" data-value="Morgan Johnson"
                                data-search="morgan johnson">Morgan Johnson</div>
                            <div class="multiselect__option" role="option" data-value="Morgan Jones"
                                data-search="morgan jones">Morgan Jones</div>
                            <div class="multiselect__option" role="option" data-value="Morgan Rodriguez"
                                data-search="morgan rodriguez">Morgan Rodriguez</div>
                            <div class="multiselect__option" role="option" data-value="Morgan Webb"
                                data-search="morgan webb">Morgan Webb</div>
                            <div class="multiselect__option" role="option" data-value="Riley Adams"
                                data-search="riley adams">Riley Adams</div>
                            <div class="multiselect__option" role="option" data-value="River Kim"
                                data-search="river kim">River Kim</div>
                            <div class="multiselect__option" role="option" data-value="Sage Cooper"
                                data-search="sage cooper">Sage Cooper</div>
                            <div class="multiselect__option" role="option" data-value="Sam Chen" data-search="sam chen">
                                Sam Chen</div>
                            <div class="multiselect__option" role="option" data-value="Skyler Jones"
                                data-search="skyler jones">Skyler Jones</div>
                            <div class="multiselect__option" role="option" data-value="Skyler Lee"
                                data-search="skyler lee">Skyler Lee</div>
                            <div class="multiselect__option" role="option" data-value="Taylor Davis"
                                data-search="taylor davis">Taylor Davis</div>
                            <div class="multiselect__option" role="option" data-value="Taylor Kim"
                                data-search="taylor kim">Taylor Kim</div>
                            <div class="multiselect__option" role="option" data-value="Taylor Quinn"
                                data-search="taylor quinn">Taylor Quinn</div>
                        </div>
                        <div id="teachers-selection-count" class="sr-only" aria-live="polite"></div>
                    </div>
                </div>
                <hr style="margin-top: 24px;">
                <!-- Course Status Filter -->
                <div class="form-field">
                    <label for="filter-status" class="form-label">Course status</label>
                    <div class="form-checkbox-group">
                        <label class="form-checkbox-label">
                            <input type="checkbox" class="form-checkbox filter-status" value="Published">
                            <span class="form-checkbox-custom"></span>
                            Published
                        </label>
                        <label class="form-checkbox-label">
                            <input type="checkbox" class="form-checkbox filter-status" value="Unpublished">
                            <span class="form-checkbox-custom"></span>
                            Unpublished
                        </label>
                        <label class="form-checkbox-label">
                            <input type="checkbox" class="form-checkbox filter-status" value="Concluded">
                            <span class="form-checkbox-custom"></span>
                            Concluded
                        </label>
                    </div>
                </div>
                <hr style="margin-top: 24px;">
                <!-- Course Visibility Filter -->
                <div class="form-field">
                    <label for="filter-visibility" class="form-label">Course visibility</label>
                    <div class="form-checkbox-group">
                        <label class="form-checkbox-label">
                            <input type="checkbox" class="form-checkbox filter-visibility" value="public">
                            <span class="form-checkbox-custom"></span>
                            Public
                        </label>
                        <label class="form-checkbox-label">
                            <input type="checkbox" class="form-checkbox filter-visibility" value="private">
                            <span class="form-checkbox-custom"></span>
                            Private
                        </label>
                    </div>
                </div>
                <hr style="margin-top: 24px;">
                <!-- Students Filter -->
                <div class="form-field">
                    <label for="filter-students" class="form-label">Students</label>
                    <div class="form-checkbox-group">
                        <label class="form-checkbox-label">
                            <input type="checkbox" class="form-checkbox filter-students" value="with-students">
                            <span class="form-checkbox-custom"></span>
                            Courses with students
                        </label>
                        <label class="form-checkbox-label">
                            <input type="checkbox" class="form-checkbox filter-students" value="without-students">
                            <span class="form-checkbox-custom"></span>
                            Courses without students
                        </label>
                    </div>
                </div>
                <hr style="margin-top: 24px;">
                <!-- Course Type Filter -->
                <div class="form-field">
                    <label for="filter-course-type" class="form-label">Course type</label>
                    <div class="form-checkbox-group">
                        <label class="form-checkbox-label">
                            <input type="checkbox" class="form-checkbox filter-course-type" value="blueprint">
                            <span class="form-checkbox-custom"></span>
                            Blueprint
                        </label>
                        <label class="form-checkbox-label">
                            <input type="checkbox" class="form-checkbox filter-course-type" value="template">
                            <span class="form-checkbox-custom"></span>
                            Template
                        </label>
                    </div>
                </div>
                <hr style="margin-top: 24px;">
                <!-- Course Start Date Range -->
                <div class="form-field">
                    <label class="form-label">Course Date</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-12);">
                        <div class="">
                            <label for="start-date-from" class="form-label">From</label>
                            <input type="date" id="start-date-from" class="form-input" />
                        </div>
                        <div class="">
                            <label for="start-date-to" class="form-label">To</label>
                            <input type="date" id="start-date-to" class="form-input" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="tray-footer">
                <button class="btn btn--secondary btn--medium" id="clearFiltersBtn">Reset</button>
                <button class="btn btn--primary btn--medium" id="applyFiltersBtn">Done</button>
            </div>
        </div>
    </div>

    <style>
        .table-cell {
            font-size: var(--font-size-body-small);
        }

        /* Multiselect Component */
        .multiselect {
            position: relative;
            width: 100%;
        }

        .multiselect__container {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: var(--spacing-4);
            min-height: 40px;
            padding: var(--spacing-8) var(--spacing-36) var(--spacing-8) var(--spacing-12);
            border: 1px solid var(--color-line-stroke);
            border-radius: var(--spacing-radius-default);
            background: var(--color-background-primary);
            cursor: text;
            position: relative;
        }

        .multiselect__container:focus,
        .multiselect__container:focus-within {
            border-color: var(--color-border-focus);
            box-shadow: 0 0 0 2px var(--color-border-focus-alpha);
            outline: none;
        }

        .multiselect__container[aria-expanded="true"] {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }

        .multiselect__pills {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: var(--spacing-4);
        }

        .multiselect__pill {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-4);
            background: var(--color-background-secondary);
            color: var(--color-text-primary);
            border: 1px solid var(--color-line-stroke);
            border-radius: 100px;
            padding: 0 var(--spacing-8);
            height: 24px;
            font-size: var(--font-size-body-x-small);
            font-weight: var(--font-weight-medium);
            max-width: 200px;
            margin: 0;
        }

        .multiselect__pill:focus {
            outline: 2px solid var(--color-border-focus);
            outline-offset: 1px;
        }

        .multiselect__pill-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
            flex: 1;
        }

        .multiselect__pill-remove {
            margin-left: var(--spacing-4);
            margin-right: var(--spacing-4);
            background: none;
            border: none;
            cursor: pointer;
            color: inherit;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .multiselect__pill-remove:hover {
            background-color: var(--color-hover-overlay);
        }

        .multiselect__pill-remove:focus {
            outline: 2px solid var(--color-border-focus);
            outline-offset: 0px;
        }

        .multiselect__pill-remove-icon {
            width: 16px;
            height: 16px;
            background-color: currentColor;
            mask-image: var(--icon-close-outline);
            mask-size: contain;
            mask-repeat: no-repeat;
            mask-position: center;
        }

        .multiselect__search {
            border: none;
            background: transparent;
            outline: none;
            flex: 1;
            min-width: 120px;
            height: 24px;
            padding: 0;
            font-family: var(--font-family-primary);
            font-size: var(--font-size-body);
            line-height: var(--line-height-body);
            color: var(--color-text-primary);
        }

        .multiselect__search::placeholder {
            color: var(--color-text-secondary);
        }

        .multiselect--has-selections .multiselect__search::placeholder {
            color: transparent;
        }

        .multiselect__chevron {
            position: absolute;
            right: var(--spacing-12);
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            pointer-events: auto;
            transition: transform 0.2s ease;
        }

        .multiselect__container[aria-expanded="true"] .multiselect__chevron {
            transform: translateY(-50%) rotate(180deg);
        }

        .multiselect__dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--color-background-primary);
            border: 1px solid var(--color-line-stroke);
            border-top: none;
            border-radius: 0 0 var(--spacing-radius-default) var(--spacing-radius-default);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .multiselect__dropdown--open {
            display: block;
        }

        .multiselect--error .multiselect__container {
            border-color: var(--color-border-error);
        }

        .multiselect--error .multiselect__container:focus-within {
            outline-color: var(--color-border-error);
            border-color: var(--color-border-error);
        }

        .form-error-message {
            color: var(--color-error);
            font-size: var(--font-size-body-small);
            margin-top: var(--spacing-4);
        }

        .multiselect__option {
            padding: var(--spacing-8) var(--spacing-12);
            cursor: pointer;
            font-size: var(--font-size-body);
            line-height: var(--line-height-body);
            color: var(--color-text-primary);
        }

        .multiselect__option:hover,
        .multiselect__option--highlighted {
            background: var(--color-background-secondary);
        }

        .multiselect__option--selected {
            background: var(--color-background-brand-alpha);
            color: var(--color-text-brand);
        }

        .multiselect__option--disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .multiselect__option--hidden {
            display: none;
        }

        .multiselect__no-results {
            padding: var(--spacing-12);
            text-align: center;
            color: var(--color-text-secondary);
            font-style: italic;
        }

        /* Disabled state */
        .multiselect--disabled .multiselect__container {
            background: var(--color-background-disabled);
            cursor: not-allowed;
        }

        .multiselect--disabled .multiselect__search {
            cursor: not-allowed;
        }

        .multiselect--disabled .multiselect__chevron {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Validation states */
        .multiselect--invalid .multiselect__container {
            border-color: var(--color-border-danger);
        }

        .multiselect--invalid .multiselect__container:focus,
        .multiselect--invalid .multiselect__container:focus-within {
            border-color: var(--color-border-danger);
            box-shadow: 0 0 0 2px var(--color-border-danger-alpha);
        }

        /* Bulk Actions Styling */
        .selected-info {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            width: 100%;
            gap: var(--spacing-0);
        }

        .bulk-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
        }

        .bulk-actions button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .menu-item--disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .table-card-row span {
            font-size: var(--font-size-body-small);
        }

        /* Fix menu clipping in table cells */
        .table-actions {
            position: relative;
        }

        .table-actions .menu {
            position: fixed;
            z-index: 1000;
            width: 120px;
        }

        /* Menu portal - render menus outside table structure */
        .menu-portal {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            pointer-events: none;
        }

        .menu-portal .menu {
            position: absolute;
            width: 120px;
            pointer-events: auto;
        }

        /* Ensure menus appear above everything */
        .menu.open {
            z-index: 1001;
        }

        /* Left align menu item text and compact layout */
        .table-actions .menu-item {
            text-align: left;
            justify-content: flex-start;
            padding: var(--spacing-8) var(--spacing-12);
        }

        .table-actions .menu-item-text {
            text-align: left;
        }

        /* Full width autocomplete forms in filter tray */
        #filterTray .form-input-wrapper {
            width: 100%;
        }

        #filterTray .multiselect-input {
            width: 100%;
        }

        #filterTray .menu-container {
            width: 100%;
        }

        /* Results Controls Responsive Layout */
        .results-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--spacing-16);
            flex-wrap: wrap;
            margin-bottom: var(--spacing-16);
        }

        .results-controls-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-16);
            min-width: 0;
            flex: 1;
        }

        .results-controls-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-16);
            min-width: 0;
        }

        .results-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-16);
            flex-wrap: wrap;
        }

        .results-per-page {
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
            white-space: nowrap;
        }

        /* Mobile responsive: wrap right section underneath left */
        @media (max-width: 1200px) {
            .results-controls {
                flex-direction: column-reverse;
                align-items: stretch;
                gap: var(--spacing-12);
            }

            .results-controls-left {
                justify-content: space-between;
            }

            .results-controls-right {
                justify-content: right;
                flex-wrap: wrap;
                gap: var(--spacing-8);

            }

            .results-info {
                gap: var(--spacing-8);
            }

            .bulk-actions {
                gap: var(--spacing-4);
                flex-wrap: wrap;
            }

            /* Hide button labels on mobile - show icons only */
            #bulkPublish .btn-text,
            #bulkArchive .btn-text,
            #bulkConclude .btn-text,
            #filter-btn .btn-text,
            #configureBtn .btn-text {
                display: none;
            }

            /* Ensure buttons maintain proper sizing with icon only */
            #filter-btn,
            #configureBtn {
                min-width: 40px;
                padding: var(--spacing-8);
            }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
            .results-controls-left {
                flex-direction: column;
                align-items: stretch;
                gap: var(--spacing-8);
            }

            .results-per-page {
                justify-content: space-between;
            }

            .bulk-actions button {
                flex: 1;
                min-width: 0;
            }
        }

        /* Table Tabs Styling */
        .table-tabs-container {
            margin-top: var(--spacing-24);
            margin-bottom: var(--spacing-16);
        }
    </style>

    <script>
        // Mobile drawer functionality
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const closeBtn = document.getElementById('closeBtn');
        const mobileDrawer = document.getElementById('mobileDrawer');
        const overlay = document.getElementById('overlay');

        function toggleDrawer() {
            mobileDrawer.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function closeDrawer() {
            mobileDrawer.classList.remove('open');
            overlay.classList.remove('active');
        }

        hamburgerBtn.addEventListener('click', toggleDrawer);
        closeBtn.addEventListener('click', closeDrawer);
        overlay.addEventListener('click', closeDrawer);

        // Close drawer when clicking on nav items (mobile)
        document.querySelectorAll('.mobile-nav-item').forEach(item => {
            item.addEventListener('click', closeDrawer);
        });

        // Desktop secondary navigation functionality
        const desktopHamburgerBtn = document.getElementById('desktopHamburgerBtn');
        const secondaryNav = document.getElementById('secondaryNav');
        const mainContent = document.getElementById('mainContent');

        function toggleSecondaryNav() {
            secondaryNav.classList.toggle('closed');
            mainContent.classList.toggle('expanded');
        }

        desktopHamburgerBtn.addEventListener('click', toggleSecondaryNav);

        // Create portal container for menus
        function createMenuPortal() {
            let portal = document.getElementById('menu-portal');
            if (!portal) {
                portal = document.createElement('div');
                portal.id = 'menu-portal';
                portal.className = 'menu-portal';
                document.body.appendChild(portal);
            }
            return portal;
        }

        // MenuManager - Comprehensive menu management system
        class MenuManager {
            constructor(options = {}) {
                this.options = {
                    menuSelector: '.menu',
                    triggerSelector: '.menu-trigger',
                    itemSelector: '.menu-item',
                    selectableItemSelector: '.menu-item--selectable',
                    activeClass: 'open',
                    selectedClass: 'selected',
                    hiddenClass: 'hidden',
                    debounceMs: 50,
                    focusDelay: 50,
                    outsideClickDelay: 100,
                    ...options
                };

                this.activeMenu = null;
                this.activeTrigger = null;
                this.outsideClickHandlers = new Map();
                this.init();
            }

            init() {
                this.bindEvents();
            }

            bindEvents() {
                document.addEventListener('click', this.handleDocumentClick.bind(this));
                document.addEventListener('keydown', this.handleDocumentKeydown.bind(this));
                window.addEventListener('resize', this.handleWindowResize.bind(this));
                window.addEventListener('scroll', this.handleWindowScroll.bind(this));
            }

            handleDocumentClick(e) {
                const trigger = e.target.closest(this.options.triggerSelector);
                const menuItem = e.target.closest(this.options.itemSelector);

                if (trigger) {
                    e.preventDefault();
                    this.toggleMenu(trigger);
                } else if (menuItem && !menuItem.classList.contains('menu-item--submenu')) {
                    this.handleMenuItemClick(menuItem);
                }
            }

            handleDocumentKeydown(e) {
                if (e.key === 'Escape') {
                    this.closeAllMenus();
                    return;
                }

                if (!this.activeMenu) return;

                const menuItems = this.getVisibleMenuItems(this.activeMenu);
                const currentIndex = menuItems.findIndex(item => item === document.activeElement);

                switch (e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        this.focusMenuItem(menuItems, this.getNextIndex(currentIndex, menuItems.length));
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        this.focusMenuItem(menuItems, this.getPreviousIndex(currentIndex, menuItems.length));
                        break;
                    case 'Enter':
                    case ' ':
                        e.preventDefault();
                        if (document.activeElement.classList.contains(this.options.itemSelector.replace('.', ''))) {
                            this.handleMenuItemClick(document.activeElement);
                        }
                        break;
                    case 'Home':
                        e.preventDefault();
                        this.focusMenuItem(menuItems, 0);
                        break;
                    case 'End':
                        e.preventDefault();
                        this.focusMenuItem(menuItems, menuItems.length - 1);
                        break;
                }
            }

            handleMenuItemClick(menuItem) {
                // Close menu after item click
                this.closeAllMenus();
            }

            toggleMenu(trigger) {
                const menuId = trigger.getAttribute('data-menu');
                const menu = document.getElementById(menuId);
                if (!menu) return;

                const isOpen = menu.classList.contains(this.options.activeClass);
                this.closeAllMenus();

                if (!isOpen) {
                    this.openMenu(trigger, menu);
                }
            }

            openMenu(trigger, menu) {
                // Move menu to portal to avoid table clipping
                const portal = createMenuPortal();
                portal.appendChild(menu);

                menu.classList.add(this.options.activeClass);
                this.setAriaStates(trigger, menu, true);
                this.positionMenu(trigger, menu);

                this.activeMenu = menu;
                this.activeTrigger = trigger;
                this.setupOutsideClickHandler(trigger, menu);
                this.focusFirstMenuItem(menu);
            }

            positionMenu(trigger, menu) {
                const triggerRect = trigger.getBoundingClientRect();

                // Get actual menu width after it's rendered
                const menuRect = menu.getBoundingClientRect();
                const menuWidth = menuRect.width || 120; // Fallback to 120 if not measurable

                // Position menu below button, right-aligned to button's right edge
                const top = triggerRect.bottom + 4;
                const left = triggerRect.right - menuWidth;

                // Ensure menu doesn't go off-screen on the left
                const minLeft = 8; // Small margin from viewport edge
                const finalLeft = Math.max(minLeft, left);

                menu.style.top = `${top}px`;
                menu.style.left = `${finalLeft}px`;
            }

            closeMenu(trigger, menu) {
                menu.classList.remove(this.options.activeClass);
                this.setAriaStates(trigger, menu, false);
                this.cleanupOutsideClickHandler(menu);

                // Move menu back to its original container
                const menuContainer = trigger.closest('.table-actions');
                if (menuContainer && menu.parentNode) {
                    menuContainer.appendChild(menu);
                }

                if (this.activeMenu === menu) {
                    this.activeMenu = null;
                    this.activeTrigger = null;
                }
            }

            closeAllMenus() {
                document.querySelectorAll(`${this.options.menuSelector}.${this.options.activeClass}`).forEach(menu => {
                    const trigger = document.querySelector(`[data-menu="${menu.id}"]`);
                    if (trigger) {
                        this.closeMenu(trigger, menu);
                    }
                });
            }

            setAriaStates(trigger, menu, isOpen) {
                trigger.setAttribute('aria-expanded', isOpen.toString());
                menu.setAttribute('aria-hidden', (!isOpen).toString());
            }

            setupOutsideClickHandler(trigger, menu) {
                const handler = (e) => {
                    if (!trigger.contains(e.target) && !menu.contains(e.target)) {
                        this.closeMenu(trigger, menu);
                    }
                };

                setTimeout(() => {
                    document.addEventListener('click', handler);
                    this.outsideClickHandlers.set(menu, handler);
                }, this.options.outsideClickDelay);
            }

            cleanupOutsideClickHandler(menu) {
                const handler = this.outsideClickHandlers.get(menu);
                if (handler) {
                    document.removeEventListener('click', handler);
                    this.outsideClickHandlers.delete(menu);
                }
            }

            getVisibleMenuItems(menu) {
                return Array.from(menu.querySelectorAll(this.options.itemSelector))
                    .filter(item => !item.classList.contains(this.options.hiddenClass) &&
                        !item.classList.contains('menu-header') &&
                        !item.classList.contains('menu-separator'));
            }

            focusMenuItem(menuItems, index) {
                if (menuItems[index]) {
                    menuItems[index].focus();
                }
            }

            getNextIndex(currentIndex, length) {
                return currentIndex < length - 1 ? currentIndex + 1 : 0;
            }

            getPreviousIndex(currentIndex, length) {
                return currentIndex > 0 ? currentIndex - 1 : length - 1;
            }

            focusFirstMenuItem(menu) {
                setTimeout(() => {
                    const firstItem = this.getVisibleMenuItems(menu)[0];
                    if (firstItem) {
                        firstItem.focus();
                    }
                }, this.options.focusDelay);
            }

            handleWindowResize() {
                // Reposition active menu when window is resized
                if (this.activeMenu && this.activeTrigger) {
                    this.positionMenu(this.activeTrigger, this.activeMenu);
                }
            }

            handleWindowScroll() {
                // Reposition active menu when page is scrolled
                if (this.activeMenu && this.activeTrigger) {
                    this.positionMenu(this.activeTrigger, this.activeMenu);
                }
            }
        }

        // Tray Manager Class
        class TrayManager {
            constructor() {
                this.activeTray = null;
                this.init();
            }

            init() {
                // Auto-discover all trays on the page
                const trays = document.querySelectorAll('.tray-overlay');
                trays.forEach(tray => this.setupTray(tray));

                // Global escape key handler
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.activeTray) {
                        this.close();
                    }
                });
            }

            setupTray(trayOverlay) {
                const tray = trayOverlay.querySelector('.tray');
                const closeBtn = tray.querySelector('[id*="close"], [aria-label*="Close"]');
                const cancelBtn = tray.querySelector('[id*="cancel"]');

                // Close on overlay click
                trayOverlay.addEventListener('click', (e) => {
                    if (e.target === trayOverlay) {
                        this.close();
                    }
                });

                // Close button handlers
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => this.close());
                }
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', () => this.close());
                }

                // Focus trap
                trayOverlay.addEventListener('keydown', (e) => {
                    if (!trayOverlay.classList.contains('active')) return;
                    this.handleFocusTrap(e, tray);
                });
            }

            open(trayId, options = {}) {
                // Close any currently open tray
                this.close();

                const trayOverlay = document.getElementById(trayId);
                if (!trayOverlay) {
                    console.error(`Tray with id "${trayId}" not found`);
                    return;
                }

                const tray = trayOverlay.querySelector('.tray');

                // Show tray
                trayOverlay.classList.add('active');
                this.activeTray = trayOverlay;

                // Focus management
                const closeBtn = tray.querySelector('[id*="close"], [aria-label*="Close"]');
                if (closeBtn) {
                    setTimeout(() => closeBtn.focus(), 100);
                }

                // Store opener for focus return
                this.opener = document.activeElement;
            }

            close() {
                if (!this.activeTray) return;

                this.activeTray.classList.remove('active');

                // Return focus to opener
                if (this.opener && this.opener.focus) {
                    this.opener.focus();
                }

                this.activeTray = null;
                this.opener = null;
            }

            handleFocusTrap(e, tray) {
                if (e.key !== 'Tab') return;

                const focusableElements = tray.querySelectorAll(
                    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                );

                if (focusableElements.length === 0) return;

                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];

                if (e.shiftKey && document.activeElement === firstElement) {
                    e.preventDefault();
                    lastElement.focus();
                } else if (!e.shiftKey && document.activeElement === lastElement) {
                    e.preventDefault();
                    firstElement.focus();
                }
            }
        }

        // TabManager Class - Reusable tab management functionality
        class TabManager {
            constructor(options = {}) {
                this.options = {
                    primaryTabsSelector: '.tabs--primary',
                    secondaryTabsSelector: '.tabs--secondary',
                    tabSelector: '.tab',
                    primaryContentSelector: '.tab-content-container > .tab-content',
                    secondaryContentSelector: '.tab-content',
                    activeTabClass: 'tab--active',
                    activeContentClass: 'tab-content--active',
                    secondaryContainerSelector: '.tab-demo',
                    ...options
                };

                this.init();
            }

            init() {
                this.initializeTabs();
                this.setupKeyboardHandlers();
            }

            initializeTabs() {
                const tabContainers = document.querySelectorAll('.tabs');

                tabContainers.forEach(container => {
                    const tabs = container.querySelectorAll(this.options.tabSelector);
                    const isSecondaryTabs = container.classList.contains('tabs--secondary');
                    const isPrimaryTabs = container.classList.contains('tabs--primary');

                    tabs.forEach(tab => {
                        tab.addEventListener('click', () => this.handleTabClick(tab, container, isPrimaryTabs, isSecondaryTabs));
                        tab.addEventListener('keydown', (e) => this.handleKeyNavigation(e, tab, tabs));
                    });
                });
            }

            handleTabClick(clickedTab, container, isPrimaryTabs, isSecondaryTabs) {
                const tabs = container.querySelectorAll(this.options.tabSelector);

                // Remove active state from all tabs in this container
                tabs.forEach(tab => {
                    tab.classList.remove(this.options.activeTabClass);
                    tab.setAttribute('aria-selected', 'false');
                });

                // Add active state to clicked tab
                clickedTab.classList.add(this.options.activeTabClass);
                clickedTab.setAttribute('aria-selected', 'true');

                // Handle tab panels with proper scoping
                const targetPanelId = clickedTab.getAttribute('aria-controls');
                if (targetPanelId) {
                    this.switchTabPanels(targetPanelId, container, isPrimaryTabs, isSecondaryTabs);
                }
            }

            switchTabPanels(targetPanelId, container, isPrimaryTabs, isSecondaryTabs) {
                if (isPrimaryTabs) {
                    // For primary tabs, target main content panels only
                    const allPanels = document.querySelectorAll(this.options.primaryContentSelector);

                    // Hide all primary panels
                    allPanels.forEach(panel => {
                        panel.classList.remove(this.options.activeContentClass);
                    });

                    // Show target panel
                    const targetPanel = document.getElementById(targetPanelId);
                    if (targetPanel) {
                        targetPanel.classList.add(this.options.activeContentClass);
                    }
                } else if (isSecondaryTabs) {
                    // For secondary tabs, scope to nearest container to avoid conflicts
                    const parentContainer = container.closest(this.options.secondaryContainerSelector) || container.parentElement;
                    const allPanels = parentContainer.querySelectorAll(this.options.secondaryContentSelector);

                    // Hide all secondary panels in this scope
                    allPanels.forEach(panel => {
                        panel.classList.remove(this.options.activeContentClass);
                    });

                    // Show target panel
                    const targetPanel = document.getElementById(targetPanelId);
                    if (targetPanel) {
                        targetPanel.classList.add(this.options.activeContentClass);
                    }
                }
            }

            handleKeyNavigation(e, currentTab, tabs) {
                let targetTab = null;

                switch (e.key) {
                    case 'ArrowLeft':
                        e.preventDefault();
                        const prevTab = currentTab.previousElementSibling;
                        targetTab = prevTab || tabs[tabs.length - 1];
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        const nextTab = currentTab.nextElementSibling;
                        targetTab = nextTab || tabs[0];
                        break;
                    case 'Home':
                        e.preventDefault();
                        targetTab = tabs[0];
                        break;
                    case 'End':
                        e.preventDefault();
                        targetTab = tabs[tabs.length - 1];
                        break;
                    case 'Enter':
                    case ' ':
                        e.preventDefault();
                        currentTab.click();
                        break;
                }

                if (targetTab) {
                    targetTab.focus();
                }
            }

            setupKeyboardHandlers() {
                // Global escape key handler for any additional functionality
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.handleEscapeKey(e);
                    }
                });
            }

            handleEscapeKey(e) {
                // Override this method for custom escape behavior
            }

            // Public methods for programmatic control
            activateTab(tabId) {
                const tab = document.getElementById(tabId);
                if (tab && tab.classList.contains(this.options.tabSelector.replace('.', ''))) {
                    tab.click();
                }
            }

            activateTabByIndex(containerSelector, index) {
                const container = document.querySelector(containerSelector);
                if (container) {
                    const tabs = container.querySelectorAll(this.options.tabSelector);
                    if (tabs[index]) {
                        tabs[index].click();
                    }
                }
            }

            getActiveTab(containerSelector) {
                const container = document.querySelector(containerSelector);
                if (container) {
                    return container.querySelector(this.options.tabSelector + this.options.activeTabClass.replace(/^\./, '.'));
                }
                return null;
            }

            // Static method for quick initialization
            static init(options = {}) {
                return new TabManager(options);
            }
        }

        // =============================================================================
        // UNIFIED FILTER SYSTEM - Direct control of both tables
        // =============================================================================
        
        class UnifiedFilterManager {
            constructor() {
                this.activeFilters = {};
                this.searchTerm = '';
                this.allCourseData = [];
            }
            
            setData(data) {
                this.allCourseData = data;
            }
            
            applyAllFilters() {
                const activeData = this.allCourseData.filter(course => !course.Archive);
                const archivedData = this.allCourseData.filter(course => course.Archive);
                
                const filteredActive = this.filterData(activeData);
                const filteredArchived = this.filterData(archivedData);
                
                this.updateTableDisplay('active', filteredActive);
                this.updateTableDisplay('archived', filteredArchived);
                this.updateFilterTags();
            }
            
            filterData(data) {
                let filtered = data;
                
                // Apply search filter
                if (this.searchTerm) {
                    const searchLower = this.searchTerm.toLowerCase();
                    filtered = filtered.filter(course => {
                        return course.Name.toLowerCase().includes(searchLower) ||
                               (course['SIS ID'] && course['SIS ID'].toLowerCase().includes(searchLower)) ||
                               (course.Teachers && course.Teachers.some(t => t.Name.toLowerCase().includes(searchLower))) ||
                               (course.Terms && course.Terms.some(t => t.toLowerCase().includes(searchLower))) ||
                               (course['Sub-Accounts'] && course['Sub-Accounts'].some(s => s.toLowerCase().includes(searchLower)));
                    });
                }
                
                // Apply status filters
                if (this.activeFilters.status && this.activeFilters.status.length > 0) {
                    filtered = filtered.filter(course => this.activeFilters.status.includes(course.Status));
                }
                
                // Apply visibility filters
                if (this.activeFilters.visibility && this.activeFilters.visibility.length > 0) {
                    filtered = filtered.filter(course => {
                        return this.activeFilters.visibility.some(v => {
                            if (v === 'public') return course.Visibility === 'Public';
                            if (v === 'private') return course.Visibility === 'Private';
                            return false;
                        });
                    });
                }
                
                // Apply student filters
                if (this.activeFilters.students && this.activeFilters.students.length > 0) {
                    filtered = filtered.filter(course => {
                        return this.activeFilters.students.some(s => {
                            if (s === 'with-students') return course.Students > 0;
                            if (s === 'without-students') return course.Students === 0;
                            return false;
                        });
                    });
                }
                
                // Apply course type filters
                if (this.activeFilters.courseType && this.activeFilters.courseType.length > 0) {
                    filtered = filtered.filter(course => {
                        return this.activeFilters.courseType.some(t => {
                            if (t === 'blueprint') return course.Type && course.Type.blueprint;
                            if (t === 'template') return course.Type && course.Type.template;
                            return false;
                        });
                    });
                }
                
                // Apply terms filter
                if (this.activeFilters.terms && this.activeFilters.terms.length > 0) {
                    filtered = filtered.filter(course => {
                        return course.Terms && course.Terms.some(term => this.activeFilters.terms.includes(term));
                    });
                }
                
                // Apply subaccounts filter
                if (this.activeFilters.subaccounts && this.activeFilters.subaccounts.length > 0) {
                    filtered = filtered.filter(course => {
                        return course['Sub-Accounts'] && course['Sub-Accounts'].some(sub => this.activeFilters.subaccounts.includes(sub));
                    });
                }
                
                // Apply teachers filter
                if (this.activeFilters.teachers && this.activeFilters.teachers.length > 0) {
                    filtered = filtered.filter(course => {
                        return course.Teachers && course.Teachers.some(teacher => this.activeFilters.teachers.includes(teacher.Name));
                    });
                }
                
                // Apply date range filter
                if (this.activeFilters.dateRange && (this.activeFilters.dateRange.from || this.activeFilters.dateRange.to)) {
                    filtered = filtered.filter(course => {
                        const courseDate = new Date(course['Start Date']);
                        const fromDate = this.activeFilters.dateRange.from ? new Date(this.activeFilters.dateRange.from) : null;
                        const toDate = this.activeFilters.dateRange.to ? new Date(this.activeFilters.dateRange.to) : null;
                        
                        if (fromDate && courseDate < fromDate) return false;
                        if (toDate && courseDate > toDate) return false;
                        return true;
                    });
                }
                
                return filtered;
            }
            
            updateTableDisplay(tableType, filteredData) {
                if (tableType === 'active') {
                    // Update main table - bypass internal filtering
                    if (window.mainDataTable) {
                        // Clear any existing search/filter state
                        window.mainDataTable.searchTerm = '';
                        window.mainDataTable.filterManager.clearFilters();
                        
                        // Set the pre-filtered data
                        window.mainDataTable.dataAdapter.rawData = filteredData;
                        window.mainDataTable.currentPage = 1;
                        window.mainDataTable.render();
                    }
                } else if (tableType === 'archived') {
                    // Update archived table - bypass internal filtering
                    if (window.archivedDataTable) {
                        // Clear any existing search/filter state
                        window.archivedDataTable.searchTerm = '';
                        window.archivedDataTable.filterManager.clearFilters();
                        
                        // Set the pre-filtered data
                        window.archivedDataTable.dataAdapter.rawData = filteredData;
                        window.archivedDataTable.currentPage = 1;
                        window.archivedDataTable.render();
                    }
                }
            }
            
            setFilter(filterType, values) {
                if (!values || (Array.isArray(values) && values.length === 0)) {
                    delete this.activeFilters[filterType];
                } else {
                    this.activeFilters[filterType] = values;
                }
                this.applyAllFilters();
            }
            
            setSearch(searchTerm) {
                this.searchTerm = searchTerm;
                this.applyAllFilters();
            }
            
            clearAllFilters() {
                this.activeFilters = {};
                this.searchTerm = '';
                
                // Clear UI elements
                document.querySelectorAll('#filterTray input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.querySelectorAll('#filterTray input[type="date"]').forEach(input => input.value = '');
                document.querySelectorAll('[data-multiselect]').forEach(multiselect => {
                    const instance = multiselect.multiselectInstance;
                    if (instance) instance.clear(true);
                });
                
                const searchInput = document.getElementById('table-search');
                if (searchInput) searchInput.value = '';
                
                this.applyAllFilters();
            }
            
            updateFilterTags() {
                const activeFiltersContainer = document.getElementById('activeFiltersContainer');
                const activeFilterTags = document.getElementById('activeFilterTags');
                
                if (!activeFiltersContainer || !activeFilterTags) return;
                
                activeFilterTags.innerHTML = '';
                const hasActiveFilters = Object.keys(this.activeFilters).length > 0 || this.searchTerm;
                
                if (hasActiveFilters) {
                    activeFiltersContainer.classList.add('active-filters-container--visible');
                    
                    // Add search tag
                    if (this.searchTerm) {
                        const searchTag = this.createFilterTag('search', this.searchTerm);
                        activeFilterTags.appendChild(searchTag);
                    }
                    
                    // Add filter tags
                    Object.entries(this.activeFilters).forEach(([filterType, values]) => {
                        if (filterType === 'dateRange' && values && (values.from || values.to)) {
                            const tag = this.createFilterTag(filterType, values);
                            activeFilterTags.appendChild(tag);
                        } else if (Array.isArray(values)) {
                            values.forEach(value => {
                                const tag = this.createFilterTag(filterType, value);
                                activeFilterTags.appendChild(tag);
                            });
                        }
                    });
                } else {
                    activeFiltersContainer.classList.remove('active-filters-container--visible');
                }
            }
            
            createFilterTag(filterType, value) {
                const tag = document.createElement('span');
                tag.className = 'tag tag--medium tag--dismissable';
                
                let displayLabel = value;
                if (filterType === 'search') {
                    displayLabel = `Search: "${value}"`;
                } else if (filterType === 'status') {
                    displayLabel = `Status: ${value}`;
                } else if (filterType === 'visibility') {
                    displayLabel = `Visibility: ${value === 'public' ? 'Public' : 'Private'}`;
                } else if (filterType === 'terms') {
                    displayLabel = `Term: ${value}`;
                } else if (filterType === 'subaccounts') {
                    displayLabel = `Sub-Account: ${value}`;
                } else if (filterType === 'teachers') {
                    displayLabel = `Teacher: ${value}`;
                } else if (filterType === 'students') {
                    displayLabel = value === 'with-students' ? 'Students: With students' : 'Students: Without students';
                } else if (filterType === 'courseType') {
                    displayLabel = value === 'blueprint' ? 'Type: Blueprint' : 'Type: Template';
                } else if (filterType === 'dateRange') {
                    if (value.from && value.to) {
                        displayLabel = `Date: ${value.from} to ${value.to}`;
                    } else if (value.from) {
                        displayLabel = `Date: from ${value.from}`;
                    } else if (value.to) {
                        displayLabel = `Date: to ${value.to}`;
                    }
                }
                
                tag.innerHTML = `
                    <span class="tag__text">${displayLabel}</span>
                    <button class="tag__close" aria-label="Remove ${displayLabel}">
                        <span class="tag__close-icon"></span>
                    </button>
                `;
                
                const closeBtn = tag.querySelector('.tag__close');
                closeBtn.addEventListener('click', () => {
                    if (filterType === 'search') {
                        this.setSearch('');
                    } else {
                        this.removeFilterValue(filterType, value);
                    }
                });
                
                return tag;
            }
            
            removeFilterValue(filterType, value) {
                if (filterType === 'dateRange') {
                    delete this.activeFilters[filterType];
                    document.getElementById('start-date-from').value = '';
                    document.getElementById('start-date-to').value = '';
                } else if (Array.isArray(this.activeFilters[filterType])) {
                    this.activeFilters[filterType] = this.activeFilters[filterType].filter(v => v !== value);
                    if (this.activeFilters[filterType].length === 0) {
                        delete this.activeFilters[filterType];
                    }
                    
                    // Update UI checkboxes
                    const checkbox = document.querySelector(`.filter-${filterType}[value="${value}"]`);
                    if (checkbox) checkbox.checked = false;
                }
                this.applyAllFilters();
            }
        }
        
        // Create global unified filter manager
        const unifiedFilterManager = new UnifiedFilterManager();
        window.unifiedFilterManager = unifiedFilterManager;

        // Course data from the JSON file
        const sampleData = [
            {
                "Name": "Intro to History",
                "SIS ID": "SIS-1000",
                "Terms": ["Fall 2025"],
                "Sub-Accounts": ["College of Sciences"],
                "Teachers": [{ "Name": "Avery Miller", "Initials": "AM" }, { "Name": "Alex Johnson", "Initials": "AJ" }],
                "Status": "Unpublished",
                "Visibility": "Private",
                "Students": 0,
                "Type": { "template": false, "blueprint": true },
                "Start Date": "09-26-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Advanced Economics",
                "SIS ID": "SIS-1001",
                "Terms": ["Fall 2025", "Summer 2025"],
                "Sub-Accounts": ["College of Engineering"],
                "Teachers": [{ "Name": "Avery Martinez", "Initials": "AM" }],
                "Status": "Concluded",
                "Visibility": "Private",
                "Students": 90,
                "Type": { "template": true, "blueprint": true },
                "Start Date": "12-23-2025",
                "Archive": true,
                "Archived Date": "01-15-2025"
            },
            {
                "Name": "Topics in Literature",
                "SIS ID": "SIS-1002",
                "Terms": ["Spring 2025"],
                "Sub-Accounts": ["College of Arts and Sciences"],
                "Teachers": [{ "Name": "Taylor Davis", "Initials": "TD" }, { "Name": "Avery Johnson", "Initials": "AJ" }],
                "Status": "Unpublished",
                "Visibility": "Public",
                "Students": 0,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "12-09-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Advanced Chemistry",
                "SIS ID": "SIS-1003",
                "Terms": ["Spring 2025"],
                "Sub-Accounts": ["School of Business", "College of Humanities"],
                "Teachers": [{ "Name": "Alex Smith", "Initials": "AS" }],
                "Status": "Published",
                "Visibility": "Public",
                "Students": 32,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "05-26-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Foundations of Literature",
                "SIS ID": "SIS-1004",
                "Terms": ["Summer 2025"],
                "Sub-Accounts": ["College of Sciences", "College of Engineering"],
                "Teachers": [{ "Name": "Skyler Lee", "Initials": "SL" }],
                "Status": "Published",
                "Visibility": "Public",
                "Students": 39,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "05-27-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Intro to Biology",
                "SIS ID": "SIS-1005",
                "Terms": ["Summer 2025", "Spring 2025"],
                "Sub-Accounts": ["School of Business"],
                "Teachers": [{ "Name": "Alex Garcia", "Initials": "AG" }],
                "Status": "Concluded",
                "Visibility": "Private",
                "Students": 60,
                "Type": { "template": true, "blueprint": false },
                "Start Date": "12-13-2025",
                "Archive": true,
                "Archived Date": "12-20-2024"
            },
            {
                "Name": "Advanced Philosophy",
                "SIS ID": "SIS-1006",
                "Terms": ["Fall 2025", "Spring 2025"],
                "Sub-Accounts": ["College of Humanities"],
                "Teachers": [{ "Name": "Morgan Johnson", "Initials": "MJ" }, { "Name": "Jana Murphy", "Initials": "JM" }],
                "Status": "Published",
                "Visibility": "Public",
                "Students": 91,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "03-15-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Advanced Physics",
                "SIS ID": "SIS-1007",
                "Terms": ["Spring 2025", "Fall 2025"],
                "Sub-Accounts": ["School of Business"],
                "Teachers": [{ "Name": "Skyler Jones", "Initials": "SJ" }],
                "Status": "Published",
                "Visibility": "Public",
                "Students": 39,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "04-29-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Principles of Biology",
                "SIS ID": "SIS-1008",
                "Terms": ["Summer 2025"],
                "Sub-Accounts": ["College of Arts and Sciences", "School of Business"],
                "Teachers": [{ "Name": "Morgan Rodriguez", "Initials": "MR" }],
                "Status": "Concluded",
                "Visibility": "Private",
                "Students": 15,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "01-28-2025",
                "Archive": true,
                "Archived Date": "11-30-2024"
            },
            {
                "Name": "Intro to Chemistry",
                "SIS ID": "SIS-1009",
                "Terms": ["Spring 2025"],
                "Sub-Accounts": ["College of Arts and Sciences", "College of Engineering"],
                "Teachers": [{ "Name": "Morgan Jones", "Initials": "MJ" }, { "Name": "Skyler Lee", "Initials": "SL" }],
                "Status": "Concluded",
                "Visibility": "Private",
                "Students": 26,
                "Type": { "template": true, "blueprint": false },
                "Start Date": "07-25-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Principles of Mathematics",
                "SIS ID": "SIS-1010",
                "Terms": ["Fall 2025"],
                "Sub-Accounts": ["College of Sciences"],
                "Teachers": [{ "Name": "Casey Wilson", "Initials": "CW" }],
                "Status": "Published",
                "Visibility": "Public",
                "Students": 45,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "08-15-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Modern Literature",
                "SIS ID": "SIS-1011",
                "Terms": ["Spring 2025"],
                "Sub-Accounts": ["College of Humanities"],
                "Teachers": [{ "Name": "Taylor Kim", "Initials": "TK" }, { "Name": "Jordan Park", "Initials": "JP" }],
                "Status": "Published",
                "Visibility": "Public",
                "Students": 62,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "01-20-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Basic Programming",
                "SIS ID": "SIS-1012",
                "Terms": ["Fall 2025", "Spring 2025"],
                "Sub-Accounts": ["College of Engineering"],
                "Teachers": [{ "Name": "Sam Chen", "Initials": "SC" }],
                "Status": "Published",
                "Visibility": "Public",
                "Students": 78,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "08-25-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "World Geography",
                "SIS ID": "SIS-1013",
                "Terms": ["Summer 2025"],
                "Sub-Accounts": ["College of Social Sciences"],
                "Teachers": [{ "Name": "Riley Adams", "Initials": "RA" }, { "Name": "Blake Torres", "Initials": "BT" }],
                "Status": "Unpublished",
                "Visibility": "Private",
                "Students": 0,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "06-01-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Business Ethics",
                "SIS ID": "SIS-1014",
                "Terms": ["Fall 2025"],
                "Sub-Accounts": ["School of Business"],
                "Teachers": [{ "Name": "Morgan Webb", "Initials": "MW" }],
                "Status": "Published",
                "Visibility": "Public",
                "Students": 55,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "09-10-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Environmental Science",
                "SIS ID": "SIS-1015",
                "Terms": ["Spring 2025", "Fall 2025"],
                "Sub-Accounts": ["College of Sciences", "School of Environmental Studies"],
                "Teachers": [{ "Name": "Alex Rivers", "Initials": "AR" }, { "Name": "Casey Stone", "Initials": "CS" }],
                "Status": "Published",
                "Visibility": "Public",
                "Students": 89,
                "Type": { "template": false, "blueprint": true },
                "Start Date": "02-01-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Digital Media Arts",
                "SIS ID": "SIS-1016",
                "Terms": ["Summer 2025"],
                "Sub-Accounts": ["College of Arts and Sciences", "School of Technology"],
                "Teachers": [{ "Name": "Jonah Fox", "Initials": "JF" }],
                "Status": "Concluded",
                "Visibility": "Private",
                "Students": 28,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "05-15-2025",
                "Archive": true,
                "Archived Date": "01-08-2025"
            },
            {
                "Name": "Statistics for Research",
                "SIS ID": "SIS-1017",
                "Terms": ["Fall 2025"],
                "Sub-Accounts": ["College of Sciences", "Graduate School of Research"],
                "Teachers": [{ "Name": "Taylor Quinn", "Initials": "TQ" }, { "Name": "Morgan Baker", "Initials": "MB" }],
                "Status": "Published",
                "Visibility": "Public",
                "Students": 67,
                "Type": { "template": true, "blueprint": false },
                "Start Date": "08-30-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Human Psychology",
                "SIS ID": "SIS-1018",
                "Terms": ["Spring 2025"],
                "Sub-Accounts": ["College of Social Sciences"],
                "Teachers": [{ "Name": "River Kim", "Initials": "RK" }],
                "Status": "Published",
                "Visibility": "Public",
                "Students": 72,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "01-15-2025",
                "Archive": false,
                "Archived Date": null
            },
            {
                "Name": "Organic Chemistry Lab",
                "SIS ID": "SIS-1019",
                "Terms": ["Fall 2025", "Spring 2025"],
                "Sub-Accounts": ["College of Sciences", "Center for Laboratory Sciences"],
                "Teachers": [{ "Name": "Drew Martinez", "Initials": "DM" }, { "Name": "Sage Cooper", "Initials": "SC" }],
                "Status": "Unpublished",
                "Visibility": "Private",
                "Students": 24,
                "Type": { "template": false, "blueprint": false },
                "Start Date": "08-20-2025",
                "Archive": false,
                "Archived Date": null
            }
        ];

        // Pagination Class (from pagination.md documentation)
        class Pagination {
            constructor(containerId, options = {}) {
                this.container = document.getElementById(containerId);
                this.currentPage = options.currentPage || 1;
                this.totalPages = options.totalPages || 1;
                this.onPageChange = options.onPageChange || (() => { });
                this.input = null;

                this.render();
                this.attachEventListeners();
            }

            render() {
                this.container.innerHTML = `
                    <button class="btn btn--icon-only-minimal btn--medium" data-action="first" ${this.currentPage === 1 ? 'disabled' : ''} aria-label="First page">
                        <span class="btn-icon" style="mask-image: var(--icon-arrow-double-left-outline);" aria-hidden="true"></span>
                    </button>
                    <button class="btn btn--icon-only-minimal btn--medium" data-action="prev" ${this.currentPage === 1 ? 'disabled' : ''} aria-label="Previous page">
                        <span class="btn-icon" style="mask-image: var(--icon-chevron-left-outline);" aria-hidden="true"></span>
                    </button>
                    <input 
                        type="text"
                        class="pagination-input" 
                        value="${this.currentPage}" 
                        aria-label="Page number"
                    >
                    <span class="pagination-total">of ${this.totalPages}</span>
                    <button class="btn btn--icon-only-minimal btn--medium" data-action="next" ${this.currentPage === this.totalPages ? 'disabled' : ''} aria-label="Next page">
                        <span class="btn-icon" style="mask-image: var(--icon-chevron-right-outline);" aria-hidden="true"></span>
                    </button>
                    <button class="btn btn--icon-only-minimal btn--medium" data-action="last" ${this.currentPage === this.totalPages ? 'disabled' : ''} aria-label="Last page">
                        <span class="btn-icon" style="mask-image: var(--icon-arrow-double-right-outline);" aria-hidden="true"></span>
                    </button>
                `;
            }

            attachEventListeners() {
                this.input = this.container.querySelector('.pagination-input');

                // Use event delegation for buttons
                this.container.addEventListener('click', (e) => {
                    const button = e.target.closest('.btn[data-action]');
                    if (button) {
                        this.handleButtonClick(button.dataset.action);
                    }
                });

                this.input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        this.handleInputChange(parseInt(e.target.value));
                    }
                });

                this.input.addEventListener('blur', (e) => {
                    this.handleInputChange(parseInt(e.target.value));
                });

                this.input.addEventListener('focus', (e) => {
                    e.target.select();
                });
            }

            handleButtonClick(action) {
                let newPage = this.currentPage;

                switch (action) {
                    case 'first':
                        newPage = 1;
                        break;
                    case 'prev':
                        newPage = Math.max(1, this.currentPage - 1);
                        break;
                    case 'next':
                        newPage = Math.min(this.totalPages, this.currentPage + 1);
                        break;
                    case 'last':
                        newPage = this.totalPages;
                        break;
                }

                if (newPage !== this.currentPage) {
                    this.goToPage(newPage);
                }
            }

            handleInputChange(pageNumber) {
                if (isNaN(pageNumber) || pageNumber < 1 || pageNumber > this.totalPages) {
                    // Reset input to current page if invalid
                    this.input.value = this.currentPage;
                    return;
                }

                if (pageNumber !== this.currentPage) {
                    this.goToPage(pageNumber);
                }
            }

            goToPage(pageNumber) {
                this.currentPage = pageNumber;
                this.updateUI();
                this.onPageChange(pageNumber);
            }

            updateUI() {
                // Update button states without full re-render
                const buttons = this.container.querySelectorAll('.btn');
                const [firstBtn, prevBtn, nextBtn, lastBtn] = buttons;

                firstBtn.disabled = prevBtn.disabled = this.currentPage === 1;
                nextBtn.disabled = lastBtn.disabled = this.currentPage === this.totalPages;

                // Update input and total
                this.input.value = this.currentPage;
                this.container.querySelector('.pagination-total').textContent = `of ${this.totalPages}`;
            }

            setTotalPages(totalPages) {
                this.totalPages = totalPages;
                if (this.currentPage > totalPages) {
                    this.currentPage = totalPages;
                }
                this.updateUI();
            }

            getCurrentPage() {
                return this.currentPage;
            }

            // Legacy method for backward compatibility
            updatePagination(currentPage, totalPages) {
                this.currentPage = currentPage;
                this.totalPages = totalPages;
                this.updateUI();
            }
        }

        // =============================================================================
        // MODULAR TABLE SYSTEM
        // =============================================================================

        // Core Column Definition Class
        class Column {
            constructor(config) {
                this.key = config.key;
                this.label = config.label;
                this.width = config.width || 'auto';
                this.renderer = config.renderer || 'text';
                this.sortable = config.sortable !== false;
                this.searchable = config.searchable !== false;
                this.alignment = config.alignment || 'left';
                this.config = config;
            }

            render(value, rowData, context = {}) {
                const renderContext = context.context || 'table-cell';

                switch (this.renderer) {
                    case 'course-name':
                        // Generate type labels based on Type object
                        let typeLabels = [];
                        if (rowData.Type && typeof rowData.Type === 'object') {
                            if (rowData.Type.blueprint) typeLabels.push('Blueprint');
                            if (rowData.Type.template) typeLabels.push('Template');
                        }
                        const typeText = typeLabels.length > 0 ? typeLabels.join(' | ') : '';

                        // Build secondary info line with SIS ID and type info
                        let secondaryInfo = rowData['SIS ID'] || '';
                        if (typeText) {
                            secondaryInfo = secondaryInfo ? `${secondaryInfo} | ${typeText}` : typeText;
                        }

                        if (renderContext === 'card-header') {
                            // In card headers, show course name and secondary information
                            return `
                                <div>
                                    <strong><a href="#" class="table-link-primary">${value}</a></strong>
                                    ${secondaryInfo ? `<div style="font-size: 0.875rem; color: var(--color-text-secondary); margin-top: 4px; font-weight: normal;">
                                        ${secondaryInfo}
                                    </div>` : ''}
                                </div>
                            `;
                        } else {
                            // In table cells, show course name with secondary info below
                            return `
                                <div class="table-cell-content">
                                    <strong><a href="#" class="table-link-primary">${value}</a></strong>
                                    ${secondaryInfo ? `<div class="table-cell-secondary">${secondaryInfo}</div>` : ''}
                                </div>
                            `;
                        }

                    case 'status-badge':
                        let iconMask, iconColor;
                        switch (value) {
                            case 'Published':
                                iconMask = '--icon-publish-solid';
                                iconColor = 'var(--color-success)';
                                break;
                            case 'Unpublished':
                                iconMask = '--icon-unpublish-outline';
                                iconColor = 'var(--color-text-primary)';
                                break;
                            case 'Concluded':
                                iconMask = '--icon-calendar-reserved-outline';
                                iconColor = 'var(--color-info)';
                                break;
                            default:
                                iconMask = '--icon-unpublish-outline';
                                iconColor = 'var(--color-neutral)';
                        }
                        return `<span class="icon icon-18" style="mask-image: var(${iconMask}); background-color: ${iconColor};" aria-label="${value}" title="${value}"></span>`;
                    case 'boolean-icon':
                        if (value === true) {
                            return `<span class="icon icon-18" style="mask-image: var(--icon-check-outline); background-color: var(--color-success);" aria-label="Yes" title="Yes"></span>`;
                        } else if (value === false) {
                            return `<span class="icon icon-18" style="mask-image: var(--icon-close-outline); background-color: var(--color-text-secondary);" aria-label="No" title="No"></span>`;
                        } else {
                            return `<span class="icon icon-18" style="mask-image: var(--icon-help-outline); background-color: var(--color-text-secondary);" aria-label="Unknown" title="Unknown"></span>`;
                        }
                    case 'type-object':
                        if (!value || typeof value !== 'object') {
                            return `<span class="text-secondary"></span>`;
                        }

                        let enabledTypes = [];
                        if (value.blueprint) enabledTypes.push('Blueprint');
                        if (value.template) enabledTypes.push('Template');

                        if (enabledTypes.length === 0) {
                            return `<span class="text-secondary"></span>`;
                        }

                        return enabledTypes.join(' | ');
                    case 'phone-link':
                        return `<a href="tel:${value}" class="table-link">${value}</a>`;

                    case 'link':
                        return `<a href="#" class="table-link">${value}</a>`;

                    case 'array-list':
                        if (Array.isArray(value)) {
                            if (value.length === 0) return 'None';
                            return value.map(item => `<a href="#" class="table-link">${item}</a>`).join(', ');
                        }
                        return value || 'None';

                    case 'teachers-list':
                        if (!Array.isArray(value) || value.length === 0) return 'None';
                        return `<div style="display: flex; flex-direction: column; gap: var(--spacing-4);">${value.map(teacher =>
                            `<div style="display: flex; align-items: center; gap: var(--spacing-8);">
                                <div class="avatar avatar--initials avatar--xxsmall" title="${teacher.Name}">${teacher.Initials}</div>
                                <a href="#" class="table-link" style="font-size: var(--font-size-body-small);">${teacher.Name}</a>
                            </div>`
                        ).join('')}</div>`;

                    case 'archived-date':
                        if (!value || value === null) {
                            return `<span class="text-secondary"></span>`;
                        }
                        return value;

                    case 'text':
                    default:
                        return value;
                }
            }

            getWidth() {
                return this.width;
            }

            getAlignmentClass() {
                return `table-cell--text-${this.alignment}`;
            }

            getHeaderAlignmentClass() {
                return `table-header--text-${this.alignment}`;
            }
        }

        // Column Manager
        class ColumnManager {
            constructor(columnDefs) {
                this.columns = columnDefs.map(def => new Column(def));
                this.selectedColumns = [];
                this.availableColumns = [...this.columns];
            }

            setSelectedColumns(columnKeys) {
                this.selectedColumns = columnKeys.map(key =>
                    this.columns.find(col => col.key === key)
                ).filter(Boolean);
            }

            getSelectedColumns() {
                return this.selectedColumns;
            }

            getAllColumns() {
                return this.columns;
            }

            getColumnByKey(key) {
                return this.columns.find(col => col.key === key);
            }

            reorderColumns(columnKeys) {
                // Reorder the selected columns based on the new order, but don't change which columns are selected
                const currentSelectedKeys = this.selectedColumns.map(col => col.key);
                const reorderedSelectedKeys = columnKeys.filter(key => currentSelectedKeys.includes(key));

                this.selectedColumns = reorderedSelectedKeys.map(key =>
                    this.columns.find(col => col.key === key)
                ).filter(Boolean);
            }
        }

        // Data Adapter
        class DataAdapter {
            constructor(config) {
                // Handle both array and object formats
                if (Array.isArray(config)) {
                    this.rawData = config;
                    this.primaryKey = 'id';
                } else {
                    this.rawData = config.data || [];
                    this.primaryKey = config.primaryKey || 'id';
                    this.transformer = config.transformer;
                }
            }

            getData() {
                return this.transformer ? this.transformer(this.rawData) : this.rawData;
            }

            getById(id) {
                return this.rawData.find(item => item[this.primaryKey] === id);
            }

            search(data, term, searchableFields) {
                if (!term) return data;

                const lowerTerm = term.toLowerCase();
                return data.filter(item =>
                    searchableFields.some(field => {
                        const value = item[field];

                        // Handle array fields (Terms, Sub-Accounts, Teachers)
                        if (Array.isArray(value)) {
                            if (field === 'Teachers') {
                                // For Teachers array, search in teacher names
                                return value.some(teacher =>
                                    teacher.Name && teacher.Name.toLowerCase().includes(lowerTerm)
                                );
                            } else {
                                // For other arrays (Terms, Sub-Accounts), search in array values
                                return value.some(item =>
                                    String(item).toLowerCase().includes(lowerTerm)
                                );
                            }
                        } else {
                            // Handle single value fields
                            return String(value || '').toLowerCase().includes(lowerTerm);
                        }
                    })
                );
            }

            filter(data, filters) {
                return data.filter(item => {
                    return Object.entries(filters).every(([field, values]) => {
                        if (!values || (Array.isArray(values) && values.length === 0)) return true;

                        // Handle date range filtering
                        if (field === 'dateRange') {
                            if (!values.from && !values.to) return true;

                            const itemDate = new Date(item['Start Date']);
                            const fromDate = values.from ? new Date(values.from) : null;
                            const toDate = values.to ? new Date(values.to) : null;

                            if (fromDate && itemDate < fromDate) return false;
                            if (toDate && itemDate > toDate) return false;
                            return true;
                        }

                        // Handle visibility filter
                        if (field === 'visibility') {
                            return values.some(filterValue => {
                                if (filterValue === 'public') {
                                    return item.Visibility === 'Public' || item.Students > 0;
                                } else if (filterValue === 'private') {
                                    return item.Visibility === 'Private' || item.Students === 0;
                                }
                                return item.Visibility === filterValue;
                            });
                        }

                        // Handle teachers filter
                        if (field === 'teachers') {
                            const teachers = item.Teachers || [];
                            return values.some(filterValue =>
                                teachers.some(teacher => teacher.Name === filterValue)
                            );
                        }

                        // Handle students filter
                        if (field === 'students') {
                            return values.some(filterValue => {
                                if (filterValue === 'with-students') {
                                    return item.Students > 0;
                                } else if (filterValue === 'without-students') {
                                    return item.Students === 0;
                                }
                                return false;
                            });
                        }

                        // Handle course type filter
                        if (field === 'courseType') {
                            return values.some(filterValue => {
                                if (filterValue === 'blueprint') {
                                    return item.Type && item.Type.blueprint === true;
                                } else if (filterValue === 'template') {
                                    return item.Type && item.Type.template === true;
                                }
                                return false;
                            });
                        }

                        // Map filter field names to data field names
                        const dataFieldMap = {
                            'status': 'Status',
                            'type': 'Type',
                            'terms': 'Terms',
                            'subaccounts': 'Sub-Accounts'
                        };

                        const dataField = dataFieldMap[field] || field;
                        const itemValue = item[dataField];

                        // Handle array fields (Terms, Sub-Accounts)
                        if (Array.isArray(itemValue)) {
                            return values.some(filterValue => itemValue.includes(filterValue));
                        } else {
                            // Handle single value fields (Status, Type)
                            return values.includes(itemValue);
                        }
                    });
                });
            }

            sort(data, column, direction) {
                if (!column) return data;

                return [...data].sort((a, b) => {
                    let aVal = a[column];
                    let bVal = b[column];

                    // Handle array fields by converting to string for comparison
                    if (Array.isArray(aVal)) {
                        aVal = aVal.join(', ');
                    }
                    if (Array.isArray(bVal)) {
                        bVal = bVal.join(', ');
                    }

                    // Handle null/undefined values
                    if (aVal == null) aVal = '';
                    if (bVal == null) bVal = '';

                    // Convert to strings for consistent comparison
                    aVal = String(aVal).toLowerCase();
                    bVal = String(bVal).toLowerCase();

                    if (aVal < bVal) return direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return direction === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            paginate(data, page, itemsPerPage) {
                const startIndex = (page - 1) * itemsPerPage;
                return data.slice(startIndex, startIndex + itemsPerPage);
            }
        }

        // Filter Manager
        class FilterManager {
            constructor(config) {
                this.filters = {};
                this.filterConfigs = config || {};
            }

            setFilter(key, values) {
                // Handle different types of filter values
                if (values &&
                    ((Array.isArray(values) && values.length > 0) ||
                        (typeof values === 'object' && !Array.isArray(values) && Object.keys(values).some(k => values[k])))) {
                    this.filters[key] = values;
                } else {
                    delete this.filters[key];
                }
            }

            getFilters() {
                return { ...this.filters };
            }

            clearFilters() {
                this.filters = {};
            }

            hasActiveFilters() {
                return Object.keys(this.filters).length > 0;
            }

            getActiveFilterCount() {
                return Object.values(this.filters).reduce((count, values) => count + values.length, 0);
            }
        }

        // Responsive Manager
        class ResponsiveManager {
            constructor(config = {}) {
                this.breakpoint = config.breakpoint || 1212;
                this.strategy = config.strategy || 'cards';
                this.isResponsiveMode = false;
                this.mediaQuery = window.matchMedia(`(max-width: ${this.breakpoint}px)`);
            }

            init(onModeChange) {
                this.onModeChange = onModeChange;
                this.mediaQuery.addListener(this.handleMediaQueryChange.bind(this));
                this.handleMediaQueryChange(this.mediaQuery);
            }

            handleMediaQueryChange(e) {
                const wasResponsive = this.isResponsiveMode;
                this.isResponsiveMode = e.matches;

                if (wasResponsive !== this.isResponsiveMode && this.onModeChange) {
                    this.onModeChange(this.isResponsiveMode);
                }
            }

            shouldShowCards() {
                return this.isResponsiveMode && this.strategy === 'cards';
            }
        }

        // Selection Manager
        class SelectionManager {
            constructor() {
                this.selectedItems = new Set();
                this.onSelectionChange = null;
            }

            setOnSelectionChange(callback) {
                this.onSelectionChange = callback;
            }

            select(id) {
                this.selectedItems.add(id);
                this.notifyChange();
            }

            deselect(id) {
                this.selectedItems.delete(id);
                this.notifyChange();
            }

            toggle(id) {
                if (this.selectedItems.has(id)) {
                    this.deselect(id);
                } else {
                    this.select(id);
                }
            }

            selectAll(ids) {
                ids.forEach(id => this.selectedItems.add(id));
                this.notifyChange();
            }

            deselectAll() {
                this.selectedItems.clear();
                this.notifyChange();
            }

            isSelected(id) {
                return this.selectedItems.has(id);
            }

            getSelectedCount() {
                return this.selectedItems.size;
            }

            getSelectedIds() {
                return Array.from(this.selectedItems);
            }

            notifyChange() {
                if (this.onSelectionChange) {
                    this.onSelectionChange({
                        selectedIds: this.getSelectedIds(),
                        selectedCount: this.getSelectedCount()
                    });
                }
            }
        }

        // Field Configuration Manager
        class FieldConfigurationManager {
            constructor(dataTable) {
                this.dataTable = dataTable;
                this.selectedFields = [];
                this.availableFields = [];
                this.originalSelectedFields = null;
                this.originalAvailableFields = null;

                // Initialize from DataTable
                this.syncWithDataTable();
                this.setupEventListeners();
            }

            syncWithDataTable() {
                this.selectedFields = this.dataTable.getSelectedFields();
                const allFields = this.dataTable.getAvailableFields();

                // Exclude "Archived Date" from main table configuration - it's only for archived table
                const filteredFields = allFields.filter(field => field !== 'Archived Date');

                // Order fields to show default selected fields first, then remaining fields
                const defaultFields = ['Name', 'Terms', 'Teachers', 'Students', 'Status', 'Start Date'];
                const remainingFields = filteredFields.filter(field => !defaultFields.includes(field));
                this.availableFields = [...defaultFields.filter(field => filteredFields.includes(field)), ...remainingFields];
            }

            saveOriginalConfiguration() {
                this.originalSelectedFields = [...this.selectedFields];
                this.originalAvailableFields = [...this.availableFields];
            }

            restoreOriginalConfiguration() {
                if (this.originalSelectedFields && this.originalAvailableFields) {
                    this.selectedFields = [...this.originalSelectedFields];
                    this.availableFields = [...this.originalAvailableFields];
                    this.dataTable.setSelectedFields(this.selectedFields);
                    this.dataTable.columnManager.reorderColumns(this.availableFields);
                    this.renderFieldConfigList();
                }
            }

            resetToDefaults() {
                // Reset to default field configuration
                this.selectedFields = ['Name', 'Terms', 'Teachers', 'Students', 'Status', 'Start Date'];
                // Order availableFields to show default columns first, then remaining fields
                this.availableFields = ['Name', 'Terms', 'Teachers', 'Students', 'Status', 'Start Date', 'SIS ID', 'Sub-Accounts', 'Visibility', 'Type'];
                this.dataTable.setSelectedFields(this.selectedFields);
                this.dataTable.columnManager.reorderColumns(this.availableFields);
                this.renderFieldConfigList();
            }

            applyConfiguration() {
                // Apply current configuration to DataTable
                this.dataTable.setSelectedFields(this.selectedFields);
                this.dataTable.columnManager.reorderColumns(this.availableFields);
            }

            toggleField(fieldName, isChecked) {
                // Prevent unchecking the Name field - it's always required
                if (fieldName === 'Name' && !isChecked) {
                    const checkbox = document.querySelector(`input[data-field="${fieldName}"]`);
                    if (checkbox) checkbox.checked = true;
                    return;
                }

                if (isChecked) {
                    if (this.selectedFields.length >= 8) {
                        // Prevent checking if already at limit
                        const checkbox = document.querySelector(`input[data-field="${fieldName}"]`);
                        if (checkbox) checkbox.checked = false;
                        return;
                    }
                    if (!this.selectedFields.includes(fieldName)) {
                        this.selectedFields.push(fieldName);
                    }
                } else {
                    const index = this.selectedFields.indexOf(fieldName);
                    if (index > -1) {
                        this.selectedFields.splice(index, 1);
                    }
                }

                this.renderFieldConfigList();
            }

            moveFieldUp(fieldName) {
                const currentIndex = this.availableFields.indexOf(fieldName);
                if (currentIndex > 0) {
                    // Swap with the item above
                    [this.availableFields[currentIndex], this.availableFields[currentIndex - 1]] =
                        [this.availableFields[currentIndex - 1], this.availableFields[currentIndex]];

                    // Update selected fields order if this field is selected
                    if (this.selectedFields.includes(fieldName)) {
                        this.updateSelectedFieldsOrder();
                    }

                    this.renderFieldConfigList();
                }
            }

            moveFieldDown(fieldName) {
                const currentIndex = this.availableFields.indexOf(fieldName);
                if (currentIndex < this.availableFields.length - 1) {
                    // Swap with the item below
                    [this.availableFields[currentIndex], this.availableFields[currentIndex + 1]] =
                        [this.availableFields[currentIndex + 1], this.availableFields[currentIndex]];

                    // Update selected fields order if this field is selected
                    if (this.selectedFields.includes(fieldName)) {
                        this.updateSelectedFieldsOrder();
                    }

                    this.renderFieldConfigList();
                }
            }

            updateSelectedFieldsOrder() {
                // Reorder selectedFields to match availableFields order
                const newSelectedFields = [];
                this.availableFields.forEach(field => {
                    if (this.selectedFields.includes(field)) {
                        newSelectedFields.push(field);
                    }
                });
                this.selectedFields = newSelectedFields;
            }

            renderFieldConfigList() {
                const container = document.getElementById('fieldConfigList');
                if (!container) return;

                container.innerHTML = '';
                container.setAttribute('role', 'listbox');
                container.setAttribute('aria-label', 'Available table fields - use arrow keys to navigate, Enter to toggle selection, Up/Down arrows to reorder');

                // Render all fields in their original order, maintaining selection state
                this.availableFields.forEach(field => {
                    const isSelected = this.selectedFields.includes(field) || field === 'Name'; // Name is always selected
                    const fieldItem = this.createFieldConfigItem(field, isSelected);
                    container.appendChild(fieldItem);
                });

                this.updateFieldCount();
                this.updateMoveButtonStates();
            }

            createFieldConfigItem(field, isSelected) {
                const fieldItem = document.createElement('div');
                const isDisabled = !isSelected && this.selectedFields.length >= 8;
                const isRequired = field === 'Name'; // Name field is always required

                fieldItem.className = `card card--padding-compact card--white field-config-item ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''} ${isRequired ? 'required' : ''}`;
                fieldItem.dataset.field = field;
                fieldItem.draggable = true;
                fieldItem.tabIndex = 0; // Make focusable
                fieldItem.setAttribute('role', 'option');
                fieldItem.setAttribute('aria-label', `${this.getFieldDisplayName(field)} field - ${isSelected ? 'selected' : 'not selected'}${isRequired ? ' (required)' : ''}`);
                fieldItem.setAttribute('aria-selected', isSelected);

                fieldItem.innerHTML = `
                    <div class="card-content">
                        <div class="field-config-content">
                            <span class="field-drag-handle icon icon-20" style="mask-image: var(--icon-drag-handle-outline);" aria-hidden="true"></span>
                            <div class="field-checkbox-wrapper">
                                <label class="form-checkbox-label">
                                    <input type="checkbox" class="form-checkbox field-checkbox" 
                                           data-field="${field}" 
                                           ${isSelected ? 'checked' : ''} 
                                           ${isDisabled || isRequired ? 'disabled' : ''}
                                           tabindex="-1">
                                    <span class="form-checkbox-custom"></span>
                                    <span class="sr-only">${isRequired ? 'Required field' : (isSelected ? 'Deselect' : 'Select')} ${this.getFieldDisplayName(field)} field</span>
                                </label>
                            </div>
                            <div class="field-name-container">
                                <div class="field-name-group">
                                    <span class="field-name">${this.getFieldDisplayName(field)}</span>
                                </div>
                            </div>
                            <div class="field-reorder-buttons">
                                <button class="btn btn--icon-only-minimal btn--small field-move-up" data-field="${field}" aria-label="Move ${this.getFieldDisplayName(field)} up" tabindex="-1">
                                    <span class="btn-icon" style="mask-image: var(--icon-arrow-up-outline);" aria-hidden="true"></span>
                                </button>
                                <button class="btn btn--icon-only-minimal btn--small field-move-down" data-field="${field}" aria-label="Move ${this.getFieldDisplayName(field)} down" tabindex="-1">
                                    <span class="btn-icon" style="mask-image: var(--icon-arrow-down-outline);" aria-hidden="true"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                return fieldItem;
            }

            updateMoveButtonStates() {
                const items = document.querySelectorAll('.field-config-item');
                items.forEach((item, index) => {
                    const upButton = item.querySelector('.field-move-up');
                    const downButton = item.querySelector('.field-move-down');

                    if (upButton) {
                        if (index === 0) {
                            upButton.disabled = true;
                            upButton.setAttribute('aria-disabled', 'true');
                        } else {
                            upButton.disabled = false;
                            upButton.setAttribute('aria-disabled', 'false');
                        }
                    }

                    if (downButton) {
                        if (index === items.length - 1) {
                            downButton.disabled = true;
                            downButton.setAttribute('aria-disabled', 'true');
                        } else {
                            downButton.disabled = false;
                            downButton.setAttribute('aria-disabled', 'false');
                        }
                    }
                });
            }

            updateFieldCount() {
                const selectedCount = this.selectedFields.length;
                const maxFields = 8;

                // Update the count display
                const fieldCountEl = document.getElementById('selectedFieldsCount');
                if (fieldCountEl) {
                    fieldCountEl.textContent = `${selectedCount} of ${maxFields} selected`;
                }

                // Update the progress bar
                const progressFillEl = document.getElementById('fieldProgressFill');
                if (progressFillEl) {
                    const progressPercentage = (selectedCount / maxFields) * 100;
                    progressFillEl.style.width = `${progressPercentage}%`;
                }
            }

            getFieldDisplayName(field) {
                const column = this.dataTable.columnManager.getColumnByKey(field);
                return column ? column.label : field;
            }

            setupEventListeners() {
                // Checkbox change events - scoped to main container
                document.addEventListener('change', (e) => {
                    if (e.target.classList.contains('field-checkbox') &&
                        e.target.closest('#fieldConfigList')) {
                        const fieldName = e.target.dataset.field;
                        this.toggleField(fieldName, e.target.checked);
                    }
                });

                // Up/Down button events - scoped to main container
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.field-move-up') &&
                        e.target.closest('#fieldConfigList')) {
                        const fieldName = e.target.closest('.field-move-up').dataset.field;
                        this.moveFieldUp(fieldName);
                        e.preventDefault();
                        e.stopPropagation();
                    }

                    if (e.target.closest('.field-move-down') &&
                        e.target.closest('#fieldConfigList')) {
                        const fieldName = e.target.closest('.field-move-down').dataset.field;
                        this.moveFieldDown(fieldName);
                        e.preventDefault();
                        e.stopPropagation();
                    }
                });

                // Keyboard navigation - scoped to main container
                document.addEventListener('keydown', (e) => {
                    const focusedItem = document.activeElement;
                    if (!focusedItem || !focusedItem.classList.contains('field-config-item') ||
                        !focusedItem.closest('#fieldConfigList')) {
                        return;
                    }

                    const fieldName = focusedItem.dataset.field;
                    const allItems = Array.from(document.querySelectorAll('#fieldConfigList .field-config-item'));
                    const currentIndex = allItems.indexOf(focusedItem);

                    switch (e.key) {
                        case 'Enter':
                        case ' ':
                            e.preventDefault();
                            const checkbox = focusedItem.querySelector('.field-checkbox');
                            if (checkbox && !checkbox.disabled) {
                                checkbox.checked = !checkbox.checked;
                                this.toggleField(fieldName, checkbox.checked);
                                // Restore focus after DOM re-render
                                setTimeout(() => {
                                    const restoredItem = document.querySelector(`#fieldConfigList [data-field="${fieldName}"]`);
                                    if (restoredItem) restoredItem.focus();
                                }, 50);
                            }
                            break;

                        case 'ArrowUp':
                            e.preventDefault();
                            this.moveFieldUp(fieldName);
                            // Keep focus on the moved item
                            setTimeout(() => {
                                const movedItem = document.querySelector(`#fieldConfigList [data-field="${fieldName}"]`);
                                if (movedItem) movedItem.focus();
                            }, 50);
                            break;

                        case 'ArrowDown':
                            e.preventDefault();
                            this.moveFieldDown(fieldName);
                            // Keep focus on the moved item
                            setTimeout(() => {
                                const movedItem = document.querySelector(`#fieldConfigList [data-field="${fieldName}"]`);
                                if (movedItem) movedItem.focus();
                            }, 50);
                            break;

                        case 'ArrowLeft':
                        case 'ArrowRight':
                            // Navigate between items
                            e.preventDefault();
                            let nextIndex;
                            if (e.key === 'ArrowLeft') {
                                nextIndex = currentIndex > 0 ? currentIndex - 1 : allItems.length - 1;
                            } else {
                                nextIndex = currentIndex < allItems.length - 1 ? currentIndex + 1 : 0;
                            }
                            allItems[nextIndex].focus();
                            break;
                    }
                });

                // Drag and drop for reordering
                this.setupDragAndDrop();
            }

            setupDragAndDrop() {
                let draggedElement = null;

                document.addEventListener('dragstart', (e) => {
                    // Allow dragging from the entire field config item in main container only
                    if (e.target.classList.contains('field-config-item') &&
                        e.target.closest('#fieldConfigList')) {
                        draggedElement = e.target;
                        draggedElement.classList.add('dragging');
                        e.dataTransfer.effectAllowed = 'move';

                        // Create a simple, properly sized drag image
                        const dragImage = document.createElement('div');
                        dragImage.textContent = draggedElement.querySelector('.field-name').textContent;
                        dragImage.style.cssText = `
                            position: absolute;
                            top: -1000px;
                            left: -1000px;
                            background: var(--color-background-primary);
                            border: 1px solid var(--color-border-primary);
                            border-radius: var(--spacing-radius-default);
                            padding: var(--spacing-8) var(--spacing-12);
                            font-size: var(--font-size-body);
                            color: var(--color-text-primary);
                            z-index: 1000;
                        `;
                        document.body.appendChild(dragImage);
                        e.dataTransfer.setDragImage(dragImage, 10, 10);

                        setTimeout(() => document.body.removeChild(dragImage), 0);
                    }
                });

                document.addEventListener('dragend', (e) => {
                    if (draggedElement && draggedElement.closest('#fieldConfigList')) {
                        draggedElement.classList.remove('dragging');
                        draggedElement = null;
                    }
                });

                document.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });

                document.addEventListener('drop', (e) => {
                    e.preventDefault();

                    if (draggedElement && draggedElement.closest('#fieldConfigList')) {
                        const container = document.getElementById('fieldConfigList');
                        if (!container.contains(e.target)) return;

                        // Find all non-dragging items and determine drop position
                        const items = Array.from(container.querySelectorAll('.field-config-item:not(.dragging)'));
                        let dropTarget = null;
                        let insertBefore = true;

                        for (let i = 0; i < items.length; i++) {
                            const item = items[i];
                            const rect = item.getBoundingClientRect();
                            const midpoint = rect.top + rect.height / 2;

                            if (e.clientY < midpoint) {
                                dropTarget = item;
                                insertBefore = true;
                                break;
                            }
                        }

                        // If no drop target found, append at the end
                        if (!dropTarget && items.length > 0) {
                            dropTarget = items[items.length - 1];
                            insertBefore = false;
                        }

                        // Perform the insertion and update field order
                        if (dropTarget) {
                            const movedFieldName = draggedElement.dataset.field;
                            const targetFieldName = dropTarget.dataset.field;

                            // Update availableFields array
                            const movedIndex = this.availableFields.indexOf(movedFieldName);
                            const targetIndex = this.availableFields.indexOf(targetFieldName);

                            if (movedIndex !== -1) {
                                // Remove from current position
                                this.availableFields.splice(movedIndex, 1);

                                // Insert at new position
                                let newIndex = targetIndex;
                                if (movedIndex < targetIndex) newIndex--; // Adjust for removal
                                if (!insertBefore) newIndex++;

                                this.availableFields.splice(newIndex, 0, movedFieldName);

                                // Update selected fields order if this field is selected
                                if (this.selectedFields.includes(movedFieldName)) {
                                    this.updateSelectedFieldsOrder();
                                }

                                this.renderFieldConfigList();
                            }
                        }
                    }
                });
            }
        }

        // Archived Field Configuration Manager
        class ArchivedFieldConfigurationManager {
            constructor(dataTable) {
                this.dataTable = dataTable;
                this.containerSelector = '#archivedFieldConfigList';
                this.progressCountSelector = '#archivedSelectedFieldsCount';
                this.progressFillSelector = '#archivedFieldProgressFill';

                // Create independent copies of the data structures
                this.selectedFields = [];
                this.availableFields = [];
                this.originalSelectedFields = null;
                this.originalAvailableFields = null;

                // Initialize from DataTable independently
                this.syncWithDataTable();
                this.setupEventListeners();
            }

            syncWithDataTable() {
                // Set default selected fields for archived table to match table config: Name, Terms, Teachers, Start Date, Archived Date
                this.selectedFields = ['Name', 'Terms', 'Teachers', 'Start Date', 'Archived Date'];
                const allFields = this.dataTable.getAvailableFields();

                // Order fields to show default selected fields first, then remaining fields
                const defaultFields = ['Name', 'Terms', 'Teachers', 'Start Date', 'Archived Date', 'Students', 'Status'];
                const remainingFields = allFields.filter(field => !defaultFields.includes(field));
                this.availableFields = [...defaultFields.filter(field => allFields.includes(field)), ...remainingFields];
            }

            renderFieldConfigList() {
                const container = document.querySelector(this.containerSelector);
                if (!container) return;

                container.innerHTML = '';
                container.setAttribute('role', 'listbox');
                container.setAttribute('aria-label', 'Available archived table fields - use arrow keys to navigate, Enter to toggle selection, Up/Down arrows to reorder');

                // Render all fields in their original order, maintaining selection state
                this.availableFields.forEach(field => {
                    const isSelected = this.selectedFields.includes(field) || field === 'Name'; // Name is always selected
                    const fieldItem = this.createFieldConfigItem(field, isSelected);
                    container.appendChild(fieldItem);
                });

                this.updateFieldCount();
                this.updateMoveButtonStates();
            }

            updateFieldCount() {
                const selectedCount = this.selectedFields.length;
                const maxFields = 8;

                // Update the count display
                const fieldCountEl = document.querySelector(this.progressCountSelector);
                if (fieldCountEl) {
                    fieldCountEl.textContent = `${selectedCount} of ${maxFields} selected`;
                }

                // Update the progress bar
                const progressFillEl = document.querySelector(this.progressFillSelector);
                if (progressFillEl) {
                    const progressPercentage = (selectedCount / maxFields) * 100;
                    progressFillEl.style.width = `${progressPercentage}%`;
                }
            }

            updateMoveButtonStates() {
                const items = document.querySelectorAll(`${this.containerSelector} .field-config-item`);
                items.forEach((item, index) => {
                    const upButton = item.querySelector('.field-move-up');
                    const downButton = item.querySelector('.field-move-down');

                    if (upButton) {
                        if (index === 0) {
                            upButton.disabled = true;
                            upButton.setAttribute('aria-disabled', 'true');
                        } else {
                            upButton.disabled = false;
                            upButton.setAttribute('aria-disabled', 'false');
                        }
                    }

                    if (downButton) {
                        if (index === items.length - 1) {
                            downButton.disabled = true;
                            downButton.setAttribute('aria-disabled', 'true');
                        } else {
                            downButton.disabled = false;
                            downButton.setAttribute('aria-disabled', 'false');
                        }
                    }
                });
            }

            saveOriginalConfiguration() {
                this.originalSelectedFields = [...this.selectedFields];
                this.originalAvailableFields = [...this.availableFields];
            }

            restoreOriginalConfiguration() {
                if (this.originalSelectedFields && this.originalAvailableFields) {
                    this.selectedFields = [...this.originalSelectedFields];
                    this.availableFields = [...this.originalAvailableFields];
                    this.dataTable.setSelectedFields(this.selectedFields);
                    this.dataTable.columnManager.reorderColumns(this.availableFields);
                    this.renderFieldConfigList();
                }
            }

            resetToDefaults() {
                // Reset to default field configuration for archived table to match table config
                this.selectedFields = ['Name', 'Terms', 'Teachers', 'Start Date', 'Archived Date'];
                // Order availableFields to show default columns first, then remaining fields
                this.availableFields = ['Name', 'Terms', 'Teachers', 'Start Date', 'Archived Date', 'Students', 'Status', 'SIS ID', 'Sub-Accounts', 'Visibility', 'Type'];
                this.dataTable.setSelectedFields(this.selectedFields);
                this.dataTable.columnManager.reorderColumns(this.availableFields);
                this.renderFieldConfigList();
            }

            applyConfiguration() {
                // Apply current configuration to DataTable
                this.dataTable.setSelectedFields(this.selectedFields);
                this.dataTable.columnManager.reorderColumns(this.availableFields);
            }

            toggleField(fieldName, isChecked) {
                // Prevent unchecking the Name field - it's always required
                if (fieldName === 'Name' && !isChecked) {
                    const checkbox = document.querySelector(`${this.containerSelector} input[data-field="${fieldName}"]`);
                    if (checkbox) checkbox.checked = true;
                    return;
                }

                if (isChecked) {
                    if (this.selectedFields.length >= 8) {
                        // Prevent checking if already at limit
                        const checkbox = document.querySelector(`${this.containerSelector} input[data-field="${fieldName}"]`);
                        if (checkbox) checkbox.checked = false;
                        return;
                    }
                    if (!this.selectedFields.includes(fieldName)) {
                        this.selectedFields.push(fieldName);
                    }
                } else {
                    const index = this.selectedFields.indexOf(fieldName);
                    if (index > -1) {
                        this.selectedFields.splice(index, 1);
                    }
                }

                this.renderFieldConfigList();
            }

            moveFieldUp(fieldName) {
                const currentIndex = this.availableFields.indexOf(fieldName);
                if (currentIndex > 0) {
                    // Swap with the item above
                    [this.availableFields[currentIndex], this.availableFields[currentIndex - 1]] =
                        [this.availableFields[currentIndex - 1], this.availableFields[currentIndex]];

                    // Update selected fields order if this field is selected
                    if (this.selectedFields.includes(fieldName)) {
                        this.updateSelectedFieldsOrder();
                    }

                    this.renderFieldConfigList();
                }
            }

            moveFieldDown(fieldName) {
                const currentIndex = this.availableFields.indexOf(fieldName);
                if (currentIndex < this.availableFields.length - 1) {
                    // Swap with the item below
                    [this.availableFields[currentIndex], this.availableFields[currentIndex + 1]] =
                        [this.availableFields[currentIndex + 1], this.availableFields[currentIndex]];

                    // Update selected fields order if this field is selected
                    if (this.selectedFields.includes(fieldName)) {
                        this.updateSelectedFieldsOrder();
                    }

                    this.renderFieldConfigList();
                }
            }

            updateSelectedFieldsOrder() {
                // Reorder selectedFields to match availableFields order
                const newSelectedFields = [];
                this.availableFields.forEach(field => {
                    if (this.selectedFields.includes(field)) {
                        newSelectedFields.push(field);
                    }
                });
                this.selectedFields = newSelectedFields;
            }

            createFieldConfigItem(field, isSelected) {
                const fieldItem = document.createElement('div');
                const isDisabled = !isSelected && this.selectedFields.length >= 8;
                const isRequired = field === 'Name'; // Name field is always required

                fieldItem.className = `card card--padding-compact card--white field-config-item ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''} ${isRequired ? 'required' : ''}`;
                fieldItem.dataset.field = field;
                fieldItem.draggable = true;
                fieldItem.tabIndex = 0; // Make focusable
                fieldItem.setAttribute('role', 'option');
                fieldItem.setAttribute('aria-label', `${this.getFieldDisplayName(field)} field - ${isSelected ? 'selected' : 'not selected'}${isRequired ? ' (required)' : ''}`);
                fieldItem.setAttribute('aria-selected', isSelected);

                fieldItem.innerHTML = `
                    <div class="card-content">
                        <div class="field-config-content">
                            <span class="field-drag-handle icon icon-20" style="mask-image: var(--icon-drag-handle-outline);" aria-hidden="true"></span>
                            <div class="field-checkbox-wrapper">
                                <label class="form-checkbox-label">
                                    <input type="checkbox" class="form-checkbox field-checkbox" 
                                           data-field="${field}" 
                                           ${isSelected ? 'checked' : ''} 
                                           ${isDisabled || isRequired ? 'disabled' : ''}
                                           tabindex="-1">
                                    <span class="form-checkbox-custom"></span>
                                    <span class="sr-only">${isRequired ? 'Required field' : (isSelected ? 'Deselect' : 'Select')} ${this.getFieldDisplayName(field)} field</span>
                                </label>
                            </div>
                            <div class="field-name-container">
                                <div class="field-name-group">
                                    <span class="field-name">${this.getFieldDisplayName(field)}</span>
                                </div>
                            </div>
                            <div class="field-reorder-buttons">
                                <button class="btn btn--icon-only-minimal btn--small field-move-up" data-field="${field}" aria-label="Move ${this.getFieldDisplayName(field)} up" tabindex="-1">
                                    <span class="btn-icon" style="mask-image: var(--icon-arrow-up-outline);" aria-hidden="true"></span>
                                </button>
                                <button class="btn btn--icon-only-minimal btn--small field-move-down" data-field="${field}" aria-label="Move ${this.getFieldDisplayName(field)} down" tabindex="-1">
                                    <span class="btn-icon" style="mask-image: var(--icon-arrow-down-outline);" aria-hidden="true"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                return fieldItem;
            }

            getFieldDisplayName(field) {
                const column = this.dataTable.columnManager.getColumnByKey(field);
                return column ? column.label : field;
            }

            setupEventListeners() {
                // Checkbox change events - scoped to archived container
                document.addEventListener('change', (e) => {
                    if (e.target.classList.contains('field-checkbox') &&
                        e.target.closest(this.containerSelector)) {
                        const fieldName = e.target.dataset.field;
                        this.toggleField(fieldName, e.target.checked);
                    }
                });

                // Up/Down button events - scoped to archived container
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.field-move-up') &&
                        e.target.closest(this.containerSelector)) {
                        const fieldName = e.target.closest('.field-move-up').dataset.field;
                        this.moveFieldUp(fieldName);
                        e.preventDefault();
                        e.stopPropagation();
                    }

                    if (e.target.closest('.field-move-down') &&
                        e.target.closest(this.containerSelector)) {
                        const fieldName = e.target.closest('.field-move-down').dataset.field;
                        this.moveFieldDown(fieldName);
                        e.preventDefault();
                        e.stopPropagation();
                    }
                });

                // Keyboard navigation - scoped to archived container
                document.addEventListener('keydown', (e) => {
                    const focusedItem = document.activeElement;
                    if (!focusedItem || !focusedItem.classList.contains('field-config-item') ||
                        !focusedItem.closest(this.containerSelector)) {
                        return;
                    }

                    const fieldName = focusedItem.dataset.field;
                    const allItems = Array.from(document.querySelectorAll(`${this.containerSelector} .field-config-item`));
                    const currentIndex = allItems.indexOf(focusedItem);

                    switch (e.key) {
                        case 'Enter':
                        case ' ':
                            e.preventDefault();
                            const checkbox = focusedItem.querySelector('.field-checkbox');
                            if (checkbox && !checkbox.disabled) {
                                checkbox.checked = !checkbox.checked;
                                this.toggleField(fieldName, checkbox.checked);
                                // Restore focus after DOM re-render
                                setTimeout(() => {
                                    const restoredItem = document.querySelector(`${this.containerSelector} [data-field="${fieldName}"]`);
                                    if (restoredItem) restoredItem.focus();
                                }, 50);
                            }
                            break;

                        case 'ArrowUp':
                            e.preventDefault();
                            this.moveFieldUp(fieldName);
                            // Keep focus on the moved item
                            setTimeout(() => {
                                const movedItem = document.querySelector(`${this.containerSelector} [data-field="${fieldName}"]`);
                                if (movedItem) movedItem.focus();
                            }, 50);
                            break;

                        case 'ArrowDown':
                            e.preventDefault();
                            this.moveFieldDown(fieldName);
                            // Keep focus on the moved item
                            setTimeout(() => {
                                const movedItem = document.querySelector(`${this.containerSelector} [data-field="${fieldName}"]`);
                                if (movedItem) movedItem.focus();
                            }, 50);
                            break;

                        case 'ArrowLeft':
                        case 'ArrowRight':
                            // Navigate between items
                            e.preventDefault();
                            let nextIndex;
                            if (e.key === 'ArrowLeft') {
                                nextIndex = currentIndex > 0 ? currentIndex - 1 : allItems.length - 1;
                            } else {
                                nextIndex = currentIndex < allItems.length - 1 ? currentIndex + 1 : 0;
                            }
                            allItems[nextIndex].focus();
                            break;
                    }
                });

                // Drag and drop for reordering - scoped to archived container
                this.setupDragAndDrop();
            }

            setupDragAndDrop() {
                let draggedElement = null;

                document.addEventListener('dragstart', (e) => {
                    // Only handle drag events from archived container
                    if (e.target.classList.contains('field-config-item') &&
                        e.target.closest(this.containerSelector)) {
                        draggedElement = e.target;
                        draggedElement.classList.add('dragging');
                        e.dataTransfer.effectAllowed = 'move';

                        // Create a simple, properly sized drag image
                        const dragImage = document.createElement('div');
                        dragImage.textContent = draggedElement.querySelector('.field-name').textContent;
                        dragImage.style.cssText = `
                            position: absolute;
                            top: -1000px;
                            left: -1000px;
                            background: var(--color-background-primary);
                            border: 1px solid var(--color-border-primary);
                            border-radius: var(--spacing-radius-default);
                            padding: var(--spacing-8) var(--spacing-12);
                            font-size: var(--font-size-body);
                            color: var(--color-text-primary);
                            z-index: 1000;
                        `;
                        document.body.appendChild(dragImage);
                        e.dataTransfer.setDragImage(dragImage, 10, 10);

                        setTimeout(() => document.body.removeChild(dragImage), 0);
                    }
                });

                document.addEventListener('dragend', (e) => {
                    if (draggedElement && draggedElement.closest(this.containerSelector)) {
                        draggedElement.classList.remove('dragging');
                        draggedElement = null;
                    }
                });

                document.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });

                document.addEventListener('drop', (e) => {
                    e.preventDefault();

                    if (draggedElement && draggedElement.closest(this.containerSelector)) {
                        const container = document.querySelector(this.containerSelector);
                        if (!container.contains(e.target)) return;

                        // Find all non-dragging items and determine drop position
                        const items = Array.from(container.querySelectorAll('.field-config-item:not(.dragging)'));
                        let dropTarget = null;
                        let insertBefore = true;

                        for (let i = 0; i < items.length; i++) {
                            const item = items[i];
                            const rect = item.getBoundingClientRect();
                            const midpoint = rect.top + rect.height / 2;

                            if (e.clientY < midpoint) {
                                dropTarget = item;
                                insertBefore = true;
                                break;
                            }
                        }

                        // If no drop target found, append at the end
                        if (!dropTarget && items.length > 0) {
                            dropTarget = items[items.length - 1];
                            insertBefore = false;
                        }

                        // Perform the insertion and update field order
                        if (dropTarget) {
                            const movedFieldName = draggedElement.dataset.field;
                            const targetFieldName = dropTarget.dataset.field;

                            // Update availableFields array
                            const movedIndex = this.availableFields.indexOf(movedFieldName);
                            const targetIndex = this.availableFields.indexOf(targetFieldName);

                            if (movedIndex !== -1) {
                                // Remove from current position
                                this.availableFields.splice(movedIndex, 1);

                                // Insert at new position
                                let newIndex = targetIndex;
                                if (movedIndex < targetIndex) newIndex--; // Adjust for removal
                                if (!insertBefore) newIndex++;

                                this.availableFields.splice(newIndex, 0, movedFieldName);

                                // Update selected fields order if this field is selected
                                if (this.selectedFields.includes(movedFieldName)) {
                                    this.updateSelectedFieldsOrder();
                                }

                                this.renderFieldConfigList();
                            }
                        }
                    }
                });
            }
        }

        // Core DataTable Class
        class DataTable {
            constructor(config) {
                this.config = config;

                // Initialize managers
                this.columnManager = new ColumnManager(config.columns);
                this.dataAdapter = new DataAdapter(config.data);
                this.filterManager = new FilterManager(config.filters);
                this.responsiveManager = new ResponsiveManager(config.responsive);
                this.selectionManager = new SelectionManager();

                // Field configuration manager (initialized after setup)
                this.fieldConfigManager = null;

                // State
                this.currentSort = { column: null, direction: null };
                this.searchTerm = '';
                this.currentPage = 1;
                this.itemsPerPage = config.pagination?.defaultSize || 15;
                this.pagination = null;

                // Set initial selected columns
                this.columnManager.setSelectedColumns(config.defaultColumns || []);

                // Setup selection callback
                this.selectionManager.setOnSelectionChange(this.handleSelectionChange.bind(this));

                // Flag to prevent duplicate event listeners
                this.tableEventListenersAttached = false;
            }

            init() {
                this.cacheElements();
                this.setupEventListeners();
                this.setupTableEvents(); // Setup event delegation once
                this.setupResponsive();
                this.setupPagination();

                // Initialize field configuration manager
                this.fieldConfigManager = new FieldConfigurationManager(this);

                this.render();
            }

            cacheElements() {
                this.elements = {
                    searchInput: document.getElementById('table-search'),
                    tableContainer: document.querySelector('.table-container'),
                    cardsContainer: document.querySelector('.table-cards'),
                    mobileSelectAll: document.querySelector('.mobile-select-all'),
                    emptyState: document.getElementById('emptyState'),
                    resultsCount: document.getElementById('resultsCount'),
                    selectedCount: document.getElementById('selectedCount'),
                    selectAllCheckbox: document.getElementById('select-all-checkbox'),
                    mobileSelectAllCheckbox: document.getElementById('mobile-select-all-checkbox'),
                    bulkActions: document.getElementById('bulkActions'),
                    bulkPublish: document.getElementById('bulkPublish'),
                    bulkConclude: document.getElementById('bulkConclude'),
                    bulkArchive: document.getElementById('bulkArchive'),
                    bulkMore: document.getElementById('bulkMore')
                };

            }

            setupEventListeners() {
                // Search - Use unified filter manager
                if (this.elements.searchInput) {
                    this.elements.searchInput.addEventListener('input', (e) => {
                        unifiedFilterManager.setSearch(e.target.value);
                    });
                }

                // Desktop Select All - use delegation since it gets recreated
                // Handled in setupTableEvents() instead

                // Mobile Select All
                if (this.elements.mobileSelectAllCheckbox) {
                    this.elements.mobileSelectAllCheckbox.addEventListener('change', (e) => {
                        e.stopPropagation();
                        this.handleSelectAllToggle(e.target.checked, 'mobile');
                    });
                }

                // Items per page
                const itemsPerPageSelect = document.getElementById('itemsPerPage');
                if (itemsPerPageSelect) {
                    itemsPerPageSelect.addEventListener('change', (e) => {
                        this.itemsPerPage = parseInt(e.target.value);
                        this.currentPage = 1;
                        this.render();
                    });
                }

                // Filter functionality
                this.setupFilters();

                // Bulk actions
                this.setupBulkActions();
            }

            setupFilters() {
                // Filter button to open tray
                const filterBtn = document.getElementById('filter-btn');
                if (filterBtn) {
                    filterBtn.addEventListener('click', () => {
                        trayManager.open('filterTray');
                    });
                }

                // Apply filters button - Use unified filter manager
                const applyFiltersBtn = document.getElementById('applyFiltersBtn');
                if (applyFiltersBtn) {
                    applyFiltersBtn.addEventListener('click', () => {
                        this.applyFiltersFromTray();
                        trayManager.close();
                    });
                }

                // Clear filters button - Use unified filter manager
                const clearFiltersBtn = document.getElementById('clearFiltersBtn');
                if (clearFiltersBtn) {
                    clearFiltersBtn.addEventListener('click', () => {
                        unifiedFilterManager.clearAllFilters();
                    });
                }

                // Cancel filters button
                const cancelFilterBtn = document.getElementById('cancelFilterBtn');
                if (cancelFilterBtn) {
                    cancelFilterBtn.addEventListener('click', () => {
                        trayManager.close();
                    });
                }

                // Date range filters - add real-time filtering
                const startDateFrom = document.getElementById('start-date-from');
                const startDateTo = document.getElementById('start-date-to');

                if (startDateFrom) {
                    startDateFrom.addEventListener('change', () => {
                        this.applyDateRangeFilter();
                    });
                }

                if (startDateTo) {
                    startDateTo.addEventListener('change', () => {
                        this.applyDateRangeFilter();
                    });
                }

                // Checkbox filters - Use unified filter manager for real-time filtering
                // Status checkboxes
                document.querySelectorAll('.filter-status').forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        this.applyCheckboxFilters();
                    });
                });

                // Visibility checkboxes
                document.querySelectorAll('.filter-visibility').forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        this.applyCheckboxFilters();
                    });
                });

                // Students checkboxes
                document.querySelectorAll('.filter-students').forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        this.applyCheckboxFilters();
                    });
                });

                // Course Type checkboxes
                document.querySelectorAll('.filter-course-type').forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        this.applyCheckboxFilters();
                    });
                });
            }

            applyFiltersFromTray() {
                // Get selected status filters
                const statusCheckboxes = document.querySelectorAll('.filter-status:checked');
                const selectedStatuses = Array.from(statusCheckboxes).map(cb => cb.value);
                unifiedFilterManager.setFilter('status', selectedStatuses);

                // Get selected visibility filters
                const visibilityCheckboxes = document.querySelectorAll('.filter-visibility:checked');
                const selectedVisibility = Array.from(visibilityCheckboxes).map(cb => cb.value);
                unifiedFilterManager.setFilter('visibility', selectedVisibility);

                // Get selected students filters
                const studentsCheckboxes = document.querySelectorAll('.filter-students:checked');
                const selectedStudents = Array.from(studentsCheckboxes).map(cb => cb.value);
                unifiedFilterManager.setFilter('students', selectedStudents);

                // Get selected course type filters
                const courseTypeCheckboxes = document.querySelectorAll('.filter-course-type:checked');
                const selectedCourseTypes = Array.from(courseTypeCheckboxes).map(cb => cb.value);
                unifiedFilterManager.setFilter('courseType', selectedCourseTypes);

                // Get multiselect filter values using the new API
                const termsInput = document.getElementById('filter-terms');
                const subaccountsInput = document.getElementById('filter-subaccounts');
                const teachersInput = document.getElementById('filter-teachers');

                unifiedFilterManager.setFilter('terms', termsInput ? termsInput.value.split(',').filter(v => v) : []);
                unifiedFilterManager.setFilter('subaccounts', subaccountsInput ? subaccountsInput.value.split(',').filter(v => v) : []);
                unifiedFilterManager.setFilter('teachers', teachersInput ? teachersInput.value.split(',').filter(v => v) : []);

                // Get date range filters
                const startDateFrom = document.getElementById('start-date-from')?.value;
                const startDateTo = document.getElementById('start-date-to')?.value;

                if (startDateFrom || startDateTo) {
                    unifiedFilterManager.setFilter('dateRange', { from: startDateFrom, to: startDateTo });
                } else {
                    unifiedFilterManager.setFilter('dateRange', []);
                }
            }

            applyFiltersToArchivedTable() {
                if (!window.archivedDataTable) return;

                try {
                    // Get the same filter values from the UI (don't copy from main table)
                    const statusCheckboxes = document.querySelectorAll('.filter-status:checked');
                    const selectedStatuses = Array.from(statusCheckboxes).map(cb => cb.value);
                    window.archivedDataTable.filterManager.setFilter('status', selectedStatuses);

                    const visibilityCheckboxes = document.querySelectorAll('.filter-visibility:checked');
                    const selectedVisibility = Array.from(visibilityCheckboxes).map(cb => cb.value);
                    window.archivedDataTable.filterManager.setFilter('visibility', selectedVisibility);

                    const studentsCheckboxes = document.querySelectorAll('.filter-students:checked');
                    const selectedStudents = Array.from(studentsCheckboxes).map(cb => cb.value);
                    window.archivedDataTable.filterManager.setFilter('students', selectedStudents);

                    const courseTypeCheckboxes = document.querySelectorAll('.filter-course-type:checked');
                    const selectedCourseTypes = Array.from(courseTypeCheckboxes).map(cb => cb.value);
                    window.archivedDataTable.filterManager.setFilter('courseType', selectedCourseTypes);

                    const termsInput = document.getElementById('filter-terms');
                    const subaccountsInput = document.getElementById('filter-subaccounts');
                    const teachersInput = document.getElementById('filter-teachers');

                    window.archivedDataTable.filterManager.setFilter('terms', termsInput ? termsInput.value.split(',').filter(v => v) : []);
                    window.archivedDataTable.filterManager.setFilter('subaccounts', subaccountsInput ? subaccountsInput.value.split(',').filter(v => v) : []);
                    window.archivedDataTable.filterManager.setFilter('teachers', teachersInput ? teachersInput.value.split(',').filter(v => v) : []);

                    const startDateFrom = document.getElementById('start-date-from')?.value;
                    const startDateTo = document.getElementById('start-date-to')?.value;

                    if (startDateFrom || startDateTo) {
                        window.archivedDataTable.filterManager.setFilter('dateRange', { from: startDateFrom, to: startDateTo });
                    } else {
                        window.archivedDataTable.filterManager.setFilter('dateRange', []);
                    }

                    // Apply search term to archived table
                    window.archivedDataTable.searchTerm = this.searchTerm;

                    // Reset archived table to first page and re-render
                    window.archivedDataTable.currentPage = 1;
                    window.archivedDataTable.render();
                } catch (error) {
                    console.error('Error applying filters to archived table:', error);
                    // If there's an error, try to render the archived table without filters
                    try {
                        window.archivedDataTable.filterManager.clearFilters();
                        window.archivedDataTable.searchTerm = '';
                        window.archivedDataTable.currentPage = 1;
                        window.archivedDataTable.render();
                    } catch (fallbackError) {
                        console.error('Failed to render archived table even without filters:', fallbackError);
                    }
                }
            }

            syncFiltersToArchivedTable() {
                // DISABLE SYNC COMPLETELY TO GET BACK TO WORKING STATE
                return;
            }

            applyDateRangeFilter() {
                // Get date range values
                const startDateFrom = document.getElementById('start-date-from')?.value;
                const startDateTo = document.getElementById('start-date-to')?.value;

                // Use unified filter manager
                if (startDateFrom || startDateTo) {
                    unifiedFilterManager.setFilter('dateRange', { from: startDateFrom, to: startDateTo });
                } else {
                    unifiedFilterManager.setFilter('dateRange', []);
                }
            }

            applyCheckboxFilters() {
                // Get selected status filters
                const statusCheckboxes = document.querySelectorAll('.filter-status:checked');
                const selectedStatuses = Array.from(statusCheckboxes).map(cb => cb.value);
                unifiedFilterManager.setFilter('status', selectedStatuses);

                // Get selected visibility filters
                const visibilityCheckboxes = document.querySelectorAll('.filter-visibility:checked');
                const selectedVisibility = Array.from(visibilityCheckboxes).map(cb => cb.value);
                unifiedFilterManager.setFilter('visibility', selectedVisibility);

                // Get selected students filters
                const studentsCheckboxes = document.querySelectorAll('.filter-students:checked');
                const selectedStudents = Array.from(studentsCheckboxes).map(cb => cb.value);
                unifiedFilterManager.setFilter('students', selectedStudents);

                // Get selected course type filters
                const courseTypeCheckboxes = document.querySelectorAll('.filter-course-type:checked');
                const selectedCourseTypes = Array.from(courseTypeCheckboxes).map(cb => cb.value);
                unifiedFilterManager.setFilter('courseType', selectedCourseTypes);
            }

            clearAllFilters() {
                // Clear all filter checkboxes
                document.querySelectorAll('#filterTray input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });

                // Clear date inputs
                document.querySelectorAll('#filterTray input[type="date"]').forEach(input => {
                    input.value = '';
                });

                // Clear multiselect filters using new API
                document.querySelectorAll('[data-multiselect]').forEach(multiselect => {
                    const instance = multiselect.multiselectInstance;
                    if (instance) {
                        instance.clear(true);
                    }
                });

                // Clear filter manager
                this.filterManager.clearFilters();

                // Reset to first page and re-render
                this.currentPage = 1;
                this.render();
                this.updateActiveFilterTags();

                // Apply cleared filters to archived table
                this.applyFiltersToArchivedTable();
            }

            updateActiveFilterTags() {
                // Unified filter manager handles this now
                // This method is kept for compatibility but does nothing
                return;
            }

            createSearchTag(searchTerm) {
                const tag = document.createElement('span');
                tag.className = 'tag tag--medium tag--dismissable';

                tag.innerHTML = `
                    <span class="tag__text">Search: "${searchTerm}"</span>
                    <button class="tag__close" aria-label="Clear search">
                        <span class="tag__close-icon"></span>
                    </button>
                `;

                // Add click handler for search removal
                const closeBtn = tag.querySelector('.tag__close');
                closeBtn.addEventListener('click', () => {
                    this.clearSearch();
                });

                return tag;
            }

            clearSearch() {
                this.searchTerm = '';
                if (this.elements.searchInput) {
                    this.elements.searchInput.value = '';
                }
                this.currentPage = 1;
                this.render();

                // Apply search clearing to archived table
                this.applyFiltersToArchivedTable();
            }

            clearAllFiltersAndSearch() {
                unifiedFilterManager.clearAllFilters();
            }

            createFilterTag(filterType, value) {
                const tag = document.createElement('span');
                tag.className = 'tag tag--medium tag--dismissable';

                // Create display label based on filter type
                let displayLabel = value;
                if (filterType === 'status') {
                    displayLabel = `Status: ${value}`;
                } else if (filterType === 'visibility') {
                    displayLabel = `Visibility: ${value === 'public' ? 'Public (>0 enrollments)' : 'Private (0 enrollments)'}`;
                } else if (filterType === 'terms') {
                    displayLabel = `Term: ${value}`;
                } else if (filterType === 'subaccounts') {
                    displayLabel = `Sub-Account: ${value}`;
                } else if (filterType === 'teachers') {
                    displayLabel = `Teacher: ${value}`;
                } else if (filterType === 'students') {
                    displayLabel = value === 'with-students' ? 'Students: With students' : 'Students: Without students';
                } else if (filterType === 'courseType') {
                    displayLabel = value === 'blueprint' ? 'Type: Blueprint' : 'Type: Template';
                } else if (filterType === 'dateRange') {
                    if (value.from && value.to) {
                        displayLabel = `Date: ${value.from} to ${value.to}`;
                    } else if (value.from) {
                        displayLabel = `Date: from ${value.from}`;
                    } else if (value.to) {
                        displayLabel = `Date: to ${value.to}`;
                    }
                }

                tag.innerHTML = `
                    <span class="tag__text">${displayLabel}</span>
                    <button class="tag__close" aria-label="Remove ${displayLabel}">
                        <span class="tag__close-icon"></span>
                    </button>
                `;

                // Add click handler for tag removal
                const closeBtn = tag.querySelector('.tag__close');
                closeBtn.addEventListener('click', () => {
                    this.removeFilter(filterType, value);
                });

                return tag;
            }

            removeFilter(filterType, value) {
                if (filterType === 'dateRange') {
                    // Clear date range inputs
                    document.getElementById('start-date-from').value = '';
                    document.getElementById('start-date-to').value = '';
                    this.filterManager.setFilter(filterType, []);
                } else if (['terms', 'subaccounts', 'teachers'].includes(filterType)) {
                    // Handle multiselect filters using new API
                    const multiselectElement = document.querySelector(`[data-multiselect]:has(#filter-${filterType})`);
                    if (multiselectElement && multiselectElement.multiselectInstance) {
                        multiselectElement.multiselectInstance.removeValue(value, true);

                        // Update filter manager
                        const hiddenInput = document.getElementById(`filter-${filterType}`);
                        const currentValues = hiddenInput ? hiddenInput.value.split(',').filter(v => v) : [];
                        this.filterManager.setFilter(filterType, currentValues);
                    }
                } else {
                    // Handle checkbox filters
                    const currentFilters = this.filterManager.getFilters()[filterType] || [];
                    const updatedFilters = currentFilters.filter(v => v !== value);

                    // Update filter manager
                    this.filterManager.setFilter(filterType, updatedFilters);

                    // Update corresponding checkbox
                    const checkbox = document.querySelector(`.filter-${filterType}[value="${value}"]`);
                    if (checkbox) {
                        checkbox.checked = false;
                    }
                }

                // Re-render and update tags
                this.currentPage = 1;
                this.render();
                this.updateActiveFilterTags();

                // Apply filter changes to archived table
                this.applyFiltersToArchivedTable();
            }

            setupResponsive() {
                this.responsiveManager.init((isResponsive) => {
                    // Show/hide mobile select all button
                    if (this.elements.mobileSelectAll) {
                        this.elements.mobileSelectAll.style.display = isResponsive ? 'block' : 'none';
                    }

                    // Note: updateBothSelectAllCheckboxes will be called by render()
                    this.render();
                });
            }

            render() {
                const processedData = this.processData();

                // Check if we have results
                const hasResults = processedData.filtered.length > 0;

                // Always show table/cards structure and hide separate empty state
                this.showTableContent();
                this.hideEmptyState();

                if (hasResults) {
                    // Render normal content
                    this.renderTable(processedData.paginated);
                    this.renderCards(processedData.paginated);
                } else {
                    // Render empty state inside table/cards
                    this.renderTableEmptyState();
                    this.renderCardsEmptyState();
                }

                // Update both select-all checkboxes after rendering
                this.updateBothSelectAllCheckboxes();
                this.updateResultsInfo(processedData);
                this.updatePagination(processedData.filtered.length);
                this.updateActiveFilterTags();
            }

            showTableContent() {
                if (this.elements.tableContainer) {
                    this.elements.tableContainer.style.display = '';
                }
                if (this.elements.cardsContainer) {
                    this.elements.cardsContainer.style.display = '';
                }
                const pagination = document.getElementById('tablePagination');
                if (pagination) {
                    pagination.style.display = 'flex';
                }
            }

            hideTableContent() {
                if (this.elements.tableContainer) {
                    this.elements.tableContainer.style.display = 'none';
                }
                if (this.elements.cardsContainer) {
                    this.elements.cardsContainer.style.display = 'none';
                }
                const pagination = document.getElementById('tablePagination');
                if (pagination) {
                    pagination.style.display = 'none';
                }
            }

            showEmptyState() {
                if (!this.elements.emptyState) return;

                this.elements.emptyState.style.display = 'block';

                // Update empty state message based on active filters/search
                const emptyStateMessage = document.getElementById('emptyStateMessage');
                const clearSearchBtn = document.getElementById('clearSearchBtn');
                const clearAllFiltersBtn = document.getElementById('clearAllFiltersBtn');

                if (emptyStateMessage) {
                    const hasSearch = this.searchTerm && this.searchTerm.trim();
                    const hasFilters = this.filterManager.hasActiveFilters();

                    if (hasSearch && hasFilters) {
                        emptyStateMessage.textContent = `No results found for "${this.searchTerm}" with the current filters applied.`;
                    } else if (hasSearch) {
                        emptyStateMessage.textContent = `No results found for "${this.searchTerm}". Try adjusting your search term.`;
                    } else if (hasFilters) {
                        emptyStateMessage.textContent = 'No results found. Try adjusting your filter criteria.';
                    } else {
                        emptyStateMessage.textContent = 'No data available.';
                    }
                }

                // Show/hide action buttons based on what's active
                if (clearSearchBtn) {
                    clearSearchBtn.style.display = this.searchTerm ? 'inline-flex' : 'none';
                    clearSearchBtn.onclick = () => this.clearSearch();
                }

                if (clearAllFiltersBtn) {
                    clearAllFiltersBtn.style.display = this.filterManager.hasActiveFilters() ? 'inline-flex' : 'none';
                    clearAllFiltersBtn.onclick = () => this.clearAllFilters();
                }
            }

            hideEmptyState() {
                if (this.elements.emptyState) {
                    this.elements.emptyState.style.display = 'none';
                }
            }

            processData() {
                let data = this.dataAdapter.getData();

                // Search
                const searchableFields = this.columnManager.getSelectedColumns()
                    .filter(col => col.searchable)
                    .map(col => col.key);
                data = this.dataAdapter.search(data, this.searchTerm, searchableFields);

                // Filter
                data = this.dataAdapter.filter(data, this.filterManager.getFilters());

                // Sort
                data = this.dataAdapter.sort(data, this.currentSort.column, this.currentSort.direction);

                // Paginate
                const paginated = this.dataAdapter.paginate(data, this.currentPage, this.itemsPerPage);

                return {
                    raw: this.dataAdapter.getData(),
                    filtered: data,
                    paginated: paginated
                };
            }

            renderTable(data) {
                this.updateTableHeaders();
                this.generateTableRows(data);
                // Event listeners are handled by event delegation, no need to reattach
            }

            renderCards(data) {
                this.generateCardRows(data);
                // Event listeners are handled by event delegation, no need to reattach
            }

            renderTableEmptyState() {
                this.updateTableHeaders();

                // Use the table container from this specific table instance
                const tbody = this.elements.tableContainer ? 
                    this.elements.tableContainer.querySelector('.table tbody') : 
                    document.querySelector('.table tbody');
                if (!tbody) return;

                const columnCount = this.columnManager.getSelectedColumns().length + 2; // +2 for checkbox and actions
                const emptyMessage = this.getEmptyStateMessage();

                tbody.innerHTML = `
                    <tr>
                        <td colspan="${columnCount}" style="padding: var(--spacing-16);">
                            <div class="card card--white empty-state">
                                <div class="card-content">
                                    <div class="empty-state-content">
                                        <div class="empty-state-text">
                                            <h3>No results found</h3>
                                            <p>${emptyMessage}</p>
                                        </div>
                                        <div class="empty-state-actions">
                                            <button class="btn btn--secondary btn--medium" id="clearSearchBtnTable" style="display: ${this.searchTerm ? 'inline-flex' : 'none'};">Clear search</button>
                                            <button class="btn btn--secondary btn--medium" id="clearAllFiltersBtnTable" style="display: ${this.filterManager.hasActiveFilters() ? 'inline-flex' : 'none'};">Clear filters</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                `;

                // Add event listeners for the buttons
                const clearSearchBtn = document.getElementById('clearSearchBtnTable');
                const clearAllFiltersBtn = document.getElementById('clearAllFiltersBtnTable');

                if (clearSearchBtn) {
                    clearSearchBtn.onclick = () => this.clearSearch();
                }
                if (clearAllFiltersBtn) {
                    clearAllFiltersBtn.onclick = () => this.clearAllFilters();
                }
            }

            renderCardsEmptyState() {
                const cardsContainer = this.elements.cardsContainer;
                if (!cardsContainer) return;

                const emptyMessage = this.getEmptyStateMessage();

                cardsContainer.innerHTML = `
                    <div class="card card--primary empty-state">
                        <div class="card-content">
                            <div class="empty-state-content">
                                <div class="empty-state-text">
                                    <h3>No results found</h3>
                                    <p>${emptyMessage}</p>
                                </div>
                                <div class="empty-state-actions">
                                    <button class="btn btn--secondary btn--medium" id="clearSearchBtnCards" style="display: ${this.searchTerm ? 'inline-flex' : 'none'};">Clear search</button>
                                    <button class="btn btn--secondary btn--medium" id="clearAllFiltersBtnCards" style="display: ${this.filterManager.hasActiveFilters() ? 'inline-flex' : 'none'};">Clear filters</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Add event listeners for the buttons
                const clearSearchBtn = document.getElementById('clearSearchBtnCards');
                const clearAllFiltersBtn = document.getElementById('clearAllFiltersBtnCards');

                if (clearSearchBtn) {
                    clearSearchBtn.onclick = () => this.clearSearch();
                }
                if (clearAllFiltersBtn) {
                    clearAllFiltersBtn.onclick = () => this.clearAllFilters();
                }
            }

            getEmptyStateMessage() {
                const hasSearch = this.searchTerm && this.searchTerm.trim() !== '';
                const hasFilters = this.filterManager.hasActiveFilters();

                if (hasSearch && hasFilters) {
                    return 'No results match your search and filter criteria. Try adjusting your search term or removing some filters.';
                } else if (hasSearch) {
                    return 'No results match your search. Try a different search term or check your spelling.';
                } else if (hasFilters) {
                    return 'No results match your current filters. Try removing some filters to see more results.';
                } else {
                    return 'No data available to display.';
                }
            }

            updateTableHeaders() {
                // Use the table container from this specific table instance
                const tableHeader = this.elements.tableContainer ? 
                    this.elements.tableContainer.querySelector('.table thead tr') : 
                    document.querySelector('.table thead tr');
                if (!tableHeader) return;

                tableHeader.innerHTML = '';

                // Checkbox column
                const checkboxHeader = document.createElement('th');
                checkboxHeader.className = 'table-header table-header--checkbox';
                checkboxHeader.innerHTML = `
                    <label class="form-checkbox-label">
                        <input type="checkbox" id="select-all-checkbox" class="form-checkbox">
                        <span class="form-checkbox-custom"></span>
                        <span class="sr-only">Select all courses</span>
                    </label>
                `;
                tableHeader.appendChild(checkboxHeader);

                // Column headers
                const selectedColumns = this.columnManager.getSelectedColumns();
                selectedColumns.forEach(column => {
                    const th = document.createElement('th');
                    th.className = column.sortable ? 'table-header table-header--sortable' : 'table-header';
                    th.classList.add(column.getHeaderAlignmentClass());
                    if (column.sortable) {
                        th.dataset.sort = column.key;
                    }

                    // Apply width styling
                    const width = column.getWidth();
                    if (width) {
                        if (width === 'flex') {
                            th.classList.add('table-header--flexible');
                            th.style.width = '';
                            th.style.flex = '1';
                        } else if (width === 'auto') {
                            th.style.width = 'auto';
                            th.style.flex = '0 0 auto';
                        } else {
                            // Fixed width (e.g., '120px', '15%')
                            th.style.width = width;
                            th.style.flex = '0 0 auto';
                        }
                    } else {
                        // Default to flexible if no width specified
                        th.classList.add('table-header--flexible');
                    }

                    if (column.sortable) {
                        th.innerHTML = `
                            <button class="table-sort-button" aria-label="Sort by ${column.label.toLowerCase()}">
                                ${column.label}
                                <span class="table-sort-icon icon icon-18" 
                                      style="mask-image: var(--icon-arrow-mini-double-outline);" 
                                      aria-hidden="true"></span>
                            </button>
                        `;
                    } else {
                        th.innerHTML = `<span class="table-sort-label">${column.label}</span>`;
                    }
                    tableHeader.appendChild(th);
                });

                // Actions column
                const actionsHeader = document.createElement('th');
                actionsHeader.className = 'table-header table-header--text-center';
                actionsHeader.innerHTML = '<span class="table-sort-label">Actions</span>';
                tableHeader.appendChild(actionsHeader);
            }

            generateTableRows(data) {
                // Use the table container from this specific table instance
                const tbody = this.elements.tableContainer ? 
                    this.elements.tableContainer.querySelector('.table tbody') : 
                    document.querySelector('.table tbody');
                if (!tbody) return;

                // Clear existing rows
                tbody.innerHTML = '';
                console.log('DEBUG: tbody cleared, about to create', data.length, 'rows');

                // Always generate table rows - CSS controls visibility
                data.forEach((item, index) => {
                    console.log('DEBUG: Creating row', index, 'for item:', item.Name);
                    const row = this.createTableRow(item);
                    tbody.appendChild(row);
                    console.log('DEBUG: Row appended to tbody');

                    // Check row styles
                    if (index === 0) {
                        console.log('DEBUG: First row display:', getComputedStyle(row).display);
                        console.log('DEBUG: First row visibility:', getComputedStyle(row).visibility);
                        console.log('DEBUG: First row height:', getComputedStyle(row).height);
                        console.log('DEBUG: First row opacity:', getComputedStyle(row).opacity);
                    }
                });

                console.log('DEBUG: All rows created, tbody now has', tbody.children.length, 'children');

                // Check table visibility
                const table = document.querySelector('#mainTable');
                const tableContainer = document.querySelector('.table-container');
                console.log('DEBUG: Window width:', window.innerWidth);
                console.log('DEBUG: Table display:', table ? getComputedStyle(table).display : 'table not found');
                console.log('DEBUG: Table visibility:', table ? getComputedStyle(table).visibility : 'table not found');
                console.log('DEBUG: Table container display:', tableContainer ? getComputedStyle(tableContainer).display : 'container not found');
                console.log('DEBUG: Table container visibility:', tableContainer ? getComputedStyle(tableContainer).visibility : 'container not found');

                // Check tbody styles
                console.log('DEBUG: tbody display:', getComputedStyle(tbody).display);
                console.log('DEBUG: tbody visibility:', getComputedStyle(tbody).visibility);
                console.log('DEBUG: tbody height:', getComputedStyle(tbody).height);
            }

            generateCardRows(data) {
                if (!this.elements.cardsContainer) return;

                // Clear existing cards
                this.elements.cardsContainer.innerHTML = '';

                // Always generate cards - CSS controls visibility
                data.forEach(item => {
                    const card = this.createCard(item);
                    this.elements.cardsContainer.appendChild(card);
                });
            }

            createTableRow(item) {
                const row = document.createElement('tr');
                row.className = 'table-row';
                row.dataset.id = item[this.dataAdapter.primaryKey];

                // Checkbox cell
                const checkboxCell = document.createElement('td');
                checkboxCell.className = 'table-cell table-cell--checkbox';
                checkboxCell.innerHTML = `
                    <label class="form-checkbox-label">
                        <input type="checkbox" class="form-checkbox row-checkbox" data-id="${item[this.dataAdapter.primaryKey]}">
                        <span class="form-checkbox-custom"></span>
                        <span class="sr-only">Select ${item.Name}</span>
                    </label>
                `;
                row.appendChild(checkboxCell);

                // Data cells
                this.columnManager.getSelectedColumns().forEach(column => {
                    const cell = document.createElement('td');
                    cell.className = `table-cell ${column.getAlignmentClass()} table-cell--flexible`;

                    // Apply fontSize if specified
                    if (column.config && column.config.fontSize) {
                        cell.classList.add(`table-cell--${column.config.fontSize}`);
                    }

                    cell.innerHTML = column.render(item[column.key], item, { table: this });
                    row.appendChild(cell);
                });

                // Actions cell
                const actionsCell = document.createElement('td');
                actionsCell.className = 'table-cell table-cell--text-center table-actions-cell';

                // Generate contextual menu items based on status and archive state
                const menuItems = this.generateActionMenuItems(item);
                const menuId = `action-menu-${item['SIS ID']}`;

                actionsCell.innerHTML = `
                    <div class="table-actions">
                        <div class="menu-container">
                            <button class="btn btn--icon-only-minimal btn--medium menu-trigger" 
                                    data-menu="${menuId}" 
                                    aria-haspopup="true" 
                                    aria-expanded="false" 
                                    aria-label="More actions for ${item.Name}">
                                <span class="btn-icon" style="mask-image: var(--icon-more-outline);" aria-hidden="true"></span>
                            </button>
                            
                            <div class="menu menu--right" id="${menuId}" role="menu" aria-hidden="true">
                                ${menuItems}
                            </div>
                        </div>
                    </div>
                `;
                row.appendChild(actionsCell);

                return row;
            }

            generateActionMenuItems(item) {
                const menuItems = [];

                // Always available actions
                menuItems.push(`
                    <div class="menu-item" role="menuitem" tabindex="-1" data-action="enroll" data-course-id="${item['SIS ID']}">
                        <span class="menu-item-icon" style="mask-image: var(--icon-add-outline);" aria-hidden="true"></span>
                        <span class="menu-item-text">Enroll User</span>
                    </div>
                `);

                menuItems.push(`
                    <div class="menu-item" role="menuitem" tabindex="-1" data-action="stats" data-course-id="${item['SIS ID']}">
                        <span class="menu-item-icon" style="mask-image: var(--icon-analytics-outline);" aria-hidden="true"></span>
                        <span class="menu-item-text">Stats</span>
                    </div>
                `);

                menuItems.push(`
                    <div class="menu-item" role="menuitem" tabindex="-1" data-action="settings" data-course-id="${item['SIS ID']}">
                        <span class="menu-item-icon" style="mask-image: var(--icon-settings-outline);" aria-hidden="true"></span>
                        <span class="menu-item-text">Settings</span>
                    </div>
                `);

                menuItems.push(`
                    <div class="menu-item" role="menuitem" tabindex="-1" data-action="copy" data-course-id="${item['SIS ID']}">
                        <span class="menu-item-icon" style="mask-image: var(--icon-copy-outline);" aria-hidden="true"></span>
                        <span class="menu-item-text">Copy</span>
                    </div>
                `);

                menuItems.push(`
                    <div class="menu-item" role="menuitem" tabindex="-1" data-action="download" data-course-id="${item['SIS ID']}">
                        <span class="menu-item-icon" style="mask-image: var(--icon-download-outline);" aria-hidden="true"></span>
                        <span class="menu-item-text">Download</span>
                    </div>
                `);

                // Remove separator to clean up the menu

                // Contextual actions based on status and archive state
                const status = item.Status;
                const isArchived = item.Archive;

                // Publish/Unpublish based on current status
                if (status === 'Unpublished') {
                    menuItems.push(`
                        <div class="menu-item" role="menuitem" tabindex="-1" data-action="publish" data-course-id="${item['SIS ID']}">
                            <span class="menu-item-icon" style="mask-image: var(--icon-publish-outline);" aria-hidden="true"></span>
                            <span class="menu-item-text">Publish</span>
                        </div>
                    `);
                } else if (status === 'Published') {
                    menuItems.push(`
                        <div class="menu-item" role="menuitem" tabindex="-1" data-action="unpublish" data-course-id="${item['SIS ID']}">
                            <span class="menu-item-icon" style="mask-image: var(--icon-unpublish-outline);" aria-hidden="true"></span>
                            <span class="menu-item-text">Unpublish</span>
                        </div>
                    `);
                }

                // Conclude/Un-Conclude based on current status
                if (status === 'Concluded') {
                    menuItems.push(`
                        <div class="menu-item" role="menuitem" tabindex="-1" data-action="unconclude" data-course-id="${item['SIS ID']}">
                            <span class="menu-item-icon" style="mask-image: var(--icon-calendar-clock-outline);" aria-hidden="true"></span>
                            <span class="menu-item-text">Un-Conclude</span>
                        </div>
                    `);
                } else {
                    menuItems.push(`
                        <div class="menu-item" role="menuitem" tabindex="-1" data-action="conclude" data-course-id="${item['SIS ID']}">
                            <span class="menu-item-icon" style="mask-image: var(--icon-calendar-reserved-outline);" aria-hidden="true"></span>
                            <span class="menu-item-text">Conclude</span>
                        </div>
                    `);
                }

                // Archive/Restore based on current archive state
                if (isArchived) {
                    menuItems.push(`
                        <div class="menu-item" role="menuitem" tabindex="-1" data-action="restore" data-course-id="${item['SIS ID']}">
                            <span class="menu-item-icon" style="mask-image: var(--icon-refresh-outline);" aria-hidden="true"></span>
                            <span class="menu-item-text">Restore</span>
                        </div>
                    `);
                } else {
                    menuItems.push(`
                        <div class="menu-item" role="menuitem" tabindex="-1" data-action="archive" data-course-id="${item['SIS ID']}">
                            <span class="menu-item-icon" style="mask-image: var(--icon-archive-outline);" aria-hidden="true"></span>
                            <span class="menu-item-text">Archive</span>
                        </div>
                    `);
                }

                return menuItems.join('');
            }

            createCard(item) {
                const card = document.createElement('div');
                card.className = 'card card--primary';
                card.dataset.id = item[this.dataAdapter.primaryKey];

                const selectedColumns = this.columnManager.getSelectedColumns();

                // Use Name as primary field if available, otherwise use first column
                const nameColumn = selectedColumns.find(col => col.key === 'Name');
                const primaryColumn = nameColumn || selectedColumns[0];

                // Filter secondary columns - exclude primary column
                const secondaryColumns = selectedColumns.filter(col => col !== primaryColumn);

                // Build header content using the primary column's renderer with card-header context
                let headerContent = '';

                if (primaryColumn) {
                    headerContent = primaryColumn.render(item[primaryColumn.key], item, {
                        table: this,
                        context: 'card-header'
                    });
                }

                // Build card content rows
                const cardRows = secondaryColumns.map(column => `
                    <div class="table-card-row">
                        <span class="table-card-label">${column.label}:</span>
                        <span>${column.render(item[column.key], item, { table: this })}</span>
                    </div>
                `).join('');

                card.innerHTML = `
                    <div class="card-header card-header--h4-small">
                        <div class="card-header-content">
                            <h4>${headerContent}</h4>
                        </div>
                        <div class="card-header-actions">
                            <label class="form-checkbox-label">
                                <input type="checkbox" class="form-checkbox card-checkbox" data-id="${item[this.dataAdapter.primaryKey]}">
                                <span class="form-checkbox-custom"></span>
                                <span class="sr-only">Select ${item.Name || 'item'}</span>
                            </label>
                            <div class="table-actions">
                                <div class="menu-container">
                                    <button class="btn btn--icon-only-minimal btn--medium menu-trigger" 
                                            data-menu="card-action-menu-${item['SIS ID']}" 
                                            aria-haspopup="true" 
                                            aria-expanded="false"
                                            aria-label="Actions for ${item.Name || 'course'}">
                                        <span class="btn-icon" style="mask-image: var(--icon-more-outline);" aria-hidden="true"></span>
                                    </button>
                                    
                                    <div class="menu" id="card-action-menu-${item['SIS ID']}" role="menu" aria-hidden="true">
                                        ${this.generateActionMenuItems(item)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-content">
                        ${cardRows}
                    </div>
                `;

                return card;
            }

            setupTableEvents() {
                // Remove any existing event listeners to avoid duplicates
                if (this.tableEventListenersAttached) return;
                this.tableEventListenersAttached = true;

                // Use event delegation for checkboxes (attach to document to catch all)
                document.addEventListener('change', (e) => {
                    // Handle individual row and card checkboxes - determine which table they belong to
                    if (e.target.classList.contains('row-checkbox') || e.target.classList.contains('card-checkbox')) {
                        const id = e.target.dataset.id;
                        if (id) {
                            // Check if this checkbox belongs to the main table or archived table
                            const isArchivedTableCheckbox = e.target.closest('#archivedTable') ||
                                e.target.closest('#archivedTableCards');

                            if (isArchivedTableCheckbox && window.archivedDataTable) {
                                window.archivedDataTable.selectionManager.toggle(id);
                            } else {
                                this.selectionManager.toggle(id);
                            }
                            // Note: updateBothSelectAllCheckboxes() will be called by handleSelectionChange callback
                        }
                        return;
                    }

                    // Handle desktop select-all checkbox (in table header) - only for main table
                    if (e.target.id === 'select-all-checkbox') {
                        e.stopPropagation();
                        this.handleSelectAllToggle(e.target.checked, 'desktop');
                        return;
                    }

                    // Handle archived table select-all checkbox
                    if (e.target.id === 'archived-select-all-checkbox') {
                        e.stopPropagation();
                        if (window.archivedDataTable) {
                            window.archivedDataTable.handleSelectAllToggle(e.target.checked, 'desktop');
                        }
                        return;
                    }

                    // Handle archived table mobile select-all checkbox
                    if (e.target.id === 'archived-mobile-select-all-checkbox') {
                        e.stopPropagation();
                        if (window.archivedDataTable) {
                            window.archivedDataTable.handleSelectAllToggle(e.target.checked, 'mobile');
                        }
                        return;
                    }

                });

                // Use event delegation for sorting buttons
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.table-sort-button')) {
                        const button = e.target.closest('.table-sort-button');
                        const th = button.closest('th');
                        const column = th.dataset.sort;
                        if (column) {
                            this.handleSort(column);
                        }
                    }
                });
            }

            handleSort(column) {
                if (this.currentSort.column === column) {
                    this.currentSort.direction = this.currentSort.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    this.currentSort.column = column;
                    this.currentSort.direction = 'asc';
                }

                this.render();
                // Use setTimeout to ensure DOM is updated before applying visual changes
                setTimeout(() => this.updateSortVisuals(), 0);
            }

            updateSortVisuals() {
                document.querySelectorAll('.table-sort-button').forEach(button => {
                    const th = button.closest('th');
                    const column = th.dataset.sort;
                    const sortIcon = button.querySelector('.table-sort-icon');

                    // Remove existing sort classes
                    th.classList.remove('table-header--sorted-asc', 'table-header--sorted-desc');

                    if (column === this.currentSort.column) {
                        // Add sort class for styling
                        th.classList.add(`table-header--sorted-${this.currentSort.direction}`);

                        // Update arrow icon based on direction
                        if (this.currentSort.direction === 'asc') {
                            sortIcon.style.maskImage = 'var(--icon-arrow-mini-up-outline)';
                        } else {
                            sortIcon.style.maskImage = 'var(--icon-arrow-mini-down-outline)';
                        }
                    } else {
                        // Reset to default double arrow for unsorted columns
                        sortIcon.style.maskImage = 'var(--icon-arrow-mini-double-outline)';
                    }
                });
            }

            handleSelectAllToggle(checked, source) {
                // Update the other checkbox immediately
                if (source === 'desktop' && this.elements.mobileSelectAllCheckbox) {
                    this.elements.mobileSelectAllCheckbox.checked = checked;
                    this.elements.mobileSelectAllCheckbox.indeterminate = false;
                } else if (source === 'mobile') {
                    const desktopCheckbox = document.getElementById('select-all-checkbox');
                    if (desktopCheckbox) {
                        desktopCheckbox.checked = checked;
                        desktopCheckbox.indeterminate = false;
                    }
                }

                // Handle the selection logic
                const processedData = this.processData();
                if (checked) {
                    const ids = processedData.paginated.map(item => item[this.dataAdapter.primaryKey]);
                    this.selectionManager.selectAll(ids);
                } else {
                    this.selectionManager.deselectAll();
                }
            }

            handleSelectionChange(selection) {
                if (this.elements.selectedCount) {
                    this.elements.selectedCount.textContent = `Selected: ${selection.selectedCount}`;
                }

                // Update individual checkboxes for this table only (not archived table)
                document.querySelectorAll('.table:not(#archivedTable) .row-checkbox, .table-cards:not(#archivedTableCards) .card-checkbox').forEach(checkbox => {
                    const id = checkbox.dataset.id; // Keep as string for SIS IDs
                    checkbox.checked = this.selectionManager.isSelected(id);
                });

                // Update bulk actions visibility and state
                this.updateBulkActions(selection.selectedCount);

                // Update both select-all checkboxes based on current selection state
                this.updateBothSelectAllCheckboxes();
            }

            updateBothSelectAllCheckboxes() {
                const processedData = this.processData();
                const totalItemsOnPage = processedData.paginated.length;
                const selectedItemsOnPage = processedData.paginated.filter(item =>
                    this.selectionManager.isSelected(item[this.dataAdapter.primaryKey])
                ).length;

                // Calculate checkbox states
                const allSelected = totalItemsOnPage > 0 && selectedItemsOnPage === totalItemsOnPage;
                const isIndeterminate = selectedItemsOnPage > 0 && selectedItemsOnPage < totalItemsOnPage;

                // Update desktop checkbox
                const desktopCheckbox = document.getElementById('select-all-checkbox');
                if (desktopCheckbox) {
                    desktopCheckbox.checked = allSelected;
                    desktopCheckbox.indeterminate = isIndeterminate;

                    if (isIndeterminate) {
                        desktopCheckbox.classList.add('indeterminate');
                        // Force indeterminate styling with direct CSS
                        const customElement = desktopCheckbox.nextElementSibling;
                        if (customElement && customElement.classList.contains('form-checkbox-custom')) {
                            customElement.style.backgroundColor = 'var(--color-text-primary)';
                            customElement.style.borderColor = 'var(--color-text-primary)';
                        }
                    } else {
                        desktopCheckbox.classList.remove('indeterminate');
                        // Reset custom styling
                        const customElement = desktopCheckbox.nextElementSibling;
                        if (customElement && customElement.classList.contains('form-checkbox-custom')) {
                            customElement.style.backgroundColor = '';
                            customElement.style.borderColor = '';
                        }
                    }
                }

                // Update mobile checkbox
                const mobileCheckbox = document.getElementById('mobile-select-all-checkbox');
                if (mobileCheckbox) {
                    mobileCheckbox.checked = allSelected;
                    mobileCheckbox.indeterminate = isIndeterminate;

                    if (isIndeterminate) {
                        mobileCheckbox.classList.add('indeterminate');
                        // Force indeterminate styling with direct CSS
                        const customElement = mobileCheckbox.nextElementSibling;
                        if (customElement && customElement.classList.contains('form-checkbox-custom')) {
                            customElement.style.backgroundColor = 'var(--color-text-primary)';
                            customElement.style.borderColor = 'var(--color-text-primary)';
                        }
                    } else {
                        mobileCheckbox.classList.remove('indeterminate');
                        // Reset custom styling
                        const customElement = mobileCheckbox.nextElementSibling;
                        if (customElement && customElement.classList.contains('form-checkbox-custom')) {
                            customElement.style.backgroundColor = '';
                            customElement.style.borderColor = '';
                        }
                    }
                }
            }

            setupBulkActions() {
                // Publish button
                if (this.elements.bulkPublish) {
                    this.elements.bulkPublish.addEventListener('click', () => {
                        this.handleBulkAction('publish');
                    });
                }

                // Conclude button
                if (this.elements.bulkConclude) {
                    this.elements.bulkConclude.addEventListener('click', () => {
                        this.handleBulkAction('conclude');
                    });
                }

                // Archive button
                if (this.elements.bulkArchive) {
                    this.elements.bulkArchive.addEventListener('click', () => {
                        this.handleBulkAction('archive');
                    });
                }

                // Menu items for More actions
                const bulkUnpublish = document.getElementById('bulkUnpublish');
                const bulkUnconclude = document.getElementById('bulkUnconclude');

                if (bulkUnpublish) {
                    bulkUnpublish.addEventListener('click', (e) => {
                        if (bulkUnpublish.classList.contains('menu-item--disabled')) {
                            e.preventDefault();
                            e.stopPropagation();
                            return;
                        }
                        this.handleBulkAction('unpublish');
                    });
                }

                if (bulkUnconclude) {
                    bulkUnconclude.addEventListener('click', (e) => {
                        if (bulkUnconclude.classList.contains('menu-item--disabled')) {
                            e.preventDefault();
                            e.stopPropagation();
                            return;
                        }
                        this.handleBulkAction('unconclude');
                    });
                }
            }

            handleBulkAction(action) {
                const selectedIds = this.selectionManager.getSelectedIds();
                if (selectedIds.length === 0) {
                    alert('No items selected');
                    return;
                }

                // Handle archive action specifically
                if (action === 'archive') {
                    if (confirm(`Are you sure you want to archive ${selectedIds.length} course(s)?`)) {
                        const currentDate = new Date().toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit'
                        }).replace(/\//g, '-');

                        selectedIds.forEach(courseId => {
                            const courseData = sampleData.find(course => course['SIS ID'] === courseId);
                            if (courseData) {
                                courseData.Archive = true;
                                courseData['Archived Date'] = currentDate;
                            }
                        });

                        // Refresh both tables
                        refreshBothTablesGlobal();
                        alert(`${selectedIds.length} course(s) archived successfully`);
                    }
                } else {
                    // For other actions, just show an alert for now
                    alert(`${action.charAt(0).toUpperCase() + action.slice(1)} action would be performed on ${selectedIds.length} selected course(s)`);
                }
            }

            updateBulkActions(selectedCount) {
                // Enable/disable bulk action buttons based on selection
                const hasSelection = selectedCount > 0;

                // Update all buttons (disabled when no selection)
                if (this.elements.bulkPublish) this.elements.bulkPublish.disabled = !hasSelection;
                if (this.elements.bulkConclude) this.elements.bulkConclude.disabled = !hasSelection;
                if (this.elements.bulkArchive) this.elements.bulkArchive.disabled = !hasSelection;
                if (this.elements.bulkMore) this.elements.bulkMore.disabled = !hasSelection;

                // Menu items are also disabled when no selection
                const bulkUnpublish = document.getElementById('bulkUnpublish');
                const bulkUnconclude = document.getElementById('bulkUnconclude');

                if (bulkUnpublish) {
                    if (hasSelection) {
                        bulkUnpublish.classList.remove('menu-item--disabled');
                    } else {
                        bulkUnpublish.classList.add('menu-item--disabled');
                    }
                }

                if (bulkUnconclude) {
                    if (hasSelection) {
                        bulkUnconclude.classList.remove('menu-item--disabled');
                    } else {
                        bulkUnconclude.classList.add('menu-item--disabled');
                    }
                }
            }

            updateResultsInfo(processedData) {
                if (this.elements.resultsCount) {
                    const start = (this.currentPage - 1) * this.itemsPerPage + 1;
                    const end = Math.min(start + processedData.paginated.length - 1, processedData.filtered.length);
                    this.elements.resultsCount.textContent = `${start}-${end} of ${processedData.filtered.length} results`;
                }
            }

            setupPagination() {
                // Initialize pagination with default values
                const totalItems = this.dataAdapter.getData().length;
                const totalPages = Math.ceil(totalItems / this.itemsPerPage);

                this.pagination = new Pagination('tablePagination', {
                    currentPage: this.currentPage,
                    totalPages: totalPages,
                    onPageChange: (page) => {
                        this.currentPage = page;
                        this.render();
                    }
                });
            }

            setupPagination() {
                // Initialize pagination with default values
                const totalItems = this.dataAdapter.getData().length;
                const totalPages = Math.ceil(totalItems / this.itemsPerPage);

                this.pagination = new Pagination('tablePagination', {
                    currentPage: this.currentPage,
                    totalPages: totalPages,
                    onPageChange: (page) => {
                        this.currentPage = page;
                        this.render();
                    }
                });
            }

            updatePagination(totalItems) {
                const totalPages = Math.ceil(totalItems / this.itemsPerPage);

                if (!this.pagination) {
                    this.setupPagination();
                } else {
                    this.pagination.updatePagination(this.currentPage, totalPages);
                }
            }

            // Configuration methods for backward compatibility
            getFieldDisplayName(field) {
                const column = this.columnManager.getColumnByKey(field);
                return column ? column.label : field;
            }

            // Expose methods for field configuration
            getAvailableFields() {
                return this.columnManager.getAllColumns().map(col => col.key);
            }

            getSelectedFields() {
                return this.columnManager.getSelectedColumns().map(col => col.key);
            }

            setSelectedFields(fields) {
                this.columnManager.setSelectedColumns(fields);
                this.render();
            }

            reorderFields(fields) {
                this.columnManager.reorderColumns(fields);
                this.render();
            }
        }

        // Legacy TableManager (for backward compatibility)
        class TableManager {
            constructor() {
                // Will be set from initialization
                this.dataTable = null;

                // Legacy properties for backward compatibility
                this.selectedFields = ['Name', 'Terms', 'Teachers', 'Students', 'Status', 'Start Date'];
                this.availableFields = ['Name', 'Terms', 'Teachers', 'Students', 'Status', 'Start Date', 'SIS ID', 'Sub-Accounts', 'Visibility', 'Type'];
                this.originalSelectedFields = null;
                this.originalAvailableFields = null;

                // Filter configuration  
                this.filterConfig = {
                    statuses: {
                        selector: '.filter-status',
                        displayPrefix: 'Status: '
                    },
                    types: {
                        selector: '.filter-type',
                        displayPrefix: 'Type: '
                    },
                    terms: {
                        selector: '.filter-terms',
                        displayPrefix: 'Term: '
                    },
                    subAccounts: {
                        selector: '.filter-sub-accounts',
                        displayPrefix: 'Sub-Account: '
                    }
                };

                this.init();
            }

            init() {
                // Legacy initialization - mostly handled by the new DataTable
                this.setupResultsControls();
            }

            // Delegation methods to new DataTable
            getFieldDisplayName(field) {
                return this.dataTable ? this.dataTable.getFieldDisplayName(field) : field;
            }

            getAvailableFields() {
                return this.dataTable ? this.dataTable.getAvailableFields() : this.availableFields;
            }

            getSelectedFields() {
                return this.dataTable ? this.dataTable.getSelectedFields() : this.selectedFields;
            }

            setSelectedFields(fields) {
                this.selectedFields = fields;
                if (this.dataTable) {
                    this.dataTable.setSelectedFields(fields);
                }
            }

            reorderFields(fields) {
                this.availableFields = fields;
                if (this.dataTable) {
                    this.dataTable.reorderFields(fields);
                }
            }


            // Delegate to new DataTable  
            rebuildTable() {
                if (this.dataTable) {
                    this.dataTable.render();
                }
            }


            setupPagination() {
                this.pagination = new Pagination('tablePagination', {
                    currentPage: 1,
                    totalPages: 1,
                    onPageChange: (page) => {
                        this.currentPage = page;
                        this.updateDisplayForCurrentPage();
                    }
                });
            }

            setupResultsControls() {
                // Items per page dropdown
                const itemsPerPageSelect = document.getElementById('itemsPerPage');
                if (itemsPerPageSelect) {
                    itemsPerPageSelect.addEventListener('change', (e) => {
                        this.itemsPerPage = parseInt(e.target.value);
                        this.currentPage = 1; // Reset to first page
                        this.pagination.goToPage(1);
                        this.applyFiltersAndSearch();
                    });
                }

                // Configure button
                const configureBtn = document.getElementById('configureBtn');
                if (configureBtn) {
                    configureBtn.addEventListener('click', () => {
                        // Save original configuration and render for main table
                        if (this.dataTable && this.dataTable.fieldConfigManager) {
                            this.dataTable.fieldConfigManager.saveOriginalConfiguration();
                            this.dataTable.fieldConfigManager.renderFieldConfigList();
                        }
                        // Save original configuration and render for archived table
                        if (window.archivedDataTable && window.archivedDataTable.archivedFieldConfigManager) {
                            window.archivedDataTable.archivedFieldConfigManager.saveOriginalConfiguration();
                            window.archivedDataTable.archivedFieldConfigManager.renderFieldConfigList();
                        }
                        trayManager.open('configureTray');
                    });
                }

                // Configure tray buttons
                const applyConfigBtn = document.getElementById('applyConfigBtn');
                if (applyConfigBtn) {
                    applyConfigBtn.addEventListener('click', () => {
                        // Apply configuration to main table
                        if (this.dataTable && this.dataTable.fieldConfigManager) {
                            this.dataTable.fieldConfigManager.applyConfiguration();
                        }
                        // Apply configuration to archived table
                        if (window.archivedDataTable && window.archivedDataTable.archivedFieldConfigManager) {
                            window.archivedDataTable.archivedFieldConfigManager.applyConfiguration();
                        }
                        trayManager.close();
                    });
                }

                const cancelConfigBtn = document.getElementById('cancelConfigBtn');
                if (cancelConfigBtn) {
                    cancelConfigBtn.addEventListener('click', () => {
                        // Restore original configuration for main table
                        if (this.dataTable && this.dataTable.fieldConfigManager) {
                            this.dataTable.fieldConfigManager.restoreOriginalConfiguration();
                        }
                        // Restore original configuration for archived table
                        if (window.archivedDataTable && window.archivedDataTable.archivedFieldConfigManager) {
                            window.archivedDataTable.archivedFieldConfigManager.restoreOriginalConfiguration();
                        }
                        trayManager.close();
                    });
                }

                // Close tray button
                const closeTrayBtn = document.getElementById('closeTrayBtn');
                if (closeTrayBtn) {
                    closeTrayBtn.addEventListener('click', () => {
                        // Restore original configuration for main table
                        if (this.dataTable && this.dataTable.fieldConfigManager) {
                            this.dataTable.fieldConfigManager.restoreOriginalConfiguration();
                        }
                        // Restore original configuration for archived table
                        if (window.archivedDataTable && window.archivedDataTable.archivedFieldConfigManager) {
                            window.archivedDataTable.archivedFieldConfigManager.restoreOriginalConfiguration();
                        }
                        trayManager.close();
                    });
                }

                const resetConfigBtn = document.getElementById('resetConfigBtn');
                if (resetConfigBtn) {
                    resetConfigBtn.addEventListener('click', () => {
                        // Reset to defaults for main table
                        if (this.dataTable && this.dataTable.fieldConfigManager) {
                            this.dataTable.fieldConfigManager.resetToDefaults();
                        }
                        // Reset to defaults for archived table
                        if (window.archivedDataTable && window.archivedDataTable.archivedFieldConfigManager) {
                            window.archivedDataTable.archivedFieldConfigManager.resetToDefaults();
                        }
                    });
                }

                // Handle action menu clicks
                document.addEventListener('click', (e) => {
                    const menuItem = e.target.closest('.menu-item[data-action]');
                    if (menuItem && this.dataTable) {
                        const action = menuItem.dataset.action;
                        const courseId = menuItem.dataset.courseId;
                        this.handleMenuAction(action, courseId);
                    }
                });

            }

            handleMenuAction(action, courseId) {
                // Find the course in the data
                const courseData = sampleData.find(course => course['SIS ID'] === courseId);
                if (!courseData) return;

                console.log(`Performing ${action} on course ${courseData.Name} (${courseId})`);

                switch (action) {
                    case 'enroll':
                        console.log('Opening enrollment dialog...');
                        break;
                    case 'stats':
                        console.log('Opening course statistics...');
                        break;
                    case 'settings':
                        console.log('Opening course settings...');
                        break;
                    case 'copy':
                        console.log('Copying course...');
                        break;
                    case 'download':
                        console.log('Downloading course data...');
                        break;
                    case 'publish':
                        courseData.Status = 'Published';
                        this.refreshBothTables();
                        console.log('Course published');
                        break;
                    case 'unpublish':
                        courseData.Status = 'Unpublished';
                        this.refreshBothTables();
                        console.log('Course unpublished');
                        break;
                    case 'conclude':
                        courseData.Status = 'Concluded';
                        this.refreshBothTables();
                        console.log('Course concluded');
                        break;
                    case 'unconclude':
                        courseData.Status = 'Unpublished'; // Un-concluding sets to unpublished
                        this.refreshBothTables();
                        console.log('Course un-concluded and set to unpublished');
                        break;
                    case 'archive':
                        courseData.Archive = true;
                        courseData['Archived Date'] = new Date().toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit'
                        }).replace(/\//g, '-');
                        this.refreshBothTables();
                        console.log('Course archived');
                        break;
                    case 'restore':
                        courseData.Archive = false;
                        courseData['Archived Date'] = null;
                        this.refreshBothTables();
                        console.log('Course restored from archive');
                        break;
                    default:
                        console.log(`Unknown action: ${action}`);
                }
            }

            refreshBothTables() {
                console.log('DEBUG: refreshBothTables() called');
                // Update main table data source
                if (this.dataTable && this.dataTable.dataAdapter) {
                    this.dataTable.dataAdapter.rawData = sampleData.filter(item => item.Archive !== true);
                    this.dataTable.render();
                }

                // Update archived table data source
                if (window.archivedDataTable && window.archivedDataTable.dataAdapter) {
                    window.archivedDataTable.dataAdapter.rawData = sampleData.filter(item => item.Archive === true);
                    window.archivedDataTable.render();
                }
            }
        }

        // =============================================================================
        // TABLE CONFIGURATION
        // =============================================================================

        const userTableConfig = {
            columns: [
                {
                    key: 'Name',
                    label: 'Course name',
                    renderer: 'course-name',
                    width: 'flex',
                    sortable: true,
                    searchable: true
                },
                {
                    key: 'SIS ID',
                    label: 'SIS ID',
                    renderer: 'text',
                    width: '120px',
                    sortable: true,
                    searchable: true
                },
                {
                    key: 'Terms',
                    label: 'Terms',
                    renderer: 'array-list',
                    width: 'flex',
                    sortable: true,
                    searchable: true,
                    fontSize: 'xsmall'
                },
                {
                    key: 'Sub-Accounts',
                    label: 'Sub-accounts',
                    renderer: 'array-list',
                    width: 'flex',
                    sortable: true,
                    searchable: true
                },
                {
                    key: 'Teachers',
                    label: 'Teachers',
                    renderer: 'teachers-list',
                    width: 'flex',
                    sortable: true,
                    searchable: true
                },
                {
                    key: 'Status',
                    label: 'Status',
                    renderer: 'status-badge',
                    width: '120px',
                    alignment: 'center',
                    sortable: true,
                    searchable: false
                },
                {
                    key: 'Visibility',
                    label: 'Visibility',
                    renderer: 'text',
                    width: '120px',
                    sortable: true,
                    searchable: false
                },
                {
                    key: 'Students',
                    label: 'Students',
                    renderer: 'link',
                    width: '120px',
                    alignment: 'center',
                    sortable: true,
                    searchable: false
                },
                {
                    key: 'Type',
                    label: 'Type',
                    renderer: 'type-object',
                    width: 'flex',
                    alignment: 'left',
                    sortable: false,
                    searchable: false
                },
                {
                    key: 'Start Date',
                    label: 'Start date',
                    renderer: 'text',
                    width: '160px',
                    sortable: true,
                    alignment: 'center',
                    searchable: false
                },
                {
                    key: 'Archived Date',
                    label: 'Archived date',
                    renderer: 'text',
                    width: '160px',
                    sortable: true,
                    alignment: 'center',
                    searchable: false
                }
            ],
            data: {
                data: sampleData.filter(item => item.Archive !== true),
                primaryKey: 'SIS ID'
            },
            defaultColumns: ['Name', 'Terms', 'Teachers', 'Students', 'Status', 'Start Date'],
            pagination: {
                defaultSize: 15
            },
            responsive: {
                breakpoint: 1212,
                strategy: 'cards'
            },
            features: {
                search: true,
                sorting: true,
                filtering: true,
                selection: true,
                pagination: true,
                responsive: true
            }
        };

        // Multiselect Component Class
        class Multiselect {
            constructor(element) {
                this.element = element;
                this.container = element.querySelector('[data-multiselect]') || element;
                this.hiddenInput = this.container.querySelector('[data-multiselect-input]');
                this.searchInput = this.container.querySelector('[data-multiselect-search]');
                this.pillsContainer = this.container.querySelector('[data-multiselect-pills]');
                this.dropdown = this.container.querySelector('[data-multiselect-dropdown]');
                this.combobox = this.container.querySelector('.multiselect__container');
                this.chevron = this.container.querySelector('.multiselect__chevron');
                this.selectionCount = this.container.querySelector('[id$="-selection-count"]');

                // Check for required elements
                if (!this.hiddenInput || !this.searchInput || !this.pillsContainer || !this.dropdown || !this.combobox) {
                    return;
                }

                this.options = Array.from(this.dropdown.querySelectorAll('.multiselect__option'));
                this.selectedValues = [];
                this.highlightedIndex = -1;
                this.isOpen = false;
                this.originalPlaceholder = this.searchInput.placeholder;
                this.preventClose = false;

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateAriaStates();
            }

            setupEventListeners() {
                // Container focus
                this.combobox.addEventListener('click', () => this.focusSearch());
                this.combobox.addEventListener('keydown', (e) => this.handleContainerKeydown(e));

                // Search input
                this.searchInput.addEventListener('input', (e) => this.handleSearch(e));
                this.searchInput.addEventListener('focus', () => this.open());
                this.searchInput.addEventListener('keydown', (e) => this.handleSearchKeydown(e));
                this.searchInput.addEventListener('blur', (e) => this.handleBlur(e));

                // Chevron
                this.chevron.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.toggle();
                });

                // Use mousedown events for option selection (click events don't work consistently)
                this.options.forEach(option => {
                    option.onmousedown = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.preventClose = true;
                        this.handleOptionClick(e);
                        setTimeout(() => { this.preventClose = false; }, 100);
                    };
                });
                this.dropdown.addEventListener('mouseover', (e) => this.handleOptionHover(e));

                // Pills container for keyboard navigation
                this.pillsContainer.addEventListener('keydown', (e) => this.handlePillKeydown(e));
                this.pillsContainer.addEventListener('click', (e) => this.handlePillClick(e));

                // Outside click
                document.addEventListener('click', (e) => this.handleOutsideClick(e));
            }

            focusSearch() {
                this.searchInput.focus();
            }

            open() {
                if (this.isOpen) return;

                this.isOpen = true;
                this.dropdown.classList.add('multiselect__dropdown--open');
                this.combobox.setAttribute('aria-expanded', 'true');
                this.updateOptionsDisplay();
                this.highlightedIndex = -1;
                this.updateAriaStates();
            }

            close() {
                if (!this.isOpen) return;

                this.isOpen = false;
                this.dropdown.classList.remove('multiselect__dropdown--open');
                this.combobox.setAttribute('aria-expanded', 'false');
                this.highlightedIndex = -1;
                this.updateAriaStates();
            }

            toggle() {
                if (this.isOpen) {
                    this.close();
                } else {
                    this.open();
                    this.focusSearch();
                }
            }

            handleSearch(e) {
                const query = e.target.value.toLowerCase().trim();
                this.updateOptionsDisplay(query);

                if (!this.isOpen) {
                    this.open();
                }
            }

            updateOptionsDisplay(query = '') {
                let visibleCount = 0;

                this.options.forEach(option => {
                    const text = option.textContent.toLowerCase();
                    const searchText = option.dataset.search?.toLowerCase() || text;
                    const isSelected = this.selectedValues.includes(option.dataset.value);
                    const matches = !query || searchText.includes(query);

                    if (matches && !isSelected) {
                        option.classList.remove('multiselect__option--hidden', 'multiselect__option--disabled');
                        visibleCount++;
                    } else if (isSelected) {
                        option.classList.add('multiselect__option--disabled');
                        option.classList.remove('multiselect__option--hidden');
                    } else {
                        option.classList.add('multiselect__option--hidden');
                        option.classList.remove('multiselect__option--disabled');
                    }
                });

                // Show no results message
                this.updateNoResultsMessage(visibleCount === 0 && query);
            }

            updateNoResultsMessage(show) {
                let noResultsEl = this.dropdown.querySelector('.multiselect__no-results');

                if (show) {
                    if (!noResultsEl) {
                        noResultsEl = document.createElement('div');
                        noResultsEl.className = 'multiselect__no-results';
                        noResultsEl.textContent = 'No results found';
                        this.dropdown.appendChild(noResultsEl);
                    }
                    noResultsEl.style.display = 'block';
                } else if (noResultsEl) {
                    noResultsEl.style.display = 'none';
                }
            }

            handleContainerKeydown(e) {
                if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (!this.isOpen) {
                        this.open();
                    }
                    this.navigateOptions(e.key === 'ArrowDown' ? 1 : -1);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (this.highlightedIndex >= 0) {
                        this.selectOption(this.getVisibleOptions()[this.highlightedIndex]);
                    }
                } else if (e.key === 'Escape') {
                    this.close();
                } else if (e.key === 'Backspace' && this.searchInput.value === '') {
                    this.removeLastPill();
                }
            }

            handleSearchKeydown(e) {
                if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (!this.isOpen) {
                        this.open();
                    }
                    this.navigateOptions(e.key === 'ArrowDown' ? 1 : -1);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (this.highlightedIndex >= 0) {
                        this.selectOption(this.getVisibleOptions()[this.highlightedIndex]);
                    }
                } else if (e.key === 'Escape') {
                    this.close();
                } else if (e.key === 'Tab') {
                    if (this.highlightedIndex >= 0) {
                        e.preventDefault();
                        this.selectOption(this.getVisibleOptions()[this.highlightedIndex]);
                    } else {
                        this.close();
                    }
                } else if (e.key === 'Backspace' && this.searchInput.value === '') {
                    this.removeLastPill();
                }
            }

            navigateOptions(direction) {
                const visibleOptions = this.getVisibleOptions();
                if (visibleOptions.length === 0) return;

                // Clear current highlight
                this.options.forEach(opt => opt.classList.remove('multiselect__option--highlighted'));

                // Calculate new index
                this.highlightedIndex += direction;
                if (this.highlightedIndex < 0) {
                    this.highlightedIndex = visibleOptions.length - 1;
                } else if (this.highlightedIndex >= visibleOptions.length) {
                    this.highlightedIndex = 0;
                }

                // Highlight new option
                const highlightedOption = visibleOptions[this.highlightedIndex];
                highlightedOption.classList.add('multiselect__option--highlighted');
                highlightedOption.scrollIntoView({ block: 'nearest' });

                // Update ARIA
                this.combobox.setAttribute('aria-activedescendant', highlightedOption.id || '');
            }

            getVisibleOptions() {
                return this.options.filter(opt =>
                    !opt.classList.contains('multiselect__option--hidden') &&
                    !opt.classList.contains('multiselect__option--disabled')
                );
            }

            handleOptionClick(e) {
                const option = e.target.closest('.multiselect__option');
                if (!option || option.classList.contains('multiselect__option--disabled')) return;

                this.selectOption(option);
            }

            handleOptionHover(e) {
                const option = e.target.closest('.multiselect__option');
                if (!option || option.classList.contains('multiselect__option--disabled')) return;

                // Clear current highlight
                this.options.forEach(opt => opt.classList.remove('multiselect__option--highlighted'));

                // Highlight hovered option
                option.classList.add('multiselect__option--highlighted');
                this.highlightedIndex = this.getVisibleOptions().indexOf(option);
            }

            selectOption(option) {
                const value = option.dataset.value;
                if (this.selectedValues.includes(value)) return;

                this.selectedValues.push(value);
                this.updatePills();
                this.updateHiddenInput();
                this.updateOptionsDisplay();
                this.clearSearch();
                this.updateSelectionCount();
                this.triggerChange();
                this.focusSearch();

                // Keep dropdown open for continued selection
                this.highlightedIndex = -1;
            }


            removeLastPill() {
                if (this.selectedValues.length === 0) return;

                const lastValue = this.selectedValues[this.selectedValues.length - 1];
                this.removeValue(lastValue);
            }

            updatePills() {
                this.pillsContainer.innerHTML = '';

                this.selectedValues.forEach((value, index) => {
                    const pill = this.createPill(value, index);
                    this.pillsContainer.appendChild(pill);
                });

                // Update container state
                if (this.selectedValues.length > 0) {
                    this.container.classList.add('multiselect--has-selections');
                } else {
                    this.container.classList.remove('multiselect--has-selections');
                }
            }

            createPill(value, index) {
                const pill = document.createElement('span');
                pill.className = 'multiselect__pill';
                pill.setAttribute('role', 'option');
                pill.setAttribute('aria-selected', 'true');
                pill.setAttribute('tabindex', '0');
                pill.dataset.value = value;
                pill.dataset.index = index;

                const option = this.options.find(opt => opt.dataset.value === value);
                const text = option ? option.textContent : value;

                pill.innerHTML = `
                    <span class="multiselect__pill-text">${text}</span>
                    <button class="multiselect__pill-remove" 
                            type="button" 
                            aria-label="Remove ${text}"
                            tabindex="-1">
                        <span class="multiselect__pill-remove-icon"></span>
                    </button>
                `;

                return pill;
            }

            handlePillKeydown(e) {
                const pill = e.target.closest('.multiselect__pill');
                if (!pill) return;

                if (e.key === 'Delete' || e.key === 'Backspace') {
                    e.preventDefault();
                    this.removeValue(pill.dataset.value);
                } else if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                    e.preventDefault();
                    this.navigatePills(pill, e.key === 'ArrowRight' ? 1 : -1);
                }
            }

            handlePillClick(e) {
                if (e.target.closest('.multiselect__pill-remove')) {
                    e.preventDefault();
                    const pill = e.target.closest('.multiselect__pill');
                    this.removeValue(pill.dataset.value);
                }
            }

            navigatePills(currentPill, direction) {
                const pills = Array.from(this.pillsContainer.querySelectorAll('.multiselect__pill'));
                const currentIndex = pills.indexOf(currentPill);
                const newIndex = currentIndex + direction;

                if (newIndex >= 0 && newIndex < pills.length) {
                    pills[newIndex].focus();
                } else if (direction > 0) {
                    // Move to search input
                    this.focusSearch();
                }
            }

            clearSearch() {
                this.searchInput.value = '';
            }

            updateHiddenInput() {
                this.hiddenInput.value = this.selectedValues.join(',');

                // Trigger change event for form integration
                this.hiddenInput.dispatchEvent(new Event('change', { bubbles: true }));
            }

            updateSelectionCount() {
                const count = this.selectedValues.length;
                const text = count === 0 ? 'No items selected' :
                    count === 1 ? '1 item selected' :
                        `${count} items selected`;

                if (this.selectionCount) {
                    this.selectionCount.textContent = text;
                }

                // Update search input description
                this.searchInput.setAttribute('aria-description', text);
            }

            updateAriaStates() {
                this.combobox.setAttribute('aria-expanded', this.isOpen.toString());

                if (this.highlightedIndex >= 0) {
                    const highlightedOption = this.getVisibleOptions()[this.highlightedIndex];
                    this.combobox.setAttribute('aria-activedescendant', highlightedOption?.id || '');
                } else {
                    this.combobox.removeAttribute('aria-activedescendant');
                }
            }

            handleBlur(e) {
                // Only close if focus is leaving the entire component
                setTimeout(() => {
                    if (!this.container.contains(document.activeElement)) {
                        this.close();
                    }
                }, 0);
            }

            handleOutsideClick(e) {
                // Don't close if we're in the middle of handling an option click
                if (this.preventClose) {
                    return;
                }

                // Don't close if clicking on an option (let the option click handler run first)
                if (e.target.closest('.multiselect__option')) {
                    return;
                }

                if (!this.container.contains(e.target)) {
                    this.close();
                }
            }

            // Public API
            setValue(values) {
                this.selectedValues = Array.isArray(values) ? [...values] : [];
                this.updatePills();
                this.updateHiddenInput();
                this.updateOptionsDisplay();
                this.updateSelectionCount();
            }

            getValue() {
                return [...this.selectedValues];
            }

            disable() {
                this.container.classList.add('multiselect--disabled');
                this.combobox.setAttribute('tabindex', '-1');
                this.searchInput.disabled = true;
            }

            enable() {
                this.container.classList.remove('multiselect--disabled');
                this.combobox.setAttribute('tabindex', '0');
                this.searchInput.disabled = false;
            }

            // Clear all selected values
            clear(skipTableUpdate = false) {
                this.selectedValues = [];
                this.hiddenInput.value = '';
                this.updatePills();
                this.searchInput.placeholder = this.originalPlaceholder;
                this.updateOptionsDisplay();
                this.triggerChange(skipTableUpdate);
            }

            // Remove a specific value
            removeValue(value, skipTableUpdate = false) {
                this.selectedValues = this.selectedValues.filter(v => v !== value);
                this.hiddenInput.value = this.selectedValues.join(',');
                this.updatePills();
                if (this.selectedValues.length === 0) {
                    this.searchInput.placeholder = this.originalPlaceholder;
                }
                this.updateOptionsDisplay();
                this.triggerChange(skipTableUpdate);
            }

            // Update dropdown options selection state for synchronization
            updateOptionSelectionStates() {
                const options = this.dropdown.querySelectorAll('.multiselect__option');
                options.forEach(option => {
                    const value = option.dataset.value;
                    const isSelected = this.selectedValues.includes(value);
                    option.classList.toggle('multiselect__option--selected', isSelected);
                    option.setAttribute('aria-selected', isSelected.toString());
                });
            }

            // Trigger change event for form integration
            triggerChange(skipTableUpdate = false) {
                const changeEvent = new Event('change', { bubbles: true });
                this.hiddenInput.dispatchEvent(changeEvent);

                // Sync with other multiselect instances with the same name
                this.syncOtherInstances();

                // Update the data table filters automatically (unless called from table filter removal)
                if (!skipTableUpdate) {
                    this.updateTableFilters();
                }
            }

            // Sync with other multiselect instances that have the same name
            syncOtherInstances() {
                const inputName = this.hiddenInput.name;
                if (!inputName) return;

                // Find other multiselect instances with the same name
                document.querySelectorAll(`input[name="${inputName}"]`).forEach(otherInput => {
                    if (otherInput !== this.hiddenInput) {
                        const otherMultiselect = otherInput.closest('[data-multiselect]');
                        if (otherMultiselect && otherMultiselect.multiselectInstance) {
                            const otherInstance = otherMultiselect.multiselectInstance;
                            // Update the other instance without triggering its change event to avoid loops
                            otherInstance.selectedValues = [...this.selectedValues];
                            otherInstance.hiddenInput.value = this.hiddenInput.value;
                            otherInstance.updatePills();
                            otherInstance.updateOptionSelectionStates();
                            if (otherInstance.selectedValues.length === 0) {
                                otherInstance.searchInput.placeholder = otherInstance.originalPlaceholder;
                            } else {
                                otherInstance.searchInput.placeholder = '';
                            }
                        }
                    }
                });
            }

            // Update table filters when multiselect values change
            updateTableFilters() {
                // Use setTimeout to prevent blocking the UI update
                setTimeout(() => {
                    // Use the unified filter manager instead of individual table filters
                    const filterType = this.hiddenInput.name;
                    const values = this.hiddenInput.value.split(',').filter(v => v);
                    
                    // Update the unified filter manager which handles both tables
                    if (window.unifiedFilterManager) {
                        window.unifiedFilterManager.setFilter(filterType, values);
                    }
                }, 0);
            }

            // Validation support
            isValid() {
                if (this.hiddenInput.hasAttribute('required')) {
                    return this.selectedValues.length > 0;
                }
                return true;
            }

            setValidationMessage(message = '') {
                if (message) {
                    this.container.classList.add('multiselect--error');
                    this.combobox.setAttribute('aria-describedby', `${this.hiddenInput.id}-error`);

                    let errorElement = document.getElementById(`${this.hiddenInput.id}-error`);
                    if (!errorElement) {
                        errorElement = document.createElement('div');
                        errorElement.id = `${this.hiddenInput.id}-error`;
                        errorElement.className = 'form-error-message';
                        errorElement.setAttribute('role', 'alert');
                        this.container.insertAdjacentElement('afterend', errorElement);
                    }
                    errorElement.textContent = message;
                } else {
                    this.container.classList.remove('multiselect--error');
                    this.combobox.removeAttribute('aria-describedby');
                    const errorElement = document.getElementById(`${this.hiddenInput.id}-error`);
                    if (errorElement) {
                        errorElement.remove();
                    }
                }
            }
        }

        // Initialize all multiselect components
        function initializeMultiSelects() {
            document.querySelectorAll('[data-multiselect]').forEach(element => {
                element.multiselectInstance = new Multiselect(element);
            });
        }


        // Archived DataTable class that uses different DOM elements
        class ArchivedDataTable extends DataTable {
            cacheElements() {
                this.elements = {
                    searchInput: document.getElementById('table-search'), // Archived table shares search with main table
                    tableContainer: document.querySelector('#archivedTable').closest('.table-container'),
                    cardsContainer: document.querySelector('#archivedTableCards'),
                    mobileSelectAll: (() => {
                        // Find the archived table's mobile select all button more safely
                        const archivedTableCards = document.querySelector('#archivedTableCards');
                        if (archivedTableCards) {
                            const resultsControls = archivedTableCards.closest('.results-controls');
                            if (resultsControls) {
                                return resultsControls.querySelector('.mobile-select-all');
                            }
                        }
                        // Fallback: find by the archived mobile select all checkbox ID
                        const archivedMobileCheckbox = document.getElementById('archived-mobile-select-all-checkbox');
                        return archivedMobileCheckbox ? archivedMobileCheckbox.closest('.mobile-select-all') : null;
                    })(),
                    emptyState: document.getElementById('archivedEmptyState'),
                    resultsCount: document.getElementById('archivedResultsCount'),
                    selectedCount: document.getElementById('archivedSelectedCount'),
                    selectAllCheckbox: document.getElementById('archived-select-all-checkbox'),
                    mobileSelectAllCheckbox: document.getElementById('archived-mobile-select-all-checkbox'),
                    bulkActions: document.getElementById('archivedBulkActions'),
                    bulkPublish: null, // Not applicable for archived table
                    bulkConclude: null, // Not applicable for archived table
                    bulkArchive: null, // Not applicable for archived table
                    bulkMore: null // Not applicable for archived table
                };
            }

            // Override setupEventListeners to avoid duplicate search event listeners
            setupEventListeners() {
                // Don't set up search event listener since it's shared with main table
                // The main table will handle search and sync to archived table

                // Items per page
                const itemsPerPageSelect = document.getElementById('archivedItemsPerPage');
                if (itemsPerPageSelect) {
                    itemsPerPageSelect.addEventListener('change', (e) => {
                        this.itemsPerPage = parseInt(e.target.value);
                        this.currentPage = 1;
                        this.render();
                    });
                }

                // Filter functionality is shared with main table
                // Bulk actions are set up separately in setupArchivedBulkActions()
            }

            setupTableEvents() {
                // Don't set up duplicate table events - the main table handles all table events
                // including archived table checkboxes through event delegation
                return;
            }

            handleSelectAllToggle(checked, source) {
                // Update the other checkbox immediately - use archived table's checkboxes
                if (source === 'desktop' && this.elements.mobileSelectAllCheckbox) {
                    this.elements.mobileSelectAllCheckbox.checked = checked;
                    this.elements.mobileSelectAllCheckbox.indeterminate = false;
                } else if (source === 'mobile') {
                    const desktopCheckbox = document.getElementById('archived-select-all-checkbox');
                    if (desktopCheckbox) {
                        desktopCheckbox.checked = checked;
                        desktopCheckbox.indeterminate = false;
                    }
                }

                // Handle the selection logic
                const processedData = this.processData();
                if (checked) {
                    const ids = processedData.paginated.map(item => item[this.dataAdapter.primaryKey]);
                    this.selectionManager.selectAll(ids);
                } else {
                    this.selectionManager.deselectAll();
                }
            }

            setupPagination() {
                // Initialize pagination with archived table pagination container
                const totalItems = this.dataAdapter.getData().length;
                const totalPages = Math.ceil(totalItems / this.itemsPerPage);

                this.pagination = new Pagination('archivedTablePagination', {
                    currentPage: this.currentPage,
                    totalPages: totalPages,
                    onPageChange: (page) => {
                        this.currentPage = page;
                        this.render();
                    }
                });
            }

            updateTableHeaders() {
                const tableHeader = document.querySelector('#archivedTable thead tr');
                if (!tableHeader) return;

                tableHeader.innerHTML = '';

                // Checkbox column
                const checkboxHeader = document.createElement('th');
                checkboxHeader.className = 'table-header table-header--checkbox';
                checkboxHeader.innerHTML = `
                    <label class="form-checkbox-label">
                        <input type="checkbox" id="archived-select-all-checkbox" class="form-checkbox">
                        <span class="form-checkbox-custom"></span>
                        <span class="sr-only">Select all archived courses</span>
                    </label>
                `;
                tableHeader.appendChild(checkboxHeader);

                // Column headers
                const selectedColumns = this.columnManager.getSelectedColumns();
                selectedColumns.forEach(column => {
                    const th = document.createElement('th');
                    th.className = column.sortable ? 'table-header table-header--sortable' : 'table-header';
                    th.classList.add(column.getHeaderAlignmentClass());
                    if (column.sortable) {
                        th.dataset.sort = column.key;
                    }

                    // Apply width styling
                    const width = column.getWidth();
                    if (width) {
                        if (width === 'flex') {
                            th.classList.add('table-header--flexible');
                            th.style.width = '';
                            th.style.flex = '1';
                        } else if (width === 'auto') {
                            th.style.width = 'auto';
                            th.style.flex = '0 0 auto';
                        } else {
                            // Fixed width (e.g., '120px', '15%')
                            th.style.width = width;
                            th.style.flex = '0 0 auto';
                        }
                    } else {
                        // Default to flexible if no width specified
                        th.classList.add('table-header--flexible');
                    }

                    if (column.sortable) {
                        th.innerHTML = `
                            <button class="table-sort-button" aria-label="Sort by ${column.label.toLowerCase()}">
                                ${column.label}
                                <span class="table-sort-icon icon icon-18" 
                                      style="mask-image: var(--icon-arrow-mini-double-outline);" 
                                      aria-hidden="true"></span>
                            </button>
                        `;
                    } else {
                        th.innerHTML = `<span class="table-sort-label">${column.label}</span>`;
                    }
                    tableHeader.appendChild(th);
                });

                // Actions column
                const actionsHeader = document.createElement('th');
                actionsHeader.className = 'table-header table-header--text-center';
                actionsHeader.innerHTML = '<span class="table-sort-label">Actions</span>';
                tableHeader.appendChild(actionsHeader);
            }

            generateTableRows(data) {
                const tbody = document.querySelector('#archivedTable tbody');
                if (!tbody) return;

                // Clear existing rows
                tbody.innerHTML = '';

                // Always generate table rows - CSS controls visibility
                data.forEach(item => {
                    const row = this.createTableRow(item);
                    tbody.appendChild(row);
                });
            }

            updatePagination(totalItems) {
                const totalPages = Math.ceil(totalItems / this.itemsPerPage);

                if (!this.pagination) {
                    this.setupPagination();
                } else {
                    this.pagination.updatePagination(this.currentPage, totalPages);
                }
            }

            updateBothSelectAllCheckboxes() {
                const processedData = this.processData();
                const totalItemsOnPage = processedData.paginated.length;
                const selectedItemsOnPage = processedData.paginated.filter(item =>
                    this.selectionManager.isSelected(item[this.dataAdapter.primaryKey])
                ).length;

                // Calculate checkbox states
                const allSelected = totalItemsOnPage > 0 && selectedItemsOnPage === totalItemsOnPage;
                const isIndeterminate = selectedItemsOnPage > 0 && selectedItemsOnPage < totalItemsOnPage;

                // Update desktop checkbox - use archived table's checkbox
                const desktopCheckbox = document.getElementById('archived-select-all-checkbox');
                if (desktopCheckbox) {
                    desktopCheckbox.checked = allSelected;
                    desktopCheckbox.indeterminate = isIndeterminate;

                    if (isIndeterminate) {
                        desktopCheckbox.classList.add('indeterminate');
                        // Force indeterminate styling with direct CSS
                        const customElement = desktopCheckbox.nextElementSibling;
                        if (customElement && customElement.classList.contains('form-checkbox-custom')) {
                            customElement.style.backgroundColor = 'var(--color-text-primary)';
                            customElement.style.borderColor = 'var(--color-text-primary)';
                        }
                    } else {
                        desktopCheckbox.classList.remove('indeterminate');
                        // Reset custom styling
                        const customElement = desktopCheckbox.nextElementSibling;
                        if (customElement && customElement.classList.contains('form-checkbox-custom')) {
                            customElement.style.backgroundColor = '';
                            customElement.style.borderColor = '';
                        }
                    }
                }

                // Update mobile checkbox - use archived table's mobile checkbox
                const mobileCheckbox = document.getElementById('archived-mobile-select-all-checkbox');
                if (mobileCheckbox) {
                    mobileCheckbox.checked = allSelected;
                    mobileCheckbox.indeterminate = isIndeterminate;

                    if (isIndeterminate) {
                        mobileCheckbox.classList.add('indeterminate');
                        // Force indeterminate styling with direct CSS
                        const customElement = mobileCheckbox.nextElementSibling;
                        if (customElement && customElement.classList.contains('form-checkbox-custom')) {
                            customElement.style.backgroundColor = 'var(--color-text-primary)';
                            customElement.style.borderColor = 'var(--color-text-primary)';
                        }
                    } else {
                        mobileCheckbox.classList.remove('indeterminate');
                        // Reset custom styling
                        const customElement = mobileCheckbox.nextElementSibling;
                        if (customElement && customElement.classList.contains('form-checkbox-custom')) {
                            customElement.style.backgroundColor = '';
                            customElement.style.borderColor = '';
                        }
                    }
                }
            }

            handleSelectionChange(selection) {
                if (this.elements.selectedCount) {
                    this.elements.selectedCount.textContent = `Selected: ${selection.selectedCount}`;
                }

                // Update individual checkboxes for archived table only
                document.querySelectorAll('#archivedTable .row-checkbox, #archivedTableCards .card-checkbox').forEach(checkbox => {
                    const id = checkbox.dataset.id; // Keep as string for SIS IDs
                    checkbox.checked = this.selectionManager.isSelected(id);
                });

                // Update bulk actions visibility and state
                this.updateBulkActions(selection.selectedCount);

                // Update both select-all checkboxes based on current selection state
                this.updateBothSelectAllCheckboxes();
            }

            updateBulkActions(selectedCount) {
                // Enable/disable bulk action buttons based on selection for archived table
                const hasSelection = selectedCount > 0;

                // Update archived table bulk action buttons
                const archivedBulkRestore = document.getElementById('archivedBulkRestore');
                const archivedBulkDelete = document.getElementById('archivedBulkDelete');

                if (archivedBulkRestore) archivedBulkRestore.disabled = !hasSelection;
                if (archivedBulkDelete) archivedBulkDelete.disabled = !hasSelection;
            }

            setupResponsive() {
                this.responsiveManager.init((isResponsive) => {
                    // Show/hide archived table mobile select all button
                    // Re-cache the mobile select all element if it wasn't found initially
                    if (!this.elements.mobileSelectAll) {
                        const archivedMobileCheckbox = document.getElementById('archived-mobile-select-all-checkbox');
                        this.elements.mobileSelectAll = archivedMobileCheckbox ? archivedMobileCheckbox.closest('.mobile-select-all') : null;
                    }

                    if (this.elements.mobileSelectAll) {
                        this.elements.mobileSelectAll.style.display = isResponsive ? 'block' : 'none';
                    }

                    this.render();
                });
            }

            // Override generateActionMenuItems to show only copy, download, and restore for archived courses
            generateActionMenuItems(item) {
                const menuItems = [];

                // Copy action
                menuItems.push(`
                    <div class="menu-item" role="menuitem" tabindex="-1" data-action="copy" data-course-id="${item['SIS ID']}">
                        <span class="menu-item-icon" style="mask-image: var(--icon-copy-outline);" aria-hidden="true"></span>
                        <span class="menu-item-text">Copy</span>
                    </div>
                `);

                // Download action
                menuItems.push(`
                    <div class="menu-item" role="menuitem" tabindex="-1" data-action="download" data-course-id="${item['SIS ID']}">
                        <span class="menu-item-icon" style="mask-image: var(--icon-download-outline);" aria-hidden="true"></span>
                        <span class="menu-item-text">Download</span>
                    </div>
                `);

                // Restore action (always available for archived courses)
                menuItems.push(`
                    <div class="menu-item" role="menuitem" tabindex="-1" data-action="restore" data-course-id="${item['SIS ID']}">
                        <span class="menu-item-icon" style="mask-image: var(--icon-refresh-outline);" aria-hidden="true"></span>
                        <span class="menu-item-text">Restore</span>
                    </div>
                `);

                return menuItems.join('');
            }
        }

        // Setup archived table bulk actions
        function setupArchivedBulkActions() {
            const archivedBulkRestore = document.getElementById('archivedBulkRestore');
            const archivedBulkDelete = document.getElementById('archivedBulkDelete');

            if (archivedBulkRestore) {
                archivedBulkRestore.addEventListener('click', () => {
                    const selectedIds = archivedDataTable.selectionManager.getSelectedIds();
                    if (selectedIds.length === 0) {
                        alert('No items selected');
                        return;
                    }

                    // Restore selected courses
                    selectedIds.forEach(courseId => {
                        const courseData = sampleData.find(course => course['SIS ID'] === courseId);
                        if (courseData) {
                            courseData.Archive = false;
                            courseData['Archived Date'] = null;
                        }
                    });

                    // Refresh both tables
                    refreshBothTablesGlobal();

                    alert(`${selectedIds.length} course(s) restored from archive`);
                });
            }

            if (archivedBulkDelete) {
                archivedBulkDelete.addEventListener('click', () => {
                    const selectedIds = archivedDataTable.selectionManager.getSelectedIds();
                    if (selectedIds.length === 0) {
                        alert('No items selected');
                        return;
                    }

                    if (confirm(`Are you sure you want to permanently delete ${selectedIds.length} course(s)? This action cannot be undone.`)) {
                        // Remove selected courses from sampleData
                        selectedIds.forEach(courseId => {
                            const index = sampleData.findIndex(course => course['SIS ID'] === courseId);
                            if (index !== -1) {
                                sampleData.splice(index, 1);
                            }
                        });

                        // Refresh both tables
                        refreshBothTablesGlobal();

                        alert(`${selectedIds.length} course(s) permanently deleted`);
                    }
                });
            }
        }

        // Global function to refresh both tables
        function refreshBothTablesGlobal() {
            console.log('DEBUG: refreshBothTablesGlobal() called');
            // Update main table data source
            if (window.dataTable && window.dataTable.dataAdapter) {
                window.dataTable.dataAdapter.rawData = sampleData.filter(item => item.Archive !== true);
                window.dataTable.render();
            }

            // Update archived table data source
            if (window.archivedDataTable && window.archivedDataTable.dataAdapter) {
                window.archivedDataTable.dataAdapter.rawData = sampleData.filter(item => item.Archive === true);
                window.archivedDataTable.render();
            }
        }

        // Initialize table switching tabs
        function initializeTableTabs() {
            const activeTab = document.getElementById('active-courses-tab');
            const archivedTab = document.getElementById('archived-courses-tab');
            const activeSection = document.getElementById('active-courses-section');
            const archivedSection = document.getElementById('archived-courses-section');
            
            if (!activeTab || !archivedTab || !activeSection || !archivedSection) {
                console.warn('Table tabs elements not found');
                return;
            }
            
            // Tab click handlers
            activeTab.addEventListener('click', () => {
                // Update tab states
                activeTab.classList.add('tab--active');
                activeTab.setAttribute('aria-selected', 'true');
                archivedTab.classList.remove('tab--active');
                archivedTab.setAttribute('aria-selected', 'false');
                
                // Update content visibility
                activeSection.classList.add('tab-content--active');
                archivedSection.classList.remove('tab-content--active');
            });
            
            archivedTab.addEventListener('click', () => {
                // Update tab states
                archivedTab.classList.add('tab--active');
                archivedTab.setAttribute('aria-selected', 'true');
                activeTab.classList.remove('tab--active');
                activeTab.setAttribute('aria-selected', 'false');
                
                // Update content visibility
                archivedSection.classList.add('tab-content--active');
                activeSection.classList.remove('tab-content--active');
            });
            
            // Keyboard navigation
            activeTab.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                    e.preventDefault();
                    archivedTab.focus();
                } else if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    activeTab.click();
                }
            });
            
            archivedTab.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                    e.preventDefault();
                    activeTab.focus();
                } else if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    archivedTab.click();
                }
            });
        }

        // Initialize managers
        let trayManager;
        let menuManager;
        let dataTable;
        let archivedDataTable;
        let legacyManager;

        document.addEventListener('DOMContentLoaded', () => {
            trayManager = new TrayManager();

            // Initialize tab manager for configuration tabs
            TabManager.init();
            
            // Initialize table switching tabs
            initializeTableTabs();

            // Initialize the new modular data table
            dataTable = new DataTable(userTableConfig);
            dataTable.init();

            // Initialize archived courses table with completely separate config
            const archivedTableConfig = {
                columns: userTableConfig.columns,
                filters: userTableConfig.filters,
                responsive: userTableConfig.responsive,
                defaultColumns: ['Name', 'Terms', 'Teachers', 'Start Date', 'Archived Date'],
                data: {
                    data: sampleData.filter(item => item.Archive === true),
                    primaryKey: 'SIS ID'
                },
                pagination: {
                    defaultSize: 15
                }
            };

            // Create archived table with custom element selectors
            archivedDataTable = new ArchivedDataTable(archivedTableConfig);
            archivedDataTable.init();

            // Initialize archived field configuration manager
            archivedDataTable.archivedFieldConfigManager = new ArchivedFieldConfigurationManager(archivedDataTable);

            // Setup archived table bulk actions
            setupArchivedBulkActions();

            // Setup archived table items per page
            const archivedItemsPerPageSelect = document.getElementById('archivedItemsPerPage');
            if (archivedItemsPerPageSelect) {
                archivedItemsPerPageSelect.addEventListener('change', (e) => {
                    archivedDataTable.itemsPerPage = parseInt(e.target.value);
                    archivedDataTable.currentPage = 1;
                    archivedDataTable.render();
                });
            }

            // Make dataTable globally accessible for multiselect sync
            window.dataTable = dataTable;
            window.archivedDataTable = archivedDataTable;
            window.mainDataTable = dataTable; // Add this reference for unified filter manager

            // Initialize unified filter manager with the complete dataset
            unifiedFilterManager.setData(sampleData);
            
            // Set up clear all filters button
            const clearAllBtn = document.getElementById('clearAllActiveFilters');
            if (clearAllBtn) {
                clearAllBtn.addEventListener('click', () => {
                    unifiedFilterManager.clearAllFilters();
                });
            }
            
            // Initialize legacy table manager for configuration compatibility
            legacyManager = new TableManager();

            // Connect legacy configuration system to new table
            legacyManager.dataTable = dataTable;

            // Initialize menu manager for action menus
            menuManager = new MenuManager();

            // Initialize multi-select filter inputs
            initializeMultiSelects();
        });

        // Global escape key handler
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeDrawer();
            }
        });

        
    </script>

</body>

</html>